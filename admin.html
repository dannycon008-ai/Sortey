<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Panel Admin</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
    /* ====== ESTILOS ADMIN ====== */
    *{box-sizing:border-box;margin:0;padding:0}
    body{font-family:Poppins,system-ui,Segoe UI,sans-serif;background:#0b1220;color:#e9f6ff;min-height:100vh}
    a{text-decoration:none;color:inherit}
    .container{max-width:1100px;margin:0 auto;padding:16px}
    .header{position:sticky;top:0;z-index:50;background:rgba(10,18,32,.65);backdrop-filter:blur(6px);border-bottom:1px solid #132338}
    .header-inner{display:flex;justify-content:space-between;align-items:center;gap:12px;padding:12px 16px}
    .brand{display:flex;align-items:center;gap:10px;font-weight:700}
    .dot{width:10px;height:10px;border-radius:50%;background:#ff2e6a;display:inline-block}
    .btn{border:0;padding:10px 14px;border-radius:12px;font-weight:600;cursor:pointer;transition:.15s}
    .btn:active{transform:translateY(1px)}
    .btn-primary{background:#ff2e6a;color:#fff;box-shadow:0 8px 24px rgba(255,46,106,.35)}
    .btn-ghost{background:transparent;color:#cfe7ff;border:1px solid #244362}
    .btn-danger{background:#ef476f;color:#fff}
    .input,textarea{width:100%;background:#0e192a;color:#d9eeff;border:1px solid #1f3550;border-radius:12px;padding:12px 14px;outline:none}
    .field{margin-bottom:12px}
    .card{background:linear-gradient(180deg,#0f1a2b,#0a1220);border:1px solid #1b3150;border-radius:18px;padding:16px;box-shadow:0 10px 32px rgba(0,0,0,.35);margin-top:16px}
    .table{width:100%;border-collapse:collapse;font-size:14px;margin-top:12px}
    .table th,.table td{border-bottom:1px solid #1b3150;padding:10px;text-align:left}
    .badge{display:inline-block;padding:2px 8px;border-radius:999px;font-size:12px}
    .badge.green{background:#112d22;color:#7af2bf;border:1px solid #1f8d6a}
    .small{color:#9bc2df;font-size:12px}
  </style>
</head>
<body>
  <!-- Header -->
  <header class="header">
    <div class="header-inner container">
      <div class="brand"><span class="dot"></span> Admin ‚≠ê</div>
      <button class="btn btn-danger" id="btnExit">Salir</button>
    </div>
  </header>

  <!-- Contenido -->
  <main class="container">
    <!-- Agregar modelo -->
    <div class="card">
      <h3 style="margin-top:0">Agregar modelo</h3>
      <div class="field"><label>Nombre</label><input class="input" id="mName"/></div>
      <div class="field"><label>Descripci√≥n</label><input class="input" id="mDesc"/></div>
      <div class="field"><label>URL Foto</label><input class="input" id="mImg"/></div>
      <button class="btn btn-primary" id="btnAddModel">Agregar</button>
    </div>

    <!-- Lista de modelos -->
    <div class="card">
      <div style="display:flex;justify-content:space-between;align-items:center">
        <h3 style="margin:0">Modelos</h3>
        <button class="btn btn-ghost" id="btnSeed">Cargar ejemplos</button>
      </div>
      <table class="table" id="modelsTable">
        <thead>
          <tr>
            <th>Foto</th><th>Nombre</th><th>Descripci√≥n</th><th>Estado</th><th>Acciones</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>

    <!-- Flujo de respuestas -->
    <div class="card">
      <h3 style="margin-top:0">Respuestas autom√°ticas (flujo)</h3>
      <p class="small">Ejemplo JSON: <code>[{"q":"¬øQuieres jugar?","yes":"S√≠ üòò","no":"Luego üíñ"}]</code></p>
      <textarea class="input" rows="6" id="flowJson"></textarea>
      <button class="btn btn-primary" id="btnSaveFlow">Guardar flujo</button>
    </div>
  </main>

  <!-- ====== JS INTEGRADO ====== -->
  <script>
    // Helpers de almacenamiento
    const DB = {
      get:(k,f=null)=>{try{const v=localStorage.getItem(k);return v?JSON.parse(v):f}catch{return f}},
      set:(k,v)=>localStorage.setItem(k,JSON.stringify(v)),
      del:k=>localStorage.removeItem(k)
    };

    function session(){return DB.get('sessionUser')}
    function isAdmin(){const u=session();return !!u && u.role==='admin'}

    // Bloqueo si no es admin
    if(!isAdmin()){
      alert('Acceso restringido. Solo administradores.');
      window.location.href='index.html';
    }

    // Salir
    document.getElementById('btnExit').onclick=()=>{
      DB.del('sessionUser');window.location.href='index.html';
    };

    // Renderizar tabla de modelos
    function renderModelsTable(){
      const tb=document.querySelector('#modelsTable tbody');
      tb.innerHTML='';
      DB.get('models',[]).forEach(m=>{
        const tr=document.createElement('tr');
        tr.innerHTML=`
          <td><img src="${m.img}" style="width:56px;height:56px;border-radius:10px;object-fit:cover"></td>
          <td>${m.name}</td>
          <td>${m.desc}</td>
          <td><span class="badge green">Activo</span></td>
          <td><button class="btn btn-ghost" data-del="${m.id}">Eliminar</button></td>`;
        tb.appendChild(tr);
      });
      // Botones eliminar
      tb.querySelectorAll('[data-del]').forEach(b=>{
        b.onclick=()=>{
          const id=b.dataset.del;
          const list=DB.get('models',[]).filter(x=>x.id!==id);
          DB.set('models',list);
          renderModelsTable();
        };
      });
    }
    renderModelsTable();

    // Agregar modelo
    document.getElementById('btnAddModel').onclick=()=>{
      const name=document.getElementById('mName').value.trim();
      const desc=document.getElementById('mDesc').value.trim();
      const img=document.getElementById('mImg').value.trim();
      if(!name||!img){alert('Nombre y foto obligatorios');return;}
      const list=DB.get('models',[]);
      list.push({id:'m_'+Date.now(),name,desc,img});
      DB.set('models',list);
      renderModelsTable();
      alert('Modelo agregado ‚úÖ');
    };

    // Cargar ejemplos
    document.getElementById('btnSeed').onclick=()=>{
      DB.set('models',[
        {id:'m1',name:'Luna',desc:'Tierna y juguetona ‚ú®',img:'https://images.unsplash.com/photo-1529626455594-4ff0802cfb7e?q=80&w=600'},
        {id:'m2',name:'Mila',desc:'Charla traviesa üòá',img:'https://images.unsplash.com/photo-1509967419530-da38b4704bc8?q=80&w=600'},
        {id:'m3',name:'Arya',desc:'Curiosa y divertida üí´',img:'https://images.unsplash.com/photo-1544005313-94ddf0286df2?q=80&w=600'}
      ]);
      renderModelsTable();
      alert('Modelos de ejemplo cargados');
    };

    // Flujo de respuestas
    const flowJson=document.getElementById('flowJson');
    flowJson.value=JSON.stringify(DB.get('autoFlow',[]),null,2);

    document.getElementById('btnSaveFlow').onclick=()=>{
      try{
        const data=JSON.parse(flowJson.value||'[]');
        DB.set('autoFlow',data);
        alert('Flujo guardado ‚úÖ');
      }catch{
        alert('JSON inv√°lido ‚ùå');
      }
    };
  </script>
</body>
</html>

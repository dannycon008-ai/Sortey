<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>TU DIAMANTE ðŸ’Ž</title>
  <!-- Fuente Sans Serif -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@700;800&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/intl-tel-input@19.5.6/build/css/intlTelInput.css" />
  <style>
    :root{
      --bg:#ffffff;
      --ink:#1c1e21;
      --muted:#6b7280;
      --brand:#111827;
      --brand-2:#0ea5e9;
      --ok:#16a34a; --warn:#ef4444; --border:#e5e7eb; --chip:#f3f4f6;
    }
    html,body{height:100%;}
    body{
      margin:0; background:var(--bg); color:var(--ink);
      font-family:"Inter", sans-serif;
      font-weight:800;
    }
    .container{max-width:1200px; margin:0 auto; padding:16px;}
    .app-title{display:flex; justify-content:center; align-items:center; text-align:center;}
    .app-title h1{font-size:42px; margin:0; font-weight:800; letter-spacing:2px; text-transform:uppercase;}

    .bar{height:14px; background:#f3f4f6; border-radius:999px; overflow:hidden; border:1px solid var(--border); margin:12px auto; max-width:600px;}
    .bar>span{display:block; height:100%; background:linear-gradient(90deg,var(--brand-2),#22c55e); width:0%; transition:width 1s ease-in-out;}

    .progress-info{text-align:center; margin-bottom:12px;}

    .grid-layout{display:grid; grid-template-columns: 1fr; gap:16px; margin-top:12px;}
    @media(min-width:1024px){ .grid-layout{ grid-template-columns: 2fr 1fr; } }

    .panel{background:#fff; border:1px solid var(--border); border-radius:16px; padding:16px; box-shadow:0 1px 2px rgba(0,0,0,.04);} 
    .panel h2{text-align:center; margin:0 0 12px 0; font-size:42px; text-transform:uppercase; font-weight:800;}
    .subtle{color:var(--muted); font-size:14px;}

    .tickets-toolbar{display:flex; flex-wrap:wrap; align-items:center; gap:8px; margin-bottom:10px;}
    .search{position:relative; flex:1 1 220px;}
    .search input{width:100%; border:1px solid var(--border); border-radius:999px; padding:10px 36px 10px 40px; font-size:14px; outline:none;}
    .search svg{position:absolute; left:12px; top:50%; transform:translateY(-50%);} 

    .page-controls{display:flex; gap:6px; align-items:center;}
    .btn{border:1px solid var(--border); background:#fff; border-radius:12px; padding:8px 12px; font-weight:700; cursor:pointer; transition:.2s;}
    .btn:hover{transform:translateY(-1px);} 
    .btn.primary{background:var(--brand); color:#fff; border-color:var(--brand);} 
    .btn.secondary{background:#f8fafc;}
    .btn[disabled]{opacity:.6; cursor:not-allowed;}

    .square-wrap{width:100%; aspect-ratio:1/1; border:1px solid var(--border); border-radius:16px; overflow:hidden; display:flex;}
    .square-inner{flex:1; overflow:auto;}

    .ticket-grid{display:grid; grid-template-columns: repeat(6, 1fr); gap:6px; padding:10px;}
    @media(min-width:480px){ .ticket-grid{ grid-template-columns: repeat(8, 1fr);} }
    @media(min-width:768px){ .ticket-grid{ grid-template-columns: repeat(10, 1fr);} }
    @media(min-width:1024px){ .ticket-grid{ grid-template-columns: repeat(12, 1fr);} }
    @media(min-width:1280px){ .ticket-grid{ grid-template-columns: repeat(14, 1fr);} }

    .ticket{user-select:none; text-align:center; padding:8px 0; border:1px solid var(--border); border-radius:10px; background:#fff; font-weight:700; font-size:14px; cursor:pointer; transition:.15s;}
    .ticket:hover{background:#f9fafb;}
    .ticket.sold{background:#fee2e2; color:#991b1b; border-color:#fecaca; cursor:not-allowed;}
    .ticket.selected{background:#dbeafe; border-color:#bfdbfe;}

    .chips{display:flex; flex-wrap:wrap; gap:8px;}
    .chip{display:inline-flex; align-items:center; gap:6px; background:var(--chip); border:1px solid var(--border); border-radius:999px; padding:6px 10px; font-weight:700;}
    .chip button{border:none; background:transparent; cursor:pointer; font-size:16px; line-height:1;}

    .totals{display:flex; flex-wrap:wrap; align-items:center; gap:10px; margin-top:8px; justify-content:space-between;}
    .tag{background:#eef2ff; color:#3730a3; border:1px solid #e0e7ff; font-weight:800; border-radius:999px; padding:6px 10px;}
    .note{margin-top:8px; font-size:14px; color:#0f172a;}
    .note.warn{color:#b91c1c;}

    footer{margin:28px 0 10px; text-align:center; color:var(--muted); font-size:13px;}
  </style>
</head>
<body>
  <div class="container">
    <header class="app-title">
      <h1>TU DIAMANTE ðŸ’Ž</h1>
    </header>

    <section class="progress-info">
      <div class="bar"><span id="soldBar"></span></div>
      <div class="subtle">
        Vendidos: <b id="soldCount">0</b> / 10.000 â€” <b id="soldPct">0%</b>
      </div>
    </section>

    <div class="grid-layout">
      <section class="panel">
        <h2>LISTA DE BOLETOS</h2>
        <div class="tickets-toolbar">
          <div class="search">
            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.3-4.3"/></svg>
            <input id="searchInput" type="text" inputmode="numeric" maxlength="4" placeholder="Lupa: escribe nÃºmero de boleto" />
          </div>
          <div class="page-controls">
            <span class="subtle">PÃ¡gina:</span>
            <div id="pagination"></div>
          </div>
        </div>
        <div class="square-wrap">
          <div class="square-inner">
            <div id="tickets" class="ticket-grid" aria-live="polite"></div>
          </div>
        </div>
        <div class="totals">
          <div>
            <span class="tag">Precio: <b>15 Bs</b></span>
            <span class="tag">Seleccionados: <b id="selCount">0</b></span>
            <span class="tag">Total: <b id="totalAmount">0 Bs</b></span>
          </div>
          <button id="btnRandom" class="btn primary">ðŸŽ² Generar aleatorios</button>
        </div>
        <div id="minMsg" class="note warn" style="display:none;">Compra mÃ­nima 3 boletos.</div>
        <div style="margin-top:10px;">
          <div class="subtle">Tus boletos seleccionados</div>
          <div id="selectedChips" class="chips"></div>
        </div>
      </section>
    </div>

    <div class="panel" style="margin-top:16px;">
      <h2>VERIFICADOR DE BOLETOS</h2>
      <div class="verif">
        <div class="radio">
          <label><input type="radio" name="vmode" value="phone" checked> Por telÃ©fono</label>
          <label><input type="radio" name="vmode" value="ticket"> Por boleto</label>
        </div>
        <div style="display:flex; gap:8px; flex-wrap:wrap;">
          <input id="verifyInput" style="flex:1 1 240px; border:1px solid var(--border); border-radius:12px; padding:10px 12px;" placeholder="TelÃ©fono o nÃºmero de boleto" />
          <button id="btnVerify" class="btn secondary" type="button">ðŸ”Ž Verificar</button>
        </div>
        <div id="verifyOut"></div>
      </div>
    </div>

    <footer>
      &copy; <span id="year"></span> TU DIAMANTE ðŸ’Ž. Todos los derechos reservados.
    </footer>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/intl-tel-input@19.5.6/build/js/intlTelInput.min.js"></script>
  <script>
    const PRICE_PER_TICKET = 15;
    const TOTAL_TICKETS = 10000;
    const PAGE_SIZE = TOTAL_TICKETS / 5;

    const el = s => document.querySelector(s);
    const soldKey = 'rifas_soldTickets_v1';
    const ordersKey = 'rifas_orders_v1';
    const pad4 = n => n.toString().padStart(4, '0');

    const getSold = () => new Set(JSON.parse(localStorage.getItem(soldKey) || '[]'));
    const setSold = (set) => localStorage.setItem(soldKey, JSON.stringify([...set]));
    const getOrders = () => JSON.parse(localStorage.getItem(ordersKey) || '[]');
    const setOrders = (arr) => localStorage.setItem(ordersKey, JSON.stringify(arr));

    let selected = new Set();
    let currentPage = 1;

    function updateProgress(){
      const sold = getSold();
      const pct = Math.round((sold.size / TOTAL_TICKETS) * 100);
      el('#soldBar').style.width = pct + '%';
      el('#soldCount').textContent = sold.size;
      el('#soldPct').textContent = pct + '%';
    }

    function renderSelectedChips(){
      const box = el('#selectedChips');
      box.innerHTML = '';
      [...selected].sort((a,b)=>a-b).forEach(n=>{
        const chip = document.createElement('span');
        chip.className = 'chip';
        chip.innerHTML = `<span>${pad4(n)}</span>`;
        const x = document.createElement('button');
        x.textContent = 'Ã—';
        x.addEventListener('click', ()=>{selected.delete(n); renderSelectedChips();});
        chip.appendChild(x);
        box.appendChild(chip);
      });
    }

    function randomPick(count=3){
      const sold = getSold();
      const pool = [];
      for(let n=0;n<TOTAL_TICKETS;n++) if(!sold.has(n) && !selected.has(n)) pool.push(n);
      while(selected.size < count && pool.length){
        const idx = Math.floor(Math.random()*pool.length);
        selected.add(pool.splice(idx,1)[0]);
      }
      renderSelectedChips();
      updateProgress();
    }

    function verify(){
      const raw = el('#verifyInput').value.trim();
      const out = el('#verifyOut');
      out.innerHTML = '';
      const orders = getOrders();
      const hits = orders.filter(o=>o.phone.includes(raw) || o.tickets.includes(parseInt(raw)));
      if(hits.length===0){ out.innerHTML = '<div>No se encontraron compras.</div>'; return; }
      hits.forEach(o=>{
        const div = document.createElement('div');
        div.textContent = `Boletos: ${o.tickets.map(pad4).join(', ')}`;
        out.appendChild(div);
      });
    }

    window.addEventListener('DOMContentLoaded', ()=>{
      el('#year').textContent = new Date().getFullYear();
      updateProgress();
      el('#btnRandom').addEventListener('click', ()=>randomPick(3));
      el('#btnVerify').addEventListener('click', verify);
    });
  </script>
</body>
</html>

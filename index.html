<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>TuChat ‚Äî Demo</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
    /* ====== ESTILOS MODELOS ====== */
    .model-grid {
      display:grid;
      grid-template-columns:repeat(auto-fit,minmax(200px,1fr));
      gap:18px;
      margin-top:18px;
    }
    .model-card {
      background:#fff;
      color:#000;
      border-radius:14px;
      overflow:hidden;
      box-shadow:0 4px 20px rgba(0,0,0,.12);
      display:flex;
      flex-direction:column;
      cursor:pointer;
      transition:transform .25s ease, box-shadow .25s ease;
      animation:softFloat 4s ease-in-out infinite;
    }
    .model-card:hover{transform:translateY(-4px) scale(1.02);box-shadow:0 12px 30px rgba(0,0,0,.2)}
    @keyframes softFloat{
      0%,100%{transform:translateY(0)}
      50%{transform:translateY(-6px)}
    }
    .model-slideshow { position:relative; height:200px; }
    .model-slideshow img {
      position:absolute; inset:0; width:100%; height:100%; object-fit:cover;
      opacity:0; transition:opacity .6s ease;
    }
    .model-slideshow img.active{opacity:1}
    .model-card .info { padding:12px; display:flex; flex-direction:column; gap:6px; }
    .model-card .name { font-weight:700; font-size:16px; color:#111; }
    .model-card .extra { font-size:12px; color:#555; }
    .model-card .desc  { font-size:13px; color:#333; }
    .model-card .online {
      display:inline-block;
      background:#27ae60;
      color:#fff;
      font-size:12px;
      padding:2px 6px;
      border-radius:6px;
      margin-left:6px;
    }
    .model-card .actions{display:flex; gap:10px; justify-content:space-between; align-items:center; padding:10px 12px; background:#f7f9fb; border-top:1px solid #eaeef3;}
    .action-btn{display:flex; align-items:center; gap:8px; padding:8px 12px; border-radius:10px; border:1px solid #e0e6ee; background:#fff; cursor:pointer; transition:.2s; font-weight:600; font-size:13px; color:#222;}
    .action-btn:hover{transform:translateY(-2px); box-shadow:0 6px 16px rgba(0,0,0,.08)}
    .action-btn img{width:18px;height:18px;display:block}
    .like-badge{background:#ff2e6a; color:#fff; font-size:12px; padding:2px 8px; border-radius:999px;}

    /* ====== GENERALES ====== */
    *{box-sizing:border-box}html,body{height:100%}
    body{margin:0;font-family:Poppins,system-ui,sans-serif;background:#0b1220;color:#e9f6ff}
    .container{max-width:1100px;margin:0 auto;padding:16px}
    .header{position:sticky;top:0;z-index:50;background:rgba(10,18,32,.85);backdrop-filter:blur(6px);border-bottom:1px solid #132338}
    .header-inner{display:flex;justify-content:space-between;align-items:center;padding:12px 16px}
    .brand{display:flex;align-items:center;gap:10px;font-weight:700}
    .dot{width:10px;height:10px;border-radius:50%;background:#ff2e6a;display:inline-block}
    .btn{border:0;padding:8px 12px;border-radius:10px;font-weight:600;cursor:pointer;transition:.15s;font-size:14px}
    .btn-primary{background:#ff2e6a;color:#fff}
    .btn-ghost{background:transparent;color:#cfe7ff;border:1px solid #244362}
    .input{width:100%;background:#0e192a;color:#d9eeff;border:1px solid #1f3550;border-radius:12px;padding:10px 12px}
    .card{background:#0f1a2b;border:1px solid #1b3150;border-radius:18px;padding:16px;box-shadow:0 10px 32px rgba(0,0,0,.35)}
    .small{color:#9bc2df;font-size:12px}
    .view{display:none}.view.active{display:block}

    /* ====== BANNER VIDEO ====== */
    .banner-wrap { position: relative; margin-top: 8px; }
    .banner-wrap video {
      width: 100%;
      max-height: 180px;
      object-fit: cover;
      border-radius: 14px;
      display: block;
    }
    .live-badge {
      position: absolute;
      top: 12px;
      left: 12px;
      background: #001f99;
      color: #fff;
      font-weight: 700;
      font-size: 14px;
      padding: 6px 12px;
      border-radius: 10px;
      animation: pulse 1.5s infinite;
      box-shadow: 0 0 8px rgba(0,0,0,0.4);
    }
    @keyframes pulse {
      0% { transform: scale(1); opacity: 1; }
      50% { transform: scale(1.1); opacity: 0.85; }
      100% { transform: scale(1); opacity: 1; }
    }

    /* ====== CHAT MODERNO ====== */
    .chat-card {
      display: flex;
      flex-direction: column;
      background: #0f172a;
      color: #fff;
      border-radius: 20px;
      box-shadow: 0 8px 25px rgba(0,0,0,.45);
      overflow: hidden;
      animation: fadeInUp .35s ease;
      position: fixed;
      bottom: 20px;
      right: 20px;
      width: 380px;
      max-height: 520px;
      z-index: 1000;
    }
    @media (max-width: 768px) {
      .chat-card {
        top: 0; left: 0; right: 0; bottom: 0;
        width: 100%;
        height: 100%;
        max-height: none;
        border-radius: 0;
      }
    }
    @keyframes fadeInUp {
      from { transform: translateY(40px); opacity: 0; }
      to { transform: translateY(0); opacity: 1; }
    }
    .chat-head {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 12px 16px;
      background: linear-gradient(90deg,#ff2e6a,#ff4f8b);
      color: #fff;
    }
    .chat-body {
      flex: 1;
      padding: 14px;
      overflow-y: auto;
      background: #0b1220;
      display: flex;
      flex-direction: column;
    }
    .msg {
      padding: 10px 14px;
      margin: 8px 0;
      border-radius: 14px;
      font-size: 14px;
      max-width: 75%;
    }
    .msg.them { background: #1e293b; align-self: flex-start; }
    .msg.me { background: #ff2e6a; align-self: flex-end; color: #fff; }
    .typing {
      font-size: 12px;
      color: #94a3b8;
      font-style: italic;
      padding: 0 14px 8px;
    }
    .chat-input {
      display: flex;
      padding: 10px;
      background: #111827;
      border-top: 1px solid #1f2937;
    }
    .chat-input input {
      flex: 1;
      border: none;
      outline: none;
      border-radius: 12px;
      padding: 10px;
      margin-right: 8px;
      background: #1e293b;
      color: #fff;
    }
    .chat-input button {
      background: #ff2e6a;
      border: none;
      padding: 10px 14px;
      border-radius: 12px;
      color: #fff;
      font-weight: 600;
      cursor: pointer;
      transition: .25s;
    }
    .chat-input button:hover { background: #e11d48; }
  </style>
</head>
<body>
  <!-- HEADER -->
  <header class="header">
    <div class="header-inner container">
      <div class="brand">
        <img id="appLogo" src="https://qu.ax/PyOjt.png" alt="Logo" style="height:36px;border-radius:8px;object-fit:contain">
        <span>ChispaLive</span>
        <nav style="display:flex;gap:12px;align-items:center">
          <div>Monedas 20: <b id="coinsLabel">0</b></div>
        </nav>
      </div>
    </div>
  </header>

  <main class="container">
    <!-- BANNER VIDEO -->
    <div class="banner-wrap">
      <a id="bannerLink" href="https://ejemplo.com" target="_blank" rel="noopener">
        <video autoplay muted loop playsinline>
          <source src="https://qu.ax/dMvpz.mp4" type="video/mp4">
          Tu navegador no soporta video.
        </video>
        <div class="live-badge">üî¥ En directo</div>
      </a>
    </div>

    <!-- MODELOS -->
    <section id="view-chat" class="view active">
      <h3>Modelos</h3>
      <div class="model-grid" id="chatList"></div>
    </section>

    <!-- CHAT -->
    <section id="view-conversation" class="view">
      <div class="chat-card">
        <div class="chat-head">
          <button class="btn btn-ghost" onclick="go('chat')">‚Üê</button>
          <img id="chatAvatar" src="" style="width:40px;height:40px;border-radius:50%;object-fit:cover">
          <div>
            <div id="chatName" class="name"></div>
            <small id="chatStatus" class="small">En l√≠nea</small>
          </div>
        </div>
        <div class="chat-body" id="messages"></div>
        <div class="typing" id="typingHint">Est√° escribiendo‚Ä¶</div>
        <div class="chat-input">
          <input id="msgText" placeholder="Escribe un mensaje (2 monedas)">
          <button id="btnSend">Enviar</button>
        </div>
      </div>
    </section>
  </main>

  <script type="module">
    /* ================= FIREBASE ================= */
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
    import { getFirestore, collection, getDocs } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyAlWJTeezvz0Xkd363SgN5CnHFbEp8uNQU",
      authDomain: "chispalive-b7ed6.firebaseapp.com",
      projectId: "chispalive-b7ed6",
      storageBucket: "chispalive-b7ed6.appspot.com",
      messagingSenderId: "334811479289",
      appId: "1:334811479289:web:403a2a1b10f7af6704b628",
      measurementId: "G-60ERX1MFT7"
    };
    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    /* ================= ROUTER ================= */
    const views={chat:'view-chat',conversation:'view-conversation'};
    function go(v){Object.values(views).forEach(id=>document.getElementById(id).classList.remove('active'));document.getElementById(views[v]).classList.add('active');}

    /* ================= MODELOS DESDE FIRESTORE ================= */
    const chatList=document.getElementById('chatList');
    const slidesIntervals={};

    async function renderModels(){
      chatList.innerHTML='';
      const snap = await getDocs(collection(db,"models"));
      snap.forEach(docSnap=>{
        const m={id:docSnap.id,...docSnap.data()};
        const card=document.createElement('div');
        card.className='model-card';

        const slideId='slide_'+m.id;
        card.innerHTML=`
          <div class="model-slideshow" id="${slideId}">
            ${(m.photos||[]).slice(0,5).map((src,i)=>`<img src="${src}" class="${i===0?'active':''}">`).join('')}
          </div>
          <div class="info">
            <div class="name">${m.name} <span class="online">‚óè Online</span></div>
            <div class="extra">${m.age||'‚Äî'} a√±os ¬∑ ${m.country||'‚Äî'}</div>
            <div class="desc">${m.desc||''}</div>
          </div>
          <div class="actions">
            <button class="action-btn btn-like">
              <img src="https://qu.ax/hlsxX.png" alt="like">
              <span>Me gusta</span>
              <span class="like-badge">${m.likes||0}</span>
            </button>
            <button class="action-btn btn-msg">
              <img src="https://qu.ax/jGSiu.png" alt="mensaje">
              <span>Mensaje</span>
            </button>
          </div>
        `;

        card.querySelector('.btn-msg').onclick=(e)=>{e.stopPropagation(); openChatWith(m);};
        card.onclick=()=>openChatWith(m);

        chatList.appendChild(card);
        startSlideshow(slideId);
      });
    }

    function startSlideshow(id){
      const box=document.getElementById(id); if(!box) return;
      const imgs=[...box.querySelectorAll('img')]; if(imgs.length<=1) return;
      let i=0;
      if(slidesIntervals[id]) clearInterval(slidesIntervals[id]);
      slidesIntervals[id]=setInterval(()=>{
        imgs[i].classList.remove('active');
        i=(i+1)%imgs.length;
        imgs[i].classList.add('active');
      }, 2800);
    }

    /* ================= CHAT ================= */
    let currentModel=null;
    const messages=document.getElementById('messages');
    const chatName=document.getElementById('chatName');
    const chatAvatar=document.getElementById('chatAvatar');

    function openChatWith(m){
      currentModel=m;
      chatName.textContent=m.name;
      chatAvatar.src=(m.photos&&m.photos[0])||'';
      messages.innerHTML=`<div class="msg them">Holi üíï soy ${m.name}, ¬øquieres jugar?</div>`;
      go('conversation');
    }

    /* INIT */
    renderModels();
  </script>
</body>
</html>

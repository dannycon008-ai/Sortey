<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Generador de Cookies — Proyecto</title>
  <style>
    :root{
      --bg:#0f1724;
      --card:#0b1220;
      --muted:#94a3b8;
      --accent:#60a5fa;
      --success:#22c55e;
      --danger:#ef4444;
      --glass: rgba(255,255,255,0.03);
      --radius:12px;
      font-family: Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
    }
    html,body{height:100%}
    body{
      margin:0;
      background: linear-gradient(180deg,#061025 0%, #071028 60%);
      color:#e6eef8;
      -webkit-font-smoothing:antialiased;
      padding:32px;
      box-sizing:border-box;
    }
    .container{
      max-width:1100px;
      margin:0 auto;
      display:grid;
      grid-template-columns: 420px 1fr;
      gap:24px;
      align-items:start;
    }
    header{
      grid-column: 1 / -1;
      display:flex;
      justify-content:space-between;
      align-items:center;
      margin-bottom:6px;
    }
    h1{font-size:20px;margin:0}
    p.lead{margin:6px 0 0;color:var(--muted);font-size:14px}
    .card{
      background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
      border-radius:var(--radius);
      padding:18px;
      box-shadow: 0 6px 18px rgba(2,6,23,0.6);
      border:1px solid rgba(255,255,255,0.03);
    }
    form label{display:block;font-size:13px;color:var(--muted);margin-top:12px}
    input[type="text"], input[type="number"], input[type="datetime-local"], select, textarea{
      width:100%;
      background:var(--glass);
      border:1px solid rgba(255,255,255,0.04);
      padding:10px;
      border-radius:8px;
      color:inherit;
      margin-top:6px;
      box-sizing:border-box;
      font-size:14px;
    }
    .row{display:flex;gap:8px}
    .row > *{flex:1}
    .actions{display:flex;gap:8px;margin-top:14px;flex-wrap:wrap}
    button{
      background:var(--accent);
      border:none;
      color:#04263a;
      font-weight:600;
      padding:10px 12px;
      border-radius:10px;
      cursor:pointer;
      box-shadow: 0 6px 12px rgba(96,165,250,0.12);
    }
    button.secondary{background:transparent;color:var(--muted);border:1px solid rgba(255,255,255,0.04);}
    button.danger{background:var(--danger);color:white;box-shadow:none}
    small.note{display:block;color:var(--muted);margin-top:8px;font-size:12px}
    .controls{display:flex;gap:8px;align-items:center;margin-top:10px}
    .cookie-list{overflow:auto;max-height:520px;padding-top:6px}
    table{width:100%;border-collapse:collapse;font-size:13px}
    th,td{padding:8px 10px;text-align:left;border-bottom:1px dashed rgba(255,255,255,0.02)}
    th{color:var(--muted);font-weight:600;font-size:12px}
    tr:hover td{background:rgba(255,255,255,0.01)}
    .pill{display:inline-block;padding:4px 8px;border-radius:999px;font-size:12px;background:rgba(255,255,255,0.03);color:var(--muted)}
    .right{text-align:right}
    .muted{color:var(--muted)}
    .small{font-size:12px}
    .topbar{
      display:flex;
      gap:10px;
      align-items:center;
      margin-bottom:10px;
      justify-content:space-between;
    }
    .file-input{display:none}
    .flex{display:flex;gap:8px;align-items:center}
    .toast{
      position:fixed;right:18px;bottom:18px;background:rgba(2,6,23,0.9);padding:12px 14px;border-radius:10px;border:1px solid rgba(255,255,255,0.04);
      color:#dff6ff;box-shadow:0 8px 30px rgba(2,6,23,0.6)
    }

    /* responsive */
    @media (max-width:900px){
      .container{grid-template-columns:1fr; padding:16px}
    }
  </style>
</head>
<body>
  <div class="container" role="main">
    <header>
      <div>
        <h1>Generador de Cookies</h1>
        <p class="lead">Crea, lista y administra cookies desde el cliente — ideal para pruebas y demos.</p>
      </div>
      <div class="muted small">
        Proyecto — Universidad · <span id="hostInfo"></span>
      </div>
    </header>

    <!-- Panel izquierdo: formulario -->
    <section class="card" aria-labelledby="formTitle">
      <h2 id="formTitle" style="margin:0 0 8px 0">Crear / editar cookie</h2>
      <form id="cookieForm" onsubmit="return false;">
        <label>Nombre <span class="muted small">(* obligatorio)</span>
          <input id="cName" type="text" placeholder="p. ej. sessionId" autocomplete="off" />
        </label>

        <label>Valor
          <textarea id="cValue" rows="3" placeholder='p. ej. {"user": "ana"} o cualquier texto'></textarea>
        </label>

        <div class="row">
          <div>
            <label>Expires (fecha y hora)
              <input id="cExpires" type="datetime-local" />
            </label>
          </div>
          <div>
            <label>Max-Age (segundos)
              <input id="cMaxAge" type="number" placeholder="ej. 3600" min="0" />
            </label>
          </div>
        </div>

        <div class="row">
          <div>
            <label>Path
              <input id="cPath" type="text" placeholder="/" />
            </label>
          </div>
          <div>
            <label>Domain
              <input id="cDomain" type="text" placeholder="ej. ejemplo.com (opcional)" />
            </label>
          </div>
        </div>

        <div class="row" style="margin-top:8px">
          <label style="flex:1"><input id="cSecure" type="checkbox" /> Secure</label>
          <label style="flex:1"><input id="cSameSite" type="checkbox" /> SameSite=Lax</label>
        </div>

        <div class="actions">
          <button id="btnSet">Establecer cookie</button>
          <button id="btnSetJson" class="secondary">Establecer valor como JSON</button>
          <button id="btnGen" class="secondary">Generar valor aleatorio</button>
          <button id="btnClearForm" class="secondary">Limpiar</button>
        </div>

        <small class="note">Nota: <strong>HttpOnly</strong> no puede establecerse desde JavaScript (solo desde el servidor).</small>
        <small class="note">Si ambos campos <em>Expires</em> y <em>Max-Age</em> están vacíos, la cookie será de sesión.</small>
      </form>

      <hr style="margin:14px 0;border:none;border-top:1px solid rgba(255,255,255,0.02)">

      <div>
        <button id="btnList" class="secondary">Actualizar lista</button>
        <button id="btnClearAll" class="danger">Borrar todas las cookies (locales)</button>
        <div style="margin-top:8px">
          <button id="btnExport" class="secondary">Exportar (JSON)</button>
          <label class="secondary" style="cursor:pointer;padding:10px;border-radius:10px;">
            Importar <input id="fileInput" class="file-input" type="file" accept=".json" />
          </label>
        </div>
      </div>
    </section>

    <!-- Panel derecho: lista y detalles -->
    <section class="card" aria-labelledby="listTitle">
      <div class="topbar">
        <h2 id="listTitle" style="margin:0">Cookies actuales</h2>
        <div class="flex">
          <span class="muted small">Visualiza cookies accesibles por JS</span>
        </div>
      </div>

      <div class="cookie-list">
        <table id="tblCookies" aria-live="polite">
          <thead>
            <tr>
              <th>Nombre</th>
              <th>Valor</th>
              <th class="muted">Extras</th>
              <th class="right">Acciones</th>
            </tr>
          </thead>
          <tbody id="tblBody">
            <!-- filas generadas por JS -->
          </tbody>
        </table>
      </div>
      <div id="noCookies" class="muted small" style="margin-top:12px;display:none">No hay cookies visibles para este dominio/path.</div>
    </section>
  </div>

  <div id="toast" class="toast" style="display:none"></div>

  <script>
    // ---------------------------
    // Utilidades y funcionalidades
    // ---------------------------
    const $ = id => document.getElementById(id);

    function showToast(msg, timeout = 3000) {
      const t = $('toast');
      t.textContent = msg;
      t.style.display = 'block';
      clearTimeout(t._timer);
      t._timer = setTimeout(()=> t.style.display = 'none', timeout);
    }

    // Host info
    $('hostInfo').textContent = location.hostname + (location.port ? ':' + location.port : '') + ' · ' + new Date().toLocaleDateString();

    // parse cookies into array of {name, value}
    function parseCookies() {
      const raw = document.cookie || "";
      if (!raw) return [];
      return raw.split('; ').filter(Boolean).map(pair => {
        const idx = pair.indexOf('=');
        const name = idx > -1 ? pair.slice(0, idx) : pair;
        const value = idx > -1 ? pair.slice(idx + 1) : "";
        return { name: decodeURIComponent(name), value: decodeURIComponent(value) };
      });
    }

    // Render cookie table
    function renderTable() {
      const list = parseCookies();
      const body = $('tblBody');
      body.innerHTML = '';
      if (list.length === 0) {
        $('noCookies').style.display = 'block';
        return;
      } else {
        $('noCookies').style.display = 'none';
      }

      list.forEach(cookie => {
        const tr = document.createElement('tr');
        const extras = document.createElement('td');
        extras.innerHTML = '<span class="pill">visible desde JS</span>';
        const actionsTd = document.createElement('td');
        actionsTd.className = 'right small';

        const nameTd = document.createElement('td');
        nameTd.textContent = cookie.name;

        const valueTd = document.createElement('td');
        // reduce displayed value length
        const short = cookie.value.length > 80 ? cookie.value.slice(0,80) + '…' : cookie.value;
        valueTd.textContent = short;
        valueTd.title = cookie.value;

        const btnEdit = document.createElement('button');
        btnEdit.className = 'secondary';
        btnEdit.textContent = 'Editar';
        btnEdit.onclick = () => {
          $('cName').value = cookie.name;
          $('cValue').value = cookie.value;
          showToast('Rellena extras si quieres cambiar path/domain/expires antes de "Establecer"');
        };

        const btnCopy = document.createElement('button');
        btnCopy.textContent = 'Copiar';
        btnCopy.onclick = () => {
          navigator.clipboard?.writeText(cookie.value).then(()=> showToast('Valor copiado.'));
        };

        const btnDelete = document.createElement('button');
        btnDelete.className = 'danger';
        btnDelete.textContent = 'Eliminar';
        btnDelete.onclick = () => {
          deleteCookie(cookie.name);
          renderTable();
        };

        actionsTd.appendChild(btnEdit);
        actionsTd.appendChild(btnCopy);
        actionsTd.appendChild(btnDelete);

        tr.appendChild(nameTd);
        tr.appendChild(valueTd);
        tr.appendChild(extras);
        tr.appendChild(actionsTd);
        body.appendChild(tr);
      });
    }

    // Set cookie with options
    function setCookie(opts) {
      // opts: {name, value, expires, maxAge, path, domain, secure, sameSite}
      if (!opts.name) { showToast('El nombre es obligatorio'); return false; }

      const parts = [];
      parts.push(encodeURIComponent(opts.name) + '=' + encodeURIComponent(opts.value ?? ''));

      if (opts.maxAge !== undefined && opts.maxAge !== null && opts.maxAge !== '') {
        const ma = parseInt(opts.maxAge, 10);
        if (!Number.isNaN(ma)) parts.push('Max-Age=' + ma);
      } else if (opts.expires) {
        // expects ISO date or Date object
        const d = new Date(opts.expires);
        if (!isNaN(d.getTime())) parts.push('Expires=' + d.toUTCString());
      }

      if (opts.path) parts.push('Path=' + opts.path);
      if (opts.domain) parts.push('Domain=' + opts.domain);
      if (opts.secure) parts.push('Secure');
      if (opts.sameSite) parts.push('SameSite=Lax');

      // IMPORTANT: HttpOnly cannot be set via JS. Mentioned in UI.
      const cookieString = parts.join('; ');
      document.cookie = cookieString;

      // quick verify: some cookies may be blocked by browser (cross-domain, insecure, etc)
      setTimeout(()=> {
        const found = parseCookies().some(c => c.name === opts.name);
        if (found) {
          showToast('Cookie establecida correctamente.');
        } else {
          showToast('Intenta: cookie no visible o bloqueada por el navegador/ dominio/secure.');
        }
        renderTable();
      }, 150);
      return true;
    }

    function deleteCookie(name, path = '/', domain = '') {
      // Delete by setting expires to past and Max-Age=0
      let str = encodeURIComponent(name) + '=; Max-Age=0; Expires=Thu, 01 Jan 1970 00:00:00 GMT; Path=' + path;
      if (domain) str += '; Domain=' + domain;
      document.cookie = str;
      showToast('Se intentó eliminar: ' + name);
      // update UI
      setTimeout(renderTable, 120);
    }

    function clearAllCookies() {
      const list = parseCookies();
      list.forEach(c => deleteCookie(c.name));
      showToast('Intentando eliminar ' + list.length + ' cookies');
    }

    // Helpers
    function getFormData() {
      return {
        name: $('cName').value.trim(),
        value: $('cValue').value,
        expires: $('cExpires').value ? new Date($('cExpires').value) : null,
        maxAge: $('cMaxAge').value ? $('cMaxAge').value : '',
        path: $('cPath').value || '/',
        domain: $('cDomain').value || '',
        secure: $('cSecure').checked,
        sameSite: $('cSameSite').checked
      };
    }

    function clearForm() {
      $('cName').value = '';
      $('cValue').value = '';
      $('cExpires').value = '';
      $('cMaxAge').value = '';
      $('cPath').value = '/';
      $('cDomain').value = '';
      $('cSecure').checked = false;
      $('cSameSite').checked = false;
    }

    function generateRandom(length = 24) {
      const arr = new Uint8Array(length);
      crypto.getRandomValues(arr);
      return Array.from(arr).map(b => b.toString(16).padStart(2,'0')).join('');
    }

    // Export/Import
    function exportCookies() {
      const list = parseCookies();
      const data = JSON.stringify(list, null, 2);
      const blob = new Blob([data], {type:'application/json'});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = 'cookies-export.json';
      document.body.appendChild(a);
      a.click();
      a.remove();
      URL.revokeObjectURL(url);
      showToast('Exportado ' + list.length + ' cookies');
    }

    function importCookiesFromJSON(file) {
      const reader = new FileReader();
      reader.onload = e => {
        try {
          const arr = JSON.parse(e.target.result);
          if (!Array.isArray(arr)) throw new Error('Formato inválido');
          let count = 0;
          arr.forEach(item => {
            if (item.name) {
              setCookie({
                name: item.name,
                value: item.value ?? '',
                path: item.path ?? '/',
                domain: item.domain ?? '',
                secure: !!item.secure,
                sameSite: !!item.sameSite,
                maxAge: item.maxAge ?? ''
              });
              count++;
            }
          });
          showToast('Importadas ~' + count + ' cookies (intento)');
        } catch (err) {
          showToast('Error importando: ' + err.message);
        }
      };
      reader.readAsText(file);
    }

    // Event bindings
    $('btnSet').addEventListener('click', () => {
      const d = getFormData();
      if (!d.name) { showToast('Debes indicar un nombre'); return; }
      setCookie(d);
    });

    $('btnSetJson').addEventListener('click', () => {
      const v = $('cValue').value;
      try {
        const obj = v ? JSON.parse(v) : {};
        // set pretty JSON as value
        $('cValue').value = JSON.stringify(obj);
      } catch (e) {
        // if not JSON, try to create a sample
        const sample = { createdAt: new Date().toISOString(), note: 'ejemplo' };
        $('cValue').value = JSON.stringify(sample);
        showToast('El valor no era JSON; se ha insertado un ejemplo.');
      }
    });

    $('btnGen').addEventListener('click', () => {
      $('cValue').value = generateRandom(16);
      showToast('Valor aleatorio generado');
    });

    $('btnClearForm').addEventListener('click', () => {
      clearForm();
      showToast('Formulario limpio');
    });

    $('btnList').addEventListener('click', renderTable);

    $('btnClearAll').addEventListener('click', () => {
      if (confirm('¿Seguro que quieres intentar eliminar todas las cookies visibles?')) {
        clearAllCookies();
      }
    });

    $('btnExport').addEventListener('click', exportCookies);

    $('fileInput').addEventListener('change', (ev) => {
      const f = ev.target.files && ev.target.files[0];
      if (f) importCookiesFromJSON(f);
      ev.target.value = '';
    });

    // on load
    document.addEventListener('DOMContentLoaded', () => {
      // sensible defaults
      if (!$('cPath').value) $('cPath').value = '/';
      renderTable();
    });

    // Extra: prevent accidental form submit on Enter
    document.getElementById('cookieForm').addEventListener('submit', (e)=> e.preventDefault());
  </script>
</body>
</html>


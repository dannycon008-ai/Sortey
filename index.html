<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Manos Solidarias | Ayuda Social</title>
  <style>
    :root{
      --bg:#0b1220;
      --card:#101a31;
      --muted:#9fb0d0;
      --text:#eaf0ff;
      --accent:#4da3ff;
      --accent2:#22c55e;
      --warn:#f59e0b;
      --danger:#ef4444;
      --border: rgba(255,255,255,.10);
      --shadow: 0 14px 40px rgba(0,0,0,.35);
      --radius: 18px;
    }

    *{ box-sizing:border-box; }
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial, "Noto Sans", "Helvetica Neue", sans-serif;
      color:var(--text);
      background:
        radial-gradient(900px 400px at 20% 5%, rgba(77,163,255,.20), transparent 55%),
        radial-gradient(900px 500px at 85% 20%, rgba(34,197,94,.14), transparent 55%),
        radial-gradient(900px 500px at 50% 100%, rgba(245,158,11,.10), transparent 55%),
        var(--bg);
      min-height:100vh;
    }

    a{ color:inherit; text-decoration:none; }
    .container{ width:min(1100px, 92vw); margin:0 auto; }

    /* Top bar */
    .topbar{
      position:sticky; top:0; z-index:50;
      backdrop-filter: blur(12px);
      background: rgba(11,18,32,.70);
      border-bottom: 1px solid var(--border);
    }
    .topbar-inner{
      display:flex; align-items:center; justify-content:space-between;
      padding:14px 0;
      gap:14px;
    }
    .brand{
      display:flex; align-items:center; gap:10px;
      font-weight:800; letter-spacing:.2px;
    }
    .logo{
      width:38px; height:38px; border-radius:12px;
      display:grid; place-items:center;
      background: linear-gradient(135deg, rgba(77,163,255,.95), rgba(34,197,94,.75));
      box-shadow: var(--shadow);
      border: 1px solid rgba(255,255,255,.15);
      user-select:none;
    }
    nav{
      display:flex; gap:10px; flex-wrap:wrap; justify-content:flex-end;
    }
    .navlink{
      padding:10px 12px;
      border: 1px solid transparent;
      border-radius: 999px;
      color: rgba(234,240,255,.90);
      transition: .2s ease;
      font-weight:600;
      font-size:14px;
    }
    .navlink:hover{
      border-color: var(--border);
      background: rgba(255,255,255,.06);
    }


    /* Hero */
    .hero{
      padding:46px 0 22px;
    }
    .hero-grid{
      display:grid;
      grid-template-columns: 1.35fr .65fr;
      gap:18px;
      align-items:stretch;
    }
    .hero-card{
      background: linear-gradient(180deg, rgba(255,255,255,.05), rgba(255,255,255,.02));
      border: 1px solid var(--border);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding:22px;
      overflow:hidden;
      position:relative;
    }
    .hero-card:before{
      content:"";
      position:absolute; inset:-2px;
      background:
        radial-gradient(520px 240px at 20% 10%, rgba(77,163,255,.22), transparent 60%),
        radial-gradient(520px 240px at 90% 35%, rgba(34,197,94,.16), transparent 60%);
      pointer-events:none;
      filter: blur(1px);
      opacity:.9;
    }
    .hero-card > *{ position:relative; }
    .pill{
      display:inline-flex; align-items:center; gap:8px;
      padding:8px 12px;
      border-radius:999px;
      background: rgba(77,163,255,.12);
      border: 1px solid rgba(77,163,255,.25);
      color: rgba(234,240,255,.92);
      font-weight:700;
      font-size:13px;
      width:fit-content;
    }
    .hero h1{
      margin:14px 0 10px;
      font-size: clamp(28px, 3.4vw, 42px);
      line-height:1.05;
      letter-spacing:-.5px;
    }
    .hero p{
      margin:0 0 18px;
      color: var(--muted);
      font-size: 15.5px;
      line-height:1.6;
      max-width: 62ch;
    }
    .cta-row{
      display:flex; gap:12px; flex-wrap:wrap;
      align-items:center;
      margin-top: 10px;
    }
    .btn{
      cursor:pointer;
      border:none;
      border-radius: 14px;
      padding: 12px 14px;
      font-weight:800;
      font-size:14px;
      display:inline-flex; align-items:center; gap:9px;
      transition:.18s ease;
      user-select:none;
      letter-spacing:.2px;
    }
    .btn:active{ transform: translateY(1px); }
    .btn-primary{
      background: linear-gradient(135deg, rgba(77,163,255,1), rgba(77,163,255,.75));
      color: #061024;
      box-shadow: 0 12px 30px rgba(77,163,255,.24);
    }
    .btn-primary:hover{ filter: brightness(1.03); }
    .btn-ghost{
      background: rgba(255,255,255,.06);
      color: rgba(234,240,255,.92);
      border: 1px solid var(--border);
    }
    .btn-ghost:hover{ background: rgba(255,255,255,.09); }
    .btn-green{
      background: linear-gradient(135deg, rgba(34,197,94,1), rgba(34,197,94,.70));
      color: #04160c;
      box-shadow: 0 12px 30px rgba(34,197,94,.22);
    }
    .btn-green:hover{ filter: brightness(1.03); }

    .side-stats{
      display:grid;
      grid-template-rows: 1fr 1fr;
      gap:18px;
    }
    .stat{
      background: rgba(255,255,255,.04);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      padding:18px;
      box-shadow: var(--shadow);
      display:flex; flex-direction:column; justify-content:space-between;
      min-height: 150px;
    }
    .stat .kicker{
      color: var(--muted);
      font-weight:700;
      font-size:13px;
      letter-spacing:.2px;
    }
    .stat .value{
      font-size: 34px;
      font-weight:900;
      margin:10px 0 2px;
      letter-spacing:-.5px;
    }
    .stat .sub{
      color: rgba(234,240,255,.80);
      font-size: 13px;
      line-height:1.4;
    }
    .tag{
      display:inline-flex;
      padding:6px 10px;
      border-radius:999px;
      border: 1px solid var(--border);
      background: rgba(255,255,255,.05);
      color: rgba(234,240,255,.86);
      font-size: 12px;
      font-weight:700;
      width:fit-content;
      margin-top:10px;
    }

    /* Sections */
    section{ padding: 28px 0; }
    .section-title{
      display:flex; align-items:flex-end; justify-content:space-between;
      gap:14px; flex-wrap:wrap;
      margin-bottom:14px;
    }
    .section-title h2{
      margin:0;
      font-size: 22px;
      letter-spacing:-.2px;
    }
    .section-title p{
      margin:0;
      color: var(--muted);
      font-size: 14px;
      max-width: 60ch;
      line-height:1.5;
    }


    /* Cards */
    .grid{
      display:grid;
      grid-template-columns: repeat(12, 1fr);
      gap:14px;
    }
    .card{
      grid-column: span 4;
      background: rgba(255,255,255,.04);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      padding:16px;
      box-shadow: var(--shadow);
      display:flex;
      flex-direction:column;
      gap:10px;
      min-height: 190px;
    }
    .card h3{
      margin:0;
      font-size: 16px;
      letter-spacing:-.2px;
    }
    .card p{
      margin:0;
      color: var(--muted);
      font-size: 14px;
      line-height:1.55;
      flex:1;
    }
    .meta{
      display:flex; flex-wrap:wrap; gap:8px;
      align-items:center;
    }
    .chip{
      display:inline-flex; align-items:center; gap:7px;
      padding:6px 10px;
      border-radius: 999px;
      font-weight:800;
      font-size: 12px;
      border: 1px solid var(--border);
      background: rgba(255,255,255,.05);
      color: rgba(234,240,255,.88);
    }
    .chip.accent{ border-color: rgba(77,163,255,.28); background: rgba(77,163,255,.10); }
    .chip.green{ border-color: rgba(34,197,94,.28); background: rgba(34,197,94,.10); }
    .chip.warn{ border-color: rgba(245,158,11,.28); background: rgba(245,158,11,.10); }

    /* Form */
    .panel{
      background: rgba(255,255,255,.04);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      padding: 16px;
      box-shadow: var(--shadow);
    }
    .form-grid{
      display:grid;
      grid-template-columns: repeat(12, 1fr);
      gap:12px;
      margin-top:10px;
    }
    .field{ grid-column: span 6; display:flex; flex-direction:column; gap:8px; }
    .field.full{ grid-column: span 12; }
    label{ font-size: 13px; color: rgba(234,240,255,.90); font-weight:800; }
    input, select, textarea{
      width:100%;
      border-radius: 14px;
      border: 1px solid rgba(255,255,255,.14);
      background: rgba(11,18,32,.55);
      color: var(--text);
      padding: 11px 12px;
      outline:none;
      font-size: 14px;
      transition: .18s ease;
    }
    input:focus, select:focus, textarea:focus{
      border-color: rgba(77,163,255,.55);
      box-shadow: 0 0 0 4px rgba(77,163,255,.12);
    }
    textarea{ min-height: 110px; resize: vertical; }
    .helper{
      display:flex; align-items:center; justify-content:space-between;
      gap:10px; flex-wrap:wrap;
      margin-top:12px;
    }
    .note{
      color: var(--muted);
      font-size: 13px;
      line-height:1.4;
    }

    /* Toast */
    .toast{
      position: fixed;
      right: 16px;
      bottom: 16px;
      width: min(380px, 92vw);
      background: rgba(16,26,49,.92);
      border: 1px solid var(--border);
      border-radius: 16px;
      padding: 12px 12px;
      box-shadow: var(--shadow);
      display:none;
      z-index: 100;
    }
    .toast.show{ display:block; animation: pop .18s ease; }
    @keyframes pop{ from{ transform:translateY(8px); opacity:0; } to{ transform:translateY(0); opacity:1; } }
    .toast .row{ display:flex; align-items:flex-start; gap:10px; }
    .toast .icon{
      width:32px; height:32px; border-radius: 12px;
      display:grid; place-items:center;
      font-weight:900;
      border: 1px solid var(--border);
      background: rgba(255,255,255,.06);
      flex: 0 0 auto;
    }
    .toast .title{ font-weight:900; margin:0; font-size: 14px; }
    .toast .msg{ margin:2px 0 0; color: var(--muted); font-size: 13px; line-height:1.4; }
    .toast .close{
      margin-left:auto;
      background:transparent;
      border:none;
      color: rgba(234,240,255,.8);
      font-size: 16px;
      cursor:pointer;
      padding: 2px 6px;
    }


    /* Inbox */
    .inbox{
      margin-top: 10px;
      display:grid;
      gap:10px;
    }
    .msg-card{
      border: 1px solid var(--border);
      background: rgba(255,255,255,.03);
      border-radius: 16px;
      padding: 12px;
    }
    .msg-card .top{
      display:flex; align-items:center; justify-content:space-between; gap:10px; flex-wrap:wrap;
      margin-bottom:6px;
    }
    .msg-card .who{
      font-weight:900;
      font-size: 13px;
      color: rgba(234,240,255,.92);
    }
    .msg-card .when{
      color: rgba(234,240,255,.70);
      font-size: 12px;
      font-weight:700;
    }
    .msg-card .body{
      margin:0;
      color: var(--muted);
      font-size: 13px;
      line-height:1.55;
      white-space: pre-wrap;
    }
    .msg-actions{
      display:flex; gap:10px; flex-wrap:wrap; align-items:center;
      margin-top: 10px;
    }
    .btn-small{
      padding:10px 12px;
      border-radius: 12px;
      font-size: 13px;
      font-weight:900;
    }
    .btn-danger{
      background: rgba(239,68,68,.16);
      color: rgba(255,220,220,.95);
      border: 1px solid rgba(239,68,68,.28);
    }
    .btn-danger:hover{ background: rgba(239,68,68,.22); }

    /* Footer */
    footer{
      padding: 26px 0 40px;
      color: rgba(234,240,255,.75);
      border-top: 1px solid var(--border);
      margin-top: 22px;
      text-align:center;
    }
    footer small{ color: var(--muted); display:block; margin-top:8px; }

    /* Responsive */
    @media (max-width: 900px){
      .hero-grid{ grid-template-columns: 1fr; }
      .side-stats{ grid-template-rows: auto; grid-template-columns: 1fr 1fr; }
      .card{ grid-column: span 6; }
    }
    @media (max-width: 620px){
      .side-stats{ grid-template-columns: 1fr; }
      .card{ grid-column: span 12; }
      .field{ grid-column: span 12; }
      nav{ justify-content:flex-start; }
    }
  </style>
</head>

<body>
  <header class="topbar">
    <div class="container topbar-inner">
      <div class="brand">
        <div class="logo">ü§ù</div>
        <div>
          <div style="font-size:14px; opacity:.95;">Manos Solidarias</div>
          <div style="font-size:12px; color:var(--muted); font-weight:700;">Ayuda social comunitaria</div>
        </div>
      </div>

      <nav>
        <a class="navlink" href="#inicio">Inicio</a>
        <a class="navlink" href="#programas">Programas</a>
        <a class="navlink" href="#solicitar">Solicitar ayuda</a>
        <a class="navlink" href="#contacto">Contacto</a>
      </nav>
    </div>
  </header>

  <main>
    <!-- HERO -->
    <section class="hero" id="inicio">
      <div class="container hero-grid">
        <div class="hero-card">
          <div class="pill">üåç Comunidad ‚Ä¢ üß° Solidaridad ‚Ä¢ ‚úÖ Transparencia</div>
          <h1>Apoyo social simple, r√°pido y humano.</h1>
          <p>
            Este sitio es un ejemplo de plataforma ligera para conectar donantes, voluntarios y
            personas que necesitan apoyo. Puedes adaptarlo para tu comunidad, ONG o proyecto local.
          </p>

          <div class="cta-row">
            <button class="btn btn-primary" id="btnIrFormulario" type="button">üìù Solicitar ayuda</button>
            <button class="btn btn-green" id="btnDonar" type="button">üí≥ Donar (simulado)</button>
            <button class="btn btn-ghost" id="btnVerMensajes" type="button">üì¨ Ver mensajes</button>
          </div>

          <div style="margin-top:14px; display:flex; gap:10px; flex-wrap:wrap;">
            <span class="chip accent">üîí Datos b√°sicos</span>
            <span class="chip green">üßæ Registro local</span>
            <span class="chip warn">‚ö°Ô∏è 1 archivo</span>
          </div>
        </div>

        <div class="side-stats">
          <div class="stat">
            <div>
              <div class="kicker">Donaciones registradas (demo)</div>
              <div class="value" id="donCount">0</div>
              <div class="sub">Cada click en ‚ÄúDonar‚Äù suma una donaci√≥n simulada.</div>
            </div>
            <div class="tag">üí° Ideal para prototipo</div>
          </div>


          <div class="stat">
            <div>
              <div class="kicker">Solicitudes guardadas (local)</div>
              <div class="value" id="reqCount">0</div>
              <div class="sub">Se guardan en tu navegador (localStorage). No se env√≠a a internet.</div>
            </div>
            <div class="tag">üì¶ Sin backend</div>
          </div>
        </div>
      </div>
    </section>

    <!-- PROGRAMAS -->
    <section id="programas">
      <div class="container">
        <div class="section-title">
          <div>
            <h2>Programas de apoyo</h2>
            <p>Tarjetas simples que puedes editar (texto, √≠conos, requisitos, etc.).</p>
          </div>
        </div>

        <div class="grid">
          <article class="card">
            <div class="meta">
              <span class="chip accent">üç± Alimentaci√≥n</span>
              <span class="chip">‚è±Ô∏è 24‚Äì72h</span>
            </div>
            <h3>Bolsa solidaria</h3>
            <p>Apoyo con alimentos b√°sicos para hogares en situaci√≥n vulnerable, seg√∫n disponibilidad y prioridad.</p>
            <div class="meta">
              <span class="chip">üìç Comunidad</span>
              <span class="chip">‚úÖ Verificaci√≥n</span>
            </div>
          </article>

          <article class="card">
            <div class="meta">
              <span class="chip green">üíä Salud</span>
              <span class="chip">‚è±Ô∏è 48h</span>
            </div>
            <h3>Gesti√≥n de medicinas</h3>
            <p>Orientaci√≥n y coordinaci√≥n para conseguir medicamentos mediante donaciones o alianzas locales.</p>
            <div class="meta">
              <span class="chip">ü§ù Aliados</span>
              <span class="chip">üßæ Soporte</span>
            </div>
          </article>

          <article class="card">
            <div class="meta">
              <span class="chip warn">üéí Educaci√≥n</span>
              <span class="chip">‚è±Ô∏è Semanal</span>
            </div>
            <h3>Kit escolar</h3>
            <p>Entrega de √∫tiles y acompa√±amiento a estudiantes con necesidades econ√≥micas demostrables.</p>
            <div class="meta">
              <span class="chip">üìö √ötiles</span>
              <span class="chip">üßí Ni√±ez</span>
            </div>
          </article>

          <article class="card">
            <div class="meta">
              <span class="chip accent">üõ† Empleo</span>
              <span class="chip">‚è±Ô∏è Mensual</span>
            </div>
            <h3>Orientaci√≥n laboral</h3>
            <p>Apoyo para CV, preparaci√≥n de entrevistas y conexi√≥n con oportunidades locales.</p>
            <div class="meta">
              <span class="chip">üßë‚Äçüíº Mentor√≠a</span>
              <span class="chip">üìå Taller</span>
            </div>
          </article>

          <article class="card">
            <div class="meta">
              <span class="chip green">üè† Hogar</span>
              <span class="chip">‚è±Ô∏è 72h</span>
            </div>
            <h3>Apoyo de emergencia</h3>
            <p>Canal de ayuda r√°pida para situaciones urgentes (servicios, refugio temporal, insumos).</p>
            <div class="meta">
              <span class="chip">üö® Prioridad</span>
              <span class="chip">üìû Contacto</span>
            </div>
          </article>

          <article class="card">
            <div class="meta">
              <span class="chip warn">üß° Voluntariado</span>
              <span class="chip">‚è±Ô∏è Flexible</span>
            </div>
            <h3>Red de voluntarios</h3>
            <p>Registra disponibilidad para donaciones, log√≠stica, visitas, gesti√≥n y eventos comunitarios.</p>
            <div class="meta">
              <span class="chip">üóì Turnos</span>
              <span class="chip">üì¶ Log√≠stica</span>
            </div>
          </article>
        </div>
      </div>
    </section>


    <!-- FORMULARIO -->
    <section id="solicitar">
      <div class="container">
        <div class="section-title">
          <div>
            <h2>Solicitar ayuda</h2>
            <p>Formulario con validaci√≥n b√°sica. Guarda solicitudes en el navegador como demostraci√≥n.</p>
          </div>
        </div>

        <div class="panel">
          <form id="helpForm">
            <div class="form-grid">
              <div class="field">
                <label for="nombre">Nombre y apellido</label>
                <input id="nombre" name="nombre" placeholder="Ej: Mar√≠a P√©rez" autocomplete="name" required />
              </div>

              <div class="field">
                <label for="telefono">Tel√©fono</label>
                <input id="telefono" name="telefono" placeholder="Ej: +58 412 000 0000" autocomplete="tel" required />
              </div>

              <div class="field">
                <label for="tipo">Tipo de ayuda</label>
                <select id="tipo" name="tipo" required>
                  <option value="" selected disabled>Selecciona una opci√≥n</option>
                  <option value="Alimentaci√≥n">üç± Alimentaci√≥n</option>
                  <option value="Salud">üíä Salud</option>
                  <option value="Educaci√≥n">üéí Educaci√≥n</option>
                  <option value="Hogar / Emergencia">üè† Hogar / Emergencia</option>
                  <option value="Orientaci√≥n laboral">üõ† Orientaci√≥n laboral</option>
                  <option value="Otro">üßæ Otro</option>
                </select>
              </div>

              <div class="field">
                <label for="prioridad">Prioridad</label>
                <select id="prioridad" name="prioridad" required>
                  <option value="" selected disabled>Selecciona una prioridad</option>
                  <option value="Alta">üö® Alta</option>
                  <option value="Media">‚ö†Ô∏è Media</option>
                  <option value="Baja">‚úÖ Baja</option>
                </select>
              </div>

              <div class="field full">
                <label for="detalle">Describe tu situaci√≥n</label>
                <textarea id="detalle" name="detalle" placeholder="Cu√©ntanos qu√© ocurri√≥, cu√°ntas personas dependen de ti, qu√© necesitas y c√≥mo podemos ayudarte." required></textarea>
              </div>

              <div class="field full">
                <label>
                  <input type="checkbox" id="consent" />
                  Acepto que esta solicitud se use solo con fines de coordinaci√≥n comunitaria (demo).
                </label>
              </div>
            </div>

            <div class="helper">
              <div class="note">üîé Consejo: si luego agregas backend, aqu√≠ enviar√≠as la info a una API.</div>
              <button class="btn btn-primary" type="submit">‚úÖ Enviar solicitud</button>
            </div>
          </form>

          <div class="msg-actions">
            <button class="btn btn-ghost btn-small" type="button" id="btnExportar">üìÑ Exportar solicitudes (JSON)</button>
            <button class="btn btn-danger btn-small" type="button" id="btnBorrar">üóë Borrar datos guardados</button>
          </div>

          <div class="inbox" id="inbox" aria-live="polite"></div>
        </div>
      </div>
    </section>

    <!-- CONTACTO -->
    <section id="contacto">
      <div class="container">
        <div class="section-title">
          <div>
            <h2>Contacto</h2>
            <p>Datos de ejemplo. Cambia por los tuyos o enlaza a WhatsApp / correo.</p>
          </div>
        </div>


        <div class="panel">
          <div class="grid">
            <div class="card" style="grid-column: span 6;">
              <div class="meta">
                <span class="chip accent">üìß Correo</span>
                <span class="chip">Respuesta: 24‚Äì48h</span>
              </div>
              <h3>Escr√≠benos</h3>
              <p>Correo: <strong>contacto@manossolidarias.org</strong><br/>Tel√©fono: <strong>+00 000 000 0000</strong></p>
              <button class="btn btn-ghost" type="button" id="btnCopiarCorreo">üìã Copiar correo</button>
            </div>

            <div class="card" style="grid-column: span 6;">
              <div class="meta">
                <span class="chip green">üìç Ubicaci√≥n</span>
                <span class="chip">Atenci√≥n local</span>
              </div>
              <h3>Punto comunitario</h3>
              <p>Direcci√≥n: <strong>Tu barrio / tu ciudad</strong><br/>Horario: <strong>L‚ÄìV 9:00‚Äì16:00</strong></p>
              <button class="btn btn-ghost" type="button" id="btnScrollArriba">‚¨ÜÔ∏è Volver arriba</button>
            </div>
          </div>
        </div>
      </div>
    </section>

    <footer>
      <div class="container">
        <div style="font-weight:900;">ü§ù Manos Solidarias</div>
        <small>¬© <span id="year"></span> ‚Äî Sitio demo en HTML/CSS/JS (sin backend). Ajusta libremente.</small>
      </div>
    </footer>
  </main>

  <!-- TOAST -->
  <div class="toast" id="toast" role="status" aria-live="polite">
    <div class="row">
      <div class="icon" id="toastIcon">‚úÖ</div>
      <div style="min-width:0;">
        <p class="title" id="toastTitle">Listo</p>
        <p class="msg" id="toastMsg">Acci√≥n completada.</p>
      </div>
      <button class="close" id="toastClose" aria-label="Cerrar">‚úï</button>
    </div>
  </div>

  <script>
    // ===== Utilidades
    const $ = (sel, root=document) => root.querySelector(sel);
    const $$ = (sel, root=document) => Array.from(root.querySelectorAll(sel));

    const LS_KEYS = {
      donations: "ms_donations",
      requests: "ms_requests"
    };

    function safeJSONParse(value, fallback){
      try { return JSON.parse(value); } catch { return fallback; }
    }

    function formatDate(ts){
      const d = new Date(ts);
      return d.toLocaleString("es-ES", {
        year: "numeric", month: "short", day: "2-digit",
        hour: "2-digit", minute: "2-digit"
      });
    }

    // ===== Toast
    let toastTimer = null;
    function showToast({title, msg, icon="‚úÖ"}){
      const toast = $("#toast");
      $("#toastTitle").textContent = title;
      $("#toastMsg").textContent = msg;
      $("#toastIcon").textContent = icon;

      toast.classList.add("show");
      clearTimeout(toastTimer);
      toastTimer = setTimeout(() => toast.classList.remove("show"), 3800);
    }
    $("#toastClose").addEventListener("click", () => $("#toast").classList.remove("show"));

    // ===== Datos (localStorage)
    function getDonations(){
      return Number(localStorage.getItem(LS_KEYS.donations) || "0");
    }
    function setDonations(n){
      localStorage.setItem(LS_KEYS.donations, String(n));
      renderStats();
    }

    function getRequests(){
      return safeJSONParse(localStorage.getItem(LS_KEYS.requests), []);
    }
    function setRequests(list){
      localStorage.setItem(LS_KEYS.requests, JSON.stringify(list));
      renderStats();
      renderInbox();
    }

    // ===== Render
    function renderStats(){
      $("#donCount").textContent = getDonations();
      $("#reqCount").textContent = getRequests().length;
    }

    function renderInbox(){
      const inbox = $("#inbox");
      const list = getRequests();

      if(list.length === 0){
        inbox.innerHTML = `
          <div class="msg-card">
            <div class="top">
              <div class="who">üì¨ Buz√≥n vac√≠o</div>
              <div class="when">‚Äî</div>
            </div>
            <p class="body">A√∫n no hay solicitudes guardadas. Env√≠a una solicitud desde el formulario para verla aqu√≠.</p>
          </div>
        `;
        return;
      }


      inbox.innerHTML = list
        .slice()
        .reverse()
        .map(item => `
          <div class="msg-card">
            <div class="top">
              <div class="who">${escapeHTML(item.nombre)} ‚Ä¢ ${escapeHTML(item.tipo)} ‚Ä¢ ${badgePriority(item.prioridad)}</div>
              <div class="when">${formatDate(item.ts)}</div>
            </div>
            <p class="body">${escapeHTML(item.detalle)}</p>
            <div class="meta" style="margin-top:10px;">
              <span class="chip">üìû ${escapeHTML(item.telefono)}</span>
              <span class="chip">üßæ ID: ${item.id}</span>
            </div>
          </div>
        `).join("");
    }

    function badgePriority(p){
      if(p === "Alta") return "üö® Alta";
      if(p === "Media") return "‚ö†Ô∏è Media";
      return "‚úÖ Baja";
    }

    function escapeHTML(str){
      return String(str)
        .replaceAll("&","&amp;")
        .replaceAll("<","&lt;")
        .replaceAll(">","&gt;")
        .replaceAll('"',"&quot;")
        .replaceAll("'","&#039;");
    }

    // ===== Interacciones
    $("#btnIrFormulario").addEventListener("click", () => {
      $("#solicitar").scrollIntoView({behavior:"smooth"});
      $("#nombre").focus();
    });

    $("#btnVerMensajes").addEventListener("click", () => {
      $("#inbox").scrollIntoView({behavior:"smooth"});
      showToast({ title:"üì¨ Buz√≥n", msg:"Mostrando solicitudes guardadas en este navegador.", icon:"üì¨" });
    });

    $("#btnDonar").addEventListener("click", () => {
      const next = getDonations() + 1;
      setDonations(next);
      showToast({
        title:"üí≥ Donaci√≥n registrada (demo)",
        msg:"Gracias. En un proyecto real, aqu√≠ integrar√≠as PayPal/Stripe u otra pasarela.",
        icon:"üíö"
      });
    });

    $("#btnCopiarCorreo").addEventListener("click", async () => {
      const email = "contacto@manossolidarias.org";
      try{
        await navigator.clipboard.writeText(email);
        showToast({ title:"üìã Copiado", msg:`${email}`, icon:"üìß" });
      }catch{
        showToast({ title:"No se pudo copiar", msg:"Tu navegador no permiti√≥ el portapapeles.", icon:"‚ö†Ô∏è" });
      }
    });

    $("#btnScrollArriba").addEventListener("click", () => {
      window.scrollTo({ top:0, behavior:"smooth" });
    });

    // ===== Formulario
    $("#helpForm").addEventListener("submit", (e) => {
      e.preventDefault();

      const nombre = $("#nombre").value.trim();
      const telefono = $("#telefono").value.trim();
      const tipo = $("#tipo").value;
      const prioridad = $("#prioridad").value;
      const detalle = $("#detalle").value.trim();
      const consent = $("#consent").checked;

      if(!nombre || nombre.length < 3){
        showToast({ title:"Revisa el nombre", msg:"Ingresa un nombre v√°lido (m√≠nimo 3 caracteres).", icon:"‚ö†Ô∏è" });
        return;
      }
      if(!telefono || telefono.length < 7){
        showToast({ title:"Revisa el tel√©fono", msg:"Ingresa un tel√©fono v√°lido (m√≠nimo 7 caracteres).", icon:"‚ö†Ô∏è" });
        return;
      }
      if(!tipo){
        showToast({ title:"Tipo de ayuda", msg:"Selecciona un tipo de ayuda.", icon:"‚ö†Ô∏è" });
        return;
      }
      if(!prioridad){
        showToast({ title:"Prioridad", msg:"Selecciona una prioridad.", icon:"‚ö†Ô∏è" });
        return;
      }
      if(!detalle || detalle.length < 20){
        showToast({ title:"M√°s detalle", msg:"Describe tu situaci√≥n con al menos 20 caracteres.", icon:"‚ö†Ô∏è" });
        return;
      }
      if(!consent){
        showToast({ title:"Consentimiento", msg:"Marca la casilla para continuar (demo).", icon:"üîí" });
        return;
      }

      const req = {
        id: Math.random().toString(16).slice(2, 8).toUpperCase(),
        ts: Date.now(),
        nombre, telefono, tipo, prioridad, detalle
      };

      const list = getRequests();
      list.push(req);
      setRequests(list);

      e.target.reset();
      showToast({ title:"‚úÖ Solicitud enviada (local)", msg:"Se guard√≥ en este navegador. En producci√≥n, se enviar√≠a a un servidor.", icon:"‚úÖ" });


      $("#inbox").scrollIntoView({behavior:"smooth"});
    });

    // Exportar JSON
    $("#btnExportar").addEventListener("click", () => {
      const data = {
        donations: getDonations(),
        requests: getRequests(),
        exported_at: new Date().toISOString()
      };
      const json = JSON.stringify(data, null, 2);

      // Descargar archivo
      const blob = new Blob([json], { type:"application/json" });
      const url = URL.createObjectURL(blob);
      const a = document.createElement("a");
      a.href = url;
      a.download = "manos-solidarias-export.json";
      document.body.appendChild(a);
      a.click();
      a.remove();
      URL.revokeObjectURL(url);

      showToast({ title:"üìÑ Exportado", msg:"Se descarg√≥ un JSON con donaciones y solicitudes (demo).", icon:"üìÑ" });
    });

    // Borrar localStorage
    $("#btnBorrar").addEventListener("click", () => {
      localStorage.removeItem(LS_KEYS.donations);
      localStorage.removeItem(LS_KEYS.requests);
      renderStats();
      renderInbox();
      showToast({ title:"üóë Datos borrados", msg:"Se eliminaron donaciones y solicitudes guardadas localmente.", icon:"üóë" });
    });

    // ===== Init
    $("#year").textContent = new Date().getFullYear();
    renderStats();
    renderInbox();
  </script>
</body>
</html>

<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>ChispaLive ‚Äî Demo</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
    /* ====== MODELOS ====== */
    .model-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:18px;margin-top:18px}
    .model-card{background:#fff;color:#000;border-radius:14px;overflow:hidden;box-shadow:0 4px 20px rgba(0,0,0,.12);display:flex;flex-direction:column;cursor:pointer;transition:transform .25s ease,box-shadow .25s ease;animation:softFloat 4s ease-in-out infinite}
    .model-card:hover{transform:translateY(-4px) scale(1.02);box-shadow:0 12px 30px rgba(0,0,0,.2)}
    @keyframes softFloat{0%,100%{transform:translateY(0)}50%{transform:translateY(-6px)}}
    .model-slideshow{position:relative;height:200px}
    .model-slideshow img{position:absolute;inset:0;width:100%;height:100%;object-fit:cover;opacity:0;transition:opacity .6s ease}
    .model-slideshow img.active{opacity:1}
    .model-card .info{padding:12px;display:flex;flex-direction:column;gap:6px}
    .model-card .name{font-weight:700;font-size:16px;color:#111}
    .model-card .extra{font-size:12px;color:#555}
    .model-card .desc{font-size:13px;color:#333}
    .model-card .online{display:inline-block;background:#27ae60;color:#fff;font-size:12px;padding:2px 6px;border-radius:6px;margin-left:6px}
    .model-card .actions{display:flex;gap:10px;justify-content:space-between;align-items:center;padding:10px 12px;background:#f7f9fb;border-top:1px solid #eaeef3}
    .action-btn{display:flex;align-items:center;gap:8px;padding:8px 12px;border-radius:10px;border:1px solid #e0e6ee;background:#fff;cursor:pointer;transition:.2s;font-weight:600;font-size:13px;color:#222}
    .action-btn:hover{transform:translateY(-2px);box-shadow:0 6px 16px rgba(0,0,0,.08)}
    .action-btn img{width:18px;height:18px;display:block}
    .like-badge{background:#ff2e6a;color:#fff;font-size:12px;padding:2px 8px;border-radius:999px}

    /* ====== GENERALES ====== */
    *{box-sizing:border-box}html,body{height:100%}
    body{margin:0;font-family:Poppins,system-ui,sans-serif;background:#0b1220;color:#e9f6ff;overflow-x:hidden}
    .container{max-width:1100px;margin:20px auto;padding:16px} /* margen extra para m√≥vil */
    .header{position:sticky;top:0;z-index:50;background:rgba(10,18,32,.85);backdrop-filter:blur(6px);border-bottom:1px solid #132338}
    .header-inner{display:flex;justify-content:space-between;align-items:center;padding:12px 16px}
    .brand{display:flex;align-items:center;gap:10px;font-weight:700}
    nav.topnav{display:flex;gap:10px;align-items:center;flex-wrap:wrap} /* evita desorden cuando aparece VIP */
    .btn{border:0;padding:8px 12px;border-radius:10px;font-weight:600;cursor:pointer;transition:.15s;font-size:14px}
    .btn:active{transform:translateY(1px)}
    .btn-primary{background:#ff2e6a;color:#fff}
    .btn-ghost{background:transparent;color:#cfe7ff;border:1px solid #244362}
    .btn-warning{background:#ffb020;color:#1b1407}
    .input{width:100%;background:#0e192a;color:#d9eeff;border:1px solid #1f3550;border-radius:12px;padding:10px 12px}
    .card{background:#0f1a2b;border:1px solid #1b3150;border-radius:18px;padding:16px;box-shadow:0 10px 32px rgba(0,0,0,.35)}
    .small{color:#9bc2df;font-size:12px}
    .view{display:none}.view.active{display:block}

    /* ====== MONEDAS CON ICONO ====== */
    .coin-icon { width: 18px; height: 18px; margin-right: 5px; vertical-align: middle; }
    
    /* ====== BANNER ====== */
    .banner-wrap{position:relative;margin-top:8px}
    .banner-wrap video{width:100%;max-height:180px;object-fit:cover;border-radius:14px;display:block}
    .live-badge{position:absolute;top:12px;left:12px;background:#001f99;color:#fff;font-weight:700;font-size:14px;padding:6px 12px;border-radius:10px;animation:pulse 1.5s infinite;box-shadow:0 0 8px rgba(0,0,0,.4)}
    @keyframes pulse{0%{transform:scale(1);opacity:1}50%{transform:scale(1.1);opacity:.85}100%{transform:scale(1);opacity:1}}

    /* ====== CHAT ====== */
    .chat-card{height:calc(100vh - 80px);display:flex;flex-direction:column}
    .chat-head{display:flex;align-items:center;gap:10px;border-bottom:1px solid #1b3150;padding:10px;background:#0f1a2b}
    .chat-head .name{font-weight:700}
    .chat-body{flex:1;overflow:auto;display:flex;flex-direction:column;gap:8px;padding:10px 2px}
    .msg{max-width:70%;padding:10px 14px;border-radius:18px;line-height:1.35;font-size:15px;animation:floatIn .25s ease}
    .msg.you{align-self:flex-end;background:#12253c}
    .msg.them{align-self:flex-start;background:#0c1728}
    .msg .meta{margin-top:6px;font-size:11px;color:#86a9c7}
    .typing{color:#99c7ff;font-size:12px;padding:6px 0;display:none}
    .typing.on{display:block}
    .chat-input{display:flex;gap:8px;align-items:center;padding:10px;border-top:1px solid #1b3150;background:#0f1a2b}
    .chat-input .input{flex:1}
    .emoji-vip{display:flex;gap:6px;flex-wrap:wrap}
    @keyframes floatIn{from{opacity:0;transform:translateY(8px)}to{opacity:1;transform:translateY(0)}}

    /* ====== MODALES ====== */
    .modal{position:fixed;inset:0;background:rgba(0,0,0,.55);display:none;place-items:center;z-index:1000}
    .modal.show{display:grid}
    .modal .content{background:#0f1a2b;border:1px solid #1b3150;border-radius:18px;padding:16px;width:min(520px,92vw);box-shadow:0 24px 60px rgba(0,0,0,.45)}

    /* ====== INTERSTITIAL PREVIO ====== */
    .interstitial{position:fixed;inset:0;background:rgba(0,0,0,.75);display:none;place-items:center;z-index:2000}
    .interstitial.show{display:grid}
    .interstitial .inner{background:#0f1a2b;border:1px solid #1b3150;border-radius:18px;overflow:hidden;width:min(640px,95vw)}
    .interstitial .bar{display:flex;justify-content:space-between;align-items:center;padding:8px 12px;border-top:1px solid #1b3150}
    .countdown{font-size:12px;opacity:.8;margin-right:auto;margin-left:8px}
  </style>
</head>
<body>
  <!-- HEADER -->
  <header class="header">
    <div class="header-inner container">
      <div class="brand">
        <img id="appLogo" src="https://qu.ax/PyOjt.png" alt="Logo" style="height:36px;border-radius:8px;object-fit:contain">
        <span>ChispaLive</span>
      </div>
      <nav class="topnav">
        <span id="vipBadge" class="small" style="display:none;background:#ffd54d;color:#1e1600;padding:4px 8px;border-radius:999px;font-weight:700">VIP ‚ú®</span>
        <button class="btn btn-ghost" id="btnDaily">üéÅ MISIONES DIARIAS</button> <!-- cambio de "Bono diario" -->
        <button class="btn btn-primary" id="btnStore">üí≥ Tienda</button>
        <div style="margin-left:6px">
          <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/6/69/Coin_icon_3.svg/2048px-Coin_icon_3.svg.png" class="coin-icon" alt="Monedas">
          <b id="coinsLabel">0</b>
        </div>
      </nav>
    </div>
  </header>

  <main class="container">
    <!-- BANNER VIDEO -->
    <div class="banner-wrap">
      <a id="bannerLink" href="https://ejemplo.com" target="_blank" rel="noopener">
        <video autoplay muted loop playsinline>
          <source src="https://qu.ax/dMvpz.mp4" type="video/mp4">
          Tu navegador no soporta video.
        </video>
        <div class="live-badge">üî¥ En directo</div>
      </a>
    </div>

    <!-- LISTA DE MODELOS -->
    <section id="view-chat" class="view active">
      <h3>Modelos</h3>
      <div class="model-grid" id="chatList"></div>
    </section>

    <!-- CHAT -->
    <section id="view-conversation" class="view">
      <div class="card chat-card">
        <div class="chat-head">
          <button class="btn btn-ghost" id="btnBack">‚Üê Volver</button>
          <img id="chatAvatar" src="" style="width:40px;height:40px;border-radius:50%;object-fit:cover">
          <div>
            <div id="chatName" class="name"></div>
            <small id="chatStatus" class="small">En l√≠nea</small>
          </div>
          <div style="margin-left:auto" class="small">Monedas: <b id="coinsLabel2">0</b></div>
        </div>
        <div class="chat-body" id="messages"></div>
        <div class="typing" id="typingHint">Est√° escribiendo‚Ä¶</div>
        <div class="chat-input">
          <input class="input" id="msgText" placeholder="Escribe un mensaje (2 monedas / ilimitado si VIP)"/>
          <div class="emoji-vip" id="vipEmojis" title="Emojis VIP (requiere VIP)" style="display:none">
            <button class="btn btn-ghost" data-emoji="üíã">üíã</button>
            <button class="btn btn-ghost" data-emoji="üî•">üî•</button>
            <button class="btn btn-ghost" data-emoji="üíé">üíé</button>
          </div>
          <button class="btn btn-primary" id="btnSend">Enviar</button>
        </div>
      </div>
    </section>
  </main>

  <!-- MODAL RECARGA / VIP UPSALE -->
  <div id="rechargeModal" class="modal">
    <div class="content">
      <h3 style="margin:0 0 6px">Sin monedas üò¢</h3>
      <p class="small">Cada mensaje cuesta <b>2</b> moneditas.</p>
      <div style="display:flex;gap:8px;flex-wrap:wrap;margin-bottom:8px">
        <button class="btn btn-primary" id="btnBuy20">Comprar 20</button>
        <button class="btn btn-primary" id="btnBuy50">Comprar 50</button>
        <button class="btn btn-primary" id="btnBuy100">Comprar 100</button>
        <button class="btn btn-warning" id="btnWatchAd">Ver anuncio (+10)</button>
      </div>
      <div class="card" style="margin-top:8px">
        <b>üíé Suscr√≠bete VIP y chatea sin l√≠mites</b>
        <div style="display:flex;gap:8px;flex-wrap:wrap;margin-top:8px">
          <button class="btn btn-ghost" data-vip="24h">VIP 24h - $4</button>
          <button class="btn btn-ghost" data-vip="7d">VIP 1 semana - $15</button>
          <button class="btn btn-ghost" data-vip="30d">VIP 1 mes - $30</button>
        </div>
      </div>
      <div style="margin-top:10px"><button class="btn btn-ghost" id="btnCloseModal">Cerrar</button></div>
    </div>
  </div>

  <!-- MODAL TIENDA (con PayPal) -->
  <div id="storeModal" class="modal">
    <div class="content">
      <h3 style="margin:0 0 6px">Tienda</h3>
      <p class="small">Activa VIP con PayPal o compra monedas.</p>
      <div class="card" style="margin-top:8px">
        <b>üíé VIP con PayPal</b>
        <div class="small" style="opacity:.85;margin:6px 0 10px">Selecciona un plan:</div>
        <div id="paypal24h"></div>
        <div id="paypal7d" style="margin-top:8px"></div>
        <div id="paypal30d" style="margin-top:8px"></div>
      </div>
      <div class="card" style="margin-top:12px">
        <b>ü™ô Monedas r√°pidas</b>
        <div style="display:flex;gap:8px;flex-wrap:wrap;margin-top:8px">
          <button class="btn btn-primary" id="sBuy50">50 monedas</button>
          <button class="btn btn-primary" id="sBuy150">150 monedas</button>
          <button class="btn btn-primary" id="sBuy400">400 monedas</button>
        </div>
      </div>
      <div style="margin-top:10px"><button class="btn btn-ghost" id="btnCloseStore">Cerrar</button></div>
    </div>
  </div>

  <!-- INTERSTITIAL PREVIO AL CHAT -->
  <div id="interstitialOverlay" class="interstitial">
    <div class="inner">
      <script>window.peblqx=window.peblqx||function(){};</script>
      <script data-cfasync="false" data-clipid="2086017" async src="//detoxifylagoonsnugness.com/in.js" onerror="peblqx(17)" onload="peblqx(17)"></script>
      <div class="bar">
        <span class="small">Publicidad ‚Äî Interstitial</span>
        <span class="countdown" id="interCounter">Esperando‚Ä¶</span>
        <button id="closeInterstitial" class="btn btn-ghost" style="display:none">Cerrar</button>
      </div>
    </div>
  </div>

  <script type="module">
    /* ================= CONFIG ICONOS ================= */
    const FACEBOOK_ICON_URL = "https://cdn-icons-png.flaticon.com/512/124/124010.png"; // cambiar si deseas
    const PRIVATE_ICON_URL  = "https://cdn-icons-png.flaticon.com/512/747/747376.png"; // cambiar icono de privadas

    /* ================= ECONOM√çA / ESTADO ================= */
    const START_COINS=50, COIN_PER_MSG=2, DAILY_BONUS=10;
    const coinsLabel=document.getElementById('coinsLabel'), coinsLabel2=document.getElementById('coinsLabel2');
    const vipBadge=document.getElementById('vipBadge'), vipEmojis=document.getElementById('vipEmojis');
    let session=JSON.parse(localStorage.getItem('session')||'{}'); if(!session.alias){session={alias:'Usuario',coins:START_COINS};saveSession();}
    updateCoins(0);
    let membership=JSON.parse(localStorage.getItem('membership')||'null'); paintVIP();

    function saveSession(){localStorage.setItem('session',JSON.stringify(session))}
    function updateCoins(d){session.coins=Math.max(0,(session.coins||0)+d);saveSession();coinsLabel.textContent=session.coins;coinsLabel2.textContent=session.coins}
    function isVIP(){return membership && Date.now()<membership.until}
    function setVIP(duration){
      const now=Date.now(); 
      const add=duration==='24h'?24*3600e3:duration==='7d'?7*24*3600e3:30*24*3600e3; 
      membership={until:now+add}; 
      localStorage.setItem('membership',JSON.stringify(membership)); paintVIP();
    }

    function paintVIP(){
      const on=isVIP();
      vipBadge.style.display=on?'inline-block':'none'; 
      vipEmojis.style.display=on?'flex':'none';
    }

    /* ================= INTERSTITIAL PREVIO AL CHAT ================= */
    const interstitial=document.getElementById('interstitialOverlay');
    const closeInterstitial=document.getElementById('closeInterstitial');
    const interCounter=document.getElementById('interCounter');
    let nextModel=null, interTimer=null;

    function showInterstitialBeforeChat(m){
      nextModel=m; 
      interstitial.classList.add('show');
      closeInterstitial.style.display='none'; 
      let sec=6;
      interCounter.textContent=`Cierra disponible en ${sec}s`; 
      clearInterval(interTimer);
      interTimer=setInterval(()=>{ sec--; 
        if(sec>0){
          interCounter.textContent = `Cierra disponible en ${sec}s`;
        }else{
          clearInterval(interTimer);
          interCounter.textContent = '';
          closeInterstitial.style.display = 'inline-block';
        }
      },1000);
    }

    closeInterstitial.onclick = () => {
      interstitial.classList.remove('show');
      if(nextModel){
        openChatWith(nextModel); 
        nextModel = null; 
      }
    };

    /* ================= FACEBOOK MISSIONS ================= */
    const fbMissionDiv = document.getElementById('missions');
    const fbMissionBtns = `
    <button class="btn btn-ghost" data-mission="facebook1">Seguir cuenta 1</button>
    <button class="btn btn-ghost" data-mission="facebook2">Seguir cuenta 2</button>
    <button class="btn btn-ghost" data-mission="facebook3">Seguir cuenta 3</button>
    `;
    fbMissionDiv.innerHTML = fbMissionBtns;

    /* Add listener to Missions buttons */
    document.querySelectorAll('[data-mission]').forEach(btn => {
      btn.onclick = () => {
        updateCoins(20);
        alert('Misi√≥n completada: 20 monedas');
      }
    });

    /* ================= MODELOS Firestore ================= */
    const chatList = document.getElementById('chatList');
    async function renderModels(){
      chatList.innerHTML = '';
      const snap = await getDocs(collection(db, "models"));
      snap.forEach(docSnap => {
        const m = { id: docSnap.id, ...docSnap.data() };
        const card = document.createElement('div');
        card.className = 'model-card';
        const slideId = 'slide_' + m.id;
        const pub = (m.photos || []).slice(0, 3);
        const priv = (m.photos || []).slice(3, 5);
        const fbUrl = m.facebook || FACEBOOK_FALLBACK_URL;

        card.innerHTML = `
          <div class="model-slideshow" id="${slideId}">
            ${pub.map((src, i) => `<img src="${src}" class="${i === 0 ? 'active' : ''}" alt="">`).join('')}
          </div>
          <div class="info">
            <div class="name">${m.name} <span class="online">‚óè Online</span></div>
            <div class="extra">${m.age || '‚Äî'} a√±os ¬∑ ${m.country || '‚Äî'}</div>
            <div class="desc">${m.desc || ''}</div>
          </div>
          <div class="actions">
            <button class="action-btn btn-like">
              <img src="https://qu.ax/hlsxX.png" alt="like"><span>Me gusta</span>
              <span class="like-badge">${m.likes || 0}</span>
            </button>
            <button class="action-btn btn-priv">
              <img src="${PRIVATE_ICON_URL}" alt="priv"><span>Ver privadas</span>
            </button>
            <button class="action-btn btn-fb">
              <img src="${FACEBOOK_ICON_URL}" alt="fb"><span>Facebook</span>
            </button>
            <button class="action-btn btn-msg">
              <img src="https://qu.ax/jGSiu.png" alt="mensaje"><span>Mensaje</span>
            </button>
          </div>
        `;

        card.querySelector('.btn-fb').onclick = (e) => {
          e.stopPropagation();
          window.open(fbUrl, '_blank');
        };
        chatList.appendChild(card);
      });
    }
  </script>

</body>
</html>

<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Rifas â€” Tu Diamante</title>

  <!-- Fuente Sans Serif (bold/extra-bold) -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@700;800&display=swap" rel="stylesheet">
  <!-- Tel input (banderas y cÃ³digo de paÃ­s) -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/intl-tel-input@19.5.6/build/css/intlTelInput.css" />

  
  <style>
  :root{
    --bg:#ffffff; 
    --ink:#111827; 
    --muted:#6b7280; 
    --accent:#0A4975;     /* color pedido */
    --border:#e5e7eb; 
    --chip:#f3f4f6; 
    --warn:#ef4444;
    /* diamante translÃºcido para vendidos y â€œMis boletosâ€ */
    --diamond-url: url('https://qu.ax/zcmdn.png');
  }

  .big-diamond {
    width:120px;
    height:120px;
    display:flex;
    align-items:center;
    justify-content:center;
    color:#ffffff;   /* ðŸ‘ˆ ahora los nÃºmeros se ven en blanco */
    font-size:20px;
    font-weight:800;
    background-image:var(--diamond-url);
    background-size:cover;
    background-position:center;
    border-radius:16px;
    box-shadow:0 8px 18px rgba(0,0,0,.12);
  }

    }

    html,body{height:100%}
    body{margin:0; background:var(--bg); color:var(--ink); font-family:"Inter",system-ui,sans-serif; font-weight:800;}

    .container{max-width:1200px; margin:0 auto; padding:16px; display:flex; flex-direction:column; align-items:center;}

    /* Header SOLO logo */
    .app-title{display:flex; justify-content:center; margin:20px 0 10px;}
    .app-title img{width:140px; height:140px; border-radius:50%; object-fit:cover;}

    /* Progreso */
    .progress-info{display:flex; flex-direction:column; align-items:center; gap:8px; margin:8px 0 20px; width:100%;}
    .bar{height:14px; background:#f3f4f6; border-radius:999px; overflow:hidden; border:1px solid var(--border); width:min(640px,100%);} 
    .bar>span{display:block; height:100%; background:var(--accent); width:0%; transition:width 1s ease-in-out;}
    .progress-stats{color:var(--muted); font-size:14px; font-weight:700; text-align:center;}

    /* Layout */
    .grid-layout{display:grid; grid-template-columns:1fr; gap:16px; width:100%;}
    @media(min-width:1024px){ .grid-layout{ grid-template-columns:2fr 1fr; } }

    .panel{background:#fff; border:1px solid var(--border); border-radius:16px; padding:16px; width:100%; text-align:center;}
    .panel h2{margin:0 0 12px 0; font-size:28px; text-transform:uppercase; color:var(--accent);}
    .subtle{color:var(--muted); font-size:14px;}

/* Contenedor de la secciÃ³n "Lista de boletos" */
.tickets-panel {
  max-width: 900px;    /* ancho mÃ¡ximo */
  margin: 0 auto;      /* centrado horizontal */
}

/* TÃ­tulo "Lista de boletos" */
.tickets-panel h2 {
  font-size: 48px;     /* ðŸ‘ˆ cambia este nÃºmero para ajustar el tamaÃ±o */
  color: #0A4975;      /* azul que ya usas en tu tema */
  text-align: center;  /* centrado */
  margin-bottom: 16px; /* espacio debajo del tÃ­tulo */
}
/* Ajuste para tablets y pantallas medianas */
@media (max-width: 768px) {
  .tickets-panel h2 {
    font-size: 26px;
  }
}

/* Ajuste para celulares pequeÃ±os */
@media (max-width: 480px) {
  .tickets-panel h2 {
    font-size: 22px;
  }
}

    .tickets-toolbar{display:flex; flex-wrap:wrap; justify-content:center; align-items:center; gap:10px; margin-bottom:10px;}
    .search{position:relative; flex:1 1 280px; max-width:420px;}
    .search input{width:100%; border:1px solid var(--border); border-radius:999px; padding:12px 40px; font-size:14px; outline:none; text-align:center; font-weight:800;}
    .search svg{position:absolute; left:12px; top:50%; transform:translateY(-50%);} 

    .page-controls{display:flex; gap:6px; align-items:center; justify-content:center;}
    .btn{border:1px solid var(--border); background:#fff; border-radius:12px; padding:10px 14px; font-weight:800; cursor:pointer; transition:.2s;}
    .btn:hover{transform:translateY(-1px);} 
    .btn.primary{background:var(--accent); color:#fff; border-color:var(--accent);} 
    .btn.secondary{background:#f8fafc;}
    .btn[disabled]{opacity:.6; cursor:not-allowed;}

   /* Mejor scroll y apariencia del cuadrado */
.square-wrap{
  width:100%; 
  max-width:780px; 
  aspect-ratio:1/1; 
  border:2px solid var(--border); 
  border-radius:20px; 
  overflow:hidden; 
  display:flex; 
  margin:0 auto; 
  box-shadow:0 4px 15px rgba(0,0,0,0.08);
}
    .ticket-grid{display:grid; grid-template-columns: repeat(6,1fr); gap:6px; padding:10px;}
    @media(min-width:480px){ .ticket-grid{ grid-template-columns: repeat(8,1fr);} }
    @media(min-width:768px){ .ticket-grid{ grid-template-columns: repeat(10,1fr);} }
    @media(min-width:1024px){ .ticket-grid{ grid-template-columns: repeat(12,1fr);} }

   /* Boleto con estilo moderno */
.ticket{
  position:relative; 
  user-select:none; 
  text-align:center; 
  padding:10px 0; 
  border:1px solid var(--border); 
  border-radius:12px; 
  background:#fff; 
  font-weight:800; 
  font-size:14px; 
  cursor:pointer; 
  transition:transform 0.15s ease, box-shadow 0.15s ease;
  color:#0A4975; 
}
    }
    .ticket:hover{
  background:#f0f9ff;
  transform:translateY(-2px); 
  box-shadow:0 4px 10px rgba(0,0,0,0.1);
}

    .ticket:active{
  transform:scale(0.9); /* ðŸ‘ˆ animaciÃ³n al click */
  box-shadow:0 2px 6px rgba(0,0,0,0.2);
}
    .ticket.sold{color:#0b1e2a; border-color:#c7e3f7; background:#eaf6ff; cursor:not-allowed;}
    .ticket.sold::after{content:""; position:absolute; inset:2px; background-image:var(--diamond-url); background-size:contain; background-position:center; background-repeat:no-repeat; opacity:.45; border-radius:8px;}
    .ticket.selected{background:#dbeafe; border-color:#bfdbfe;}

    .chips{display:flex; flex-wrap:wrap; gap:8px; margin-top:8px; justify-content:center;}
    .chip{display:inline-flex; align-items:center; gap:6px; background:var(--chip); border:1px solid var(--border); border-radius:999px; padding:6px 10px; font-weight:800;}
    .chip button{border:none; background:transparent; cursor:pointer; font-size:16px; line-height:1;}

    .totals{display:flex; flex-wrap:wrap; gap:10px; align-items:center; justify-content:center; margin-top:10px;}
    .tag{background:#eef2ff; color:#3730a3; border:1px solid #e0e7ff; border-radius:999px; padding:6px 10px;}

    .note{margin-top:8px; font-size:14px; color:#0f172a;}
    .note.warn{color:#b91c1c;}

    /* Formulario */
    .form{display:grid; gap:10px; grid-template-columns:1fr;}
    @media(min-width:640px){ .form{ grid-template-columns:1fr 1fr; } }
    .field{display:flex; flex-direction:column; gap:6px; align-items:center;}
    .field label{font-weight:800;}
    .field input, .field select{width:100%; max-width:480px; border:1px solid var(--border); border-radius:12px; padding:10px 12px; font-size:14px; outline:none; font-weight:700; text-align:center;}

    .pay-methods{display:flex; gap:10px; flex-wrap:wrap; justify-content:center;}
    .pm-card{flex:1 1 200px; max-width:320px; border:1px solid var(--border); border-radius:14px; padding:12px; cursor:pointer; display:flex; align-items:center; gap:10px; justify-content:center;}
    .pm-card.active{outline:2px solid var(--accent);} 
    .pm-card img{width:28px; height:28px; object-fit:contain;}
    .pm-details{background:#f8fafc; border:1px dashed var(--border); border-radius:12px; padding:12px;}

    /* Diamantes (mis boletos) */
    .big-diamonds{display:flex; flex-wrap:wrap; gap:18px; justify-content:center;}
    .big-diamond{width:120px; height:120px; display:flex; align-items:center; justify-content:center; color:#0b1e2a; font-size:20px; font-weight:800; background-image:var(--diamond-url); background-size:cover; background-position:center; border-radius:16px; box-shadow:0 8px 18px rgba(0,0,0,.12);}
    .mytickets-cta{display:none; margin-top:12px; text-align:center;}

    /* Footer */
    .site-footer{margin-top:22px; width:100%;}
    .contact{background:#ffffff; color:#111; border:1px solid var(--border); border-radius:16px; padding:18px; display:grid; gap:14px; justify-items:center;}
    .contact h3{margin:0; text-transform:uppercase; letter-spacing:1px; font-size:18px;}
    .row{display:flex; flex-wrap:wrap; gap:14px; align-items:center; justify-content:center;}
    .row a{display:inline-flex; align-items:center; gap:8px; text-decoration:none; color:#111; font-weight:800; border:1px solid var(--border); padding:10px 14px; border-radius:999px;}
    .row a:hover{background:#f9fafb;} 
    .row img{width:20px; height:20px; object-fit:contain;}
/* Premios */
.prizes {
  margin: 20px auto;
  text-align: center;
  background: #fff;
  border: 1px solid var(--border);
  border-radius: 16px;
  padding: 16px;
  max-width: 600px;
}
.prizes h2 {
  display: flex;
  justify-content: center;
  align-items: center;
  gap: 8px;
  margin: 0 0 12px;
  font-size: 26px;
  color: var(--accent);
  text-transform: uppercase;
}
.prizes h2 .emoji {
  width: 28px;
  height: 28px;
}
.prizes ul {
  list-style: none;
  padding: 0;
  margin: 0;
}
.prizes li {
  margin: 6px 0;
  font-size: 16px;
  font-weight: 800;
  color: var(--ink);
}

    
  </style>
</head>
<body>
  <div class="container">
    <!-- Header SOLO logo centrado -->
    <header class="app-title">
      <img src="https://qu.ax/OVJvi.png" alt="Logo redondo">
    </header>

    <!-- Progreso de ventas -->
    <section class="progress-info">
      <div class="bar"><span id="soldBar"></span></div>
      <div class="progress-stats">Vendidos: <b id="soldCount">0</b> / 10.000 â€” <b id="soldPct">0%</b></div>
    </section>
    <!-- Premios -->
<section class="prizes">
  <h2>
    <img src="https://qu.ax/KrgNZ.png" alt="emoji" class="emoji">
    Premios
  </h2>
  <ul>
    <li><b>1er premio:</b> 1PM â€” 10.000 Bs</li>
    <li><b>2do premio:</b> 4PM â€” 10.000 Bs</li>
    <li><b>3er premio:</b> 10PM â€” 30.000 Bs</li>
  </ul>
</section>


    <div class="grid-layout">
      <!-- LISTA -->
      <section class="panel tickets-panel">
        <h2>Lista de boletos</h2>
        <div class="subtle">PÃ¡gina 1 por defecto (0000â€“1999). Hay 5 pÃ¡ginas.</div>
        <div class="tickets-toolbar">
          <!-- Buscar con Enter (mÃ³vil/PC) -->
          <form id="searchForm" class="search" autocomplete="off">
            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.3-4.3"/></svg>
            <input id="searchInput" type="search" inputmode="numeric" pattern="\d*" enterkeyhint="search" maxlength="4" placeholder="Escribe nÃºmero y ENTER" />
          </form>
          <div class="page-controls">
            <span class="subtle">PÃ¡gina:</span>
            <div id="pagination"></div>
          </div>
        </div>
        <div class="square-wrap">
          <div class="square-inner">
            <div id="tickets" class="ticket-grid" aria-live="polite"></div>
          </div>
        </div>
        <div class="totals">
          <span class="tag">Precio: <b>15 Bs</b></span>
          <span class="tag">Seleccionados: <b id="selCount">0</b></span>
          <span class="tag">Total: <b id="totalAmount">0 Bs</b></span>
          <button id="btnRandom" class="btn primary" title="Generar 3 boletos a la suerte">ðŸŽ² Generar aleatorios</button>
        </div>
        <div id="minMsg" class="note warn" style="display:none;">Compra mÃ­nima 3 boletos.</div>
        <div class="mytickets-cta" id="myTicketsCta">
          <button class="btn secondary" id="btnSeeMine">Ver mis boletos</button>
        </div>
        <div id="selectedChips" class="chips"></div>
      </section>

      <!-- FORMULARIO -->
      <section class="panel">
        <h2>Datos personales & pago</h2>
        <form id="buyForm" class="form" autocomplete="off">
          <div class="field">
            <label for="name">Nombre y apellido</label>
            <input id="name" type="text" placeholder="Ej: Ana PÃ©rez" required />
          </div>
          <div class="field">
            <label for="idnum">CÃ©dula</label>
            <input id="idnum" type="text" placeholder="V-12345678" required />
          </div>
          <div class="field" style="grid-column:1 / -1;">
            <label for="phone">TelÃ©fono</label>
            <input id="phone" type="tel" placeholder="Ingresa tu nÃºmero" required />
          </div>
          <div class="field">
            <label for="ref6">Ãšltimos 6 dÃ­gitos de la referencia</label>
            <input id="ref6" type="text" inputmode="numeric" maxlength="6" placeholder="Ej: 123456" required />
          </div>
          <div class="field">
            <label for="proof">Comprobante de pago</label>
            <input id="proof" type="file" accept="image/*,application/pdf" required />
          </div>

          <div class="field" style="grid-column:1 / -1;">
            <label>MÃ©todos de pago</label>
            <div class="pay-methods" id="payMethods"></div>
          </div>
          <div id="payDetails" class="pm-details" style="display:none;"></div>

          <div style="grid-column:1 / -1; display:flex; gap:10px; align-items:center; justify-content:center;">
            <button type="button" id="btnConfirm" class="btn primary">Confirmar compra</button>
          </div>
        </form>
      </section>
    </div>

    <!-- MIS BOLETOS (diamantes) -->
    <section class="panel" id="myTicketsPanel" style="display:none; margin-top:16px;">
      <h2>Mis boletos</h2>
      <div id="myTicketsInfo" class="subtle" style="margin-bottom:8px;"></div>
      <div id="myDiamonds" class="big-diamonds"></div>
    </section>

    <!-- Verificador -->
    <section class="panel" style="margin-top:16px;">
      <h2>Verificador de boletos</h2>
      <div class="subtle" style="margin-bottom:8px;">Busca por telÃ©fono (con cÃ³digo) o por boleto (0000â€“9999).</div>
      <div style="display:flex; gap:8px; flex-wrap:wrap; justify-content:center;">
        <input id="verifyInput" style="flex:1 1 260px; max-width:480px; border:1px solid var(--border); border-radius:12px; padding:10px 12px; font-weight:700; text-align:center;" placeholder="TelÃ©fono o nÃºmero de boleto" />
        <button id="btnVerify" class="btn secondary" type="button">ðŸ”Ž Verificar</button>
      </div>
      <div id="verifyOut" style="margin-top:10px;"></div>
    </section>

    <!-- CONTACTO -->
    <section class="site-footer">
      <div class="contact">
        <h3>Contacto</h3>
        <div class="row">
          <a id="waLink" href="#" target="_blank" rel="noopener">
            <img id="waIcon" alt="WhatsApp" /> WhatsApp
          </a>
        </div>
        <h3>SÃ­guenos</h3>
        <div class="row">
          <a id="fbLink" href="#" target="_blank" rel="noopener"><img id="fbIcon" alt="Facebook" /> Facebook</a>
          <a id="igLink" href="#" target="_blank" rel="noopener"><img id="igIcon" alt="Instagram" /> Instagram</a>
        </div>
      </div>
    </section>
  </div>

  <!-- Scripts -->
  <script src="https://cdn.jsdelivr.net/npm/intl-tel-input@19.5.6/build/js/intlTelInput.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/intl-tel-input@19.5.6/build/js/utils.js"></script>
  <script>
    /* ==========================
       CONFIG editable (logos, enlaces, pagos)
       ========================== */
    const PRICE_PER_TICKET = 15;         // Bs
    const TOTAL_TICKETS    = 10000;      // 0000-9999
    const PAGE_SIZE = 1000;      // 1000 por pÃ¡gina (10 pÃ¡ginas)

    // Enlaces de contacto (cÃ¡mbialos por los tuyos)
    const WA_URL = 'https://wa.me/5842489117690';
    const FB_URL = 'https://facebook.com/tu_pagina';
    const IG_URL = 'https://instagram.com/tu_pagina';

    // Logos por URL (personalizables)
    const WA_ICON_URL = 'https://upload.wikimedia.org/wikipedia/commons/6/6b/WhatsApp.svg';
    const FB_ICON_URL = 'https://upload.wikimedia.org/wikipedia/commons/0/05/Facebook_Logo_%282019%29.png';
    const IG_ICON_URL = 'https://upload.wikimedia.org/wikipedia/commons/a/a5/Instagram_icon.png';

    // MÃ©todos de pago (logos + datos)
    const PAYMENT_METHODS = [
      {
        key: 'pago_movil_ve',
        name: 'Pago mÃ³vil Venezuela',
        logo: 'https://files.mastodon.social/accounts/avatars/001/178/677/original/1743e1395952db77.jpg',
        details: ['Banco: 0102', 'TelÃ©fono: 0424-8417632', 'CÃ©dula/RIF: V-31490382', 'Titular: Angel Zabala']
      },
      {
        key: 'pago_movil_banesco',
        name: 'Pago mÃ³vil Banesco',
        logo: 'https://play-lh.googleusercontent.com/JP3qF5hwz0z7z-d2PEu21dhtdb7EBlC-5XKAuE0e2zLUAjWca-ePijvcb-nAQGAa9Ng=w480-h960-rw',
        details: ['Banco: 0134', 'TelÃ©fono: 0414-8516619', 'CÃ©dula/RIF: V-14884043', 'Titular: Iraima Jimenez']
      },
      {
        key: 'binance',
        name: 'Binance',
        logo: 'https://upload.wikimedia.org/wikipedia/commons/5/57/Binance_Logo.png',
        details: ['Correo: angelitojavier277@gmail.com']
      }
    ];

    /* ==========================
       Estado + storage
       ========================== */
    const el  = s => document.querySelector(s);
    const els = s => Array.from(document.querySelectorAll(s));
    const pad4 = n => n.toString().padStart(4, '0');

    const soldKey   = 'rifas_soldTickets_v6';
    const ordersKey = 'rifas_orders_v6';

    const getSold   = () => new Set(JSON.parse(localStorage.getItem(soldKey) || '[]'));
    const setSold   = (set) => localStorage.setItem(soldKey, JSON.stringify([...set]));
    const getOrders = () => JSON.parse(localStorage.getItem(ordersKey) || '[]');
    const setOrders = (arr) => localStorage.setItem(ordersKey, JSON.stringify(arr));

    let selected = new Set();
    let currentPage = 1; // 1..5
    let iti = null;      // intl-tel-input
    let chosenPayKey = null;

    /* ==========================
       Progreso
       ========================== */
    function updateProgress(){
      const sold = getSold();
      const pct = Math.round((sold.size / TOTAL_TICKETS) * 100);
      el('#soldBar').style.width = pct + '%';
      el('#soldCount').textContent = sold.size.toLocaleString('es-VE');
      el('#soldPct').textContent = pct + '%';
    }

    /* ==========================
       PaginaciÃ³n
       ========================== */
    function pageRange(page){
      const start = (page-1)*PAGE_SIZE;      // inclusive
      const end   = start + PAGE_SIZE - 1;   // inclusive
      return [start, end];
    }

    function buildPagination(){
      const wrap = el('#pagination');
      wrap.innerHTML = '';
      for(let p=1; p<=10; p++){
        const [a,b] = pageRange(p);
        const btn = document.createElement('button');
        btn.className = 'btn' + (p===currentPage ? ' primary' : '');
        btn.textContent = p;
        btn.title = `PÃ¡gina ${p} â€” ${pad4(a)}â€“${pad4(b)}`;
        btn.addEventListener('click', ()=>{ currentPage=p; buildPagination(); renderTickets(); });
        wrap.appendChild(btn);
      }
    }

    function renderTickets(){
  const grid = el('#tickets');
  grid.innerHTML = '';
  const sold = getSold();
  const [start, end] = pageRange(currentPage);

  // Crear array de nÃºmeros de esta pÃ¡gina
  const nums = [];
  for(let n=start; n<=end; n++){ nums.push(n); }

  // Mezclar array (Fisher-Yates shuffle)
  for (let i = nums.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [nums[i], nums[j]] = [nums[j], nums[i]];
  }

  // Render con orden mezclado
  nums.forEach(n=>{
    const btn = document.createElement('button');
    btn.className = 'ticket';
    btn.textContent = pad4(n);
    if(sold.has(n)){
      btn.classList.add('sold');
      btn.title = 'Boleto ya ha sido vendido';
      btn.addEventListener('click', ()=> alert('Boleto ya ha sido vendido'));
    }else if(selected.has(n)){
      btn.classList.add('selected');
      btn.disabled = true;
      btn.title = 'Ya seleccionado';
    }else{
      btn.addEventListener('click', ()=>selectTicket(n));
    }
    grid.appendChild(btn);
  });

  updateTotalsUI();
}


    function selectTicket(n){
      const sold = getSold();
      if(sold.has(n)) { alert('Boleto ya ha sido vendido'); return; }
      selected.add(n);
      renderTickets();
      renderSelectedChips();
    }
    function deselectTicket(n){
      selected.delete(n);
      renderTickets();
      renderSelectedChips();
    }

    function renderSelectedChips(){
      const box = el('#selectedChips');
      box.innerHTML = '';
      [...selected].sort((a,b)=>a-b).forEach(n=>{
        const chip = document.createElement('span');
        chip.className = 'chip';
        chip.innerHTML = `<span>${pad4(n)}</span>`;
        const x = document.createElement('button');
        x.setAttribute('type','button');
        x.setAttribute('aria-label','Quitar boleto');
        x.textContent = 'Ã—';
        x.addEventListener('click', ()=>deselectTicket(n));
        chip.appendChild(x);
        box.appendChild(chip);
      });
    }

    function updateTotalsUI(){
      const count = selected.size;
      const total = count * PRICE_PER_TICKET;
      el('#selCount').textContent = count;
      el('#totalAmount').textContent = total + ' Bs';
      el('#minMsg').style.display = 'none';
    }

    function randomPick(count=3){
      const sold = getSold();
      const pool = [];
      for(let n=0;n<TOTAL_TICKETS;n++) if(!sold.has(n) && !selected.has(n)) pool.push(n);
      if(pool.length === 0){ alert('No hay boletos disponibles.'); return; }
      while(selected.size < count && pool.length){
        const idx = Math.floor(Math.random()*pool.length);
        const n = pool.splice(idx,1)[0];
        selected.add(n);
      }
      const first = [...selected].sort((a,b)=>a-b)[0];
      if(first!==undefined){ currentPage = Math.floor(first / PAGE_SIZE) + 1; buildPagination(); }
      renderTickets(); renderSelectedChips();
    }

    // Buscar/jump por # (ENTER funciona en iOS/Android/Desktop al ser submit del form)
    function handleSearch(){
      const raw = el('#searchInput').value.trim();
      if(!/^\d{1,4}$/.test(raw)) return;
      const n = parseInt(raw,10);
      if(n<0 || n>9999) return;
      const page = Math.floor(n / PAGE_SIZE) + 1;
      currentPage = page; buildPagination(); renderTickets();
      const sold = getSold();
      if(sold.has(n)){ alert('Boleto ya ha sido vendido'); return; }
      if(selected.has(n)){ alert('El boleto ya estÃ¡ en tu selecciÃ³n'); return; }
      selectTicket(n);
    }

    /* ==========================
       Pagos
       ========================== */
    function renderPayMethods(){
      const wrap = el('#payMethods'); wrap.innerHTML = '';
      PAYMENT_METHODS.forEach(m=>{
        const card = document.createElement('div');
        card.className = 'pm-card';
        card.innerHTML = `<img src="${m.logo}" alt="${m.name}"><div style="font-weight:800;">${m.name}</div>`;
        card.addEventListener('click', ()=>selectPayMethod(m.key));
        card.dataset.key = m.key;
        wrap.appendChild(card);
      });
    }

    function selectPayMethod(key){
      chosenPayKey = key;
      els('.pm-card').forEach(c=>c.classList.toggle('active', c.dataset.key===key));
      const m = PAYMENT_METHODS.find(x=>x.key===key);
      const d = el('#payDetails');
      d.style.display = 'block';
      d.innerHTML = `<div style="font-weight:800; margin-bottom:6px;">Datos para ${m.name}</div>` +
        '<ul style="margin:0; padding-left:18px;">' + m.details.map(x=>`<li>${x}</li>`).join('') + '</ul>' +
        '<div class="subtle" style="margin-top:8px;">* Copia los datos y realiza el pago. Luego sube el comprobante.</div>';
    }

    /* ==========================
       Confirmar compra + mis boletos
       ========================== */
    async function confirmPurchase(){
      if(selected.size < 3){ el('#minMsg').style.display = 'block'; el('#minMsg').scrollIntoView({behavior:'smooth', block:'center'}); return; }
      const name = el('#name').value.trim();
      const idnum = el('#idnum').value.trim();
      const ref6 = el('#ref6').value.trim();
      const proof = el('#proof').files[0] || null;
      if(!name || !idnum){ alert('Completa nombre y cÃ©dula.'); return; }
      if(!iti){ alert('Error con el campo de telÃ©fono.'); return; }
      const phoneE164 = iti.getNumber();
      if(!phoneE164){ alert('Ingresa un telÃ©fono vÃ¡lido.'); return; }
      if(!/^\d{6}$/.test(ref6)){ alert('La referencia debe tener exactamente 6 dÃ­gitos.'); return; }
      if(!chosenPayKey){ alert('Selecciona un mÃ©todo de pago.'); return; }
      if(!proof){ alert('Sube el comprobante de pago.'); return; }

      const proofDataUrl = await new Promise((res,rej)=>{ const r = new FileReader(); r.onload = ()=>res(r.result); r.onerror = rej; r.readAsDataURL(proof); });

      const order = {
        id: 'ORD-' + Date.now(),
        name, idnum, phone: phoneE164, payMethod: chosenPayKey, ref6,
        proof: proofDataUrl, tickets: [...selected].sort((a,b)=>a-b),
        price: PRICE_PER_TICKET, total: selected.size * PRICE_PER_TICKET,
        createdAt: new Date().toISOString()
      };
      const orders = getOrders(); orders.push(order); setOrders(orders);

      const sold = getSold(); order.tickets.forEach(n=>sold.add(n)); setSold(sold);

      // Reset selecciÃ³n y UI
      selected.clear(); renderSelectedChips(); renderTickets(); updateProgress(); updateTotalsUI();

      // Mostrar â€œMis boletosâ€
      showMyTickets(order);
      el('#myTicketsPanel').scrollIntoView({behavior:'smooth'});
      el('#myTicketsCta').style.display = 'block';
    }

    function showMyTickets(order){
      const panel = el('#myTicketsPanel'); panel.style.display = 'block';
      el('#myTicketsInfo').textContent = `${order.name} â€” Tel: ${order.phone}`;
      const wrap = el('#myDiamonds'); wrap.innerHTML='';
      order.tickets.forEach(n=>{ const d=document.createElement('div'); d.className='big-diamond'; d.textContent=pad4(n); wrap.appendChild(d); });
    }

    /* ==========================
       Verificador
       ========================== */
   function verify(){
  const raw = el('#verifyInput').value.trim();
  const out = el('#verifyOut');
  out.innerHTML = '';
  const orders = getOrders();

  let hits = [];
  if(/^\d{4}$/.test(raw)){
    // ðŸ”Ž Buscar por nÃºmero de boleto (0000â€“9999)
    const t = parseInt(raw,10);
    hits = orders.filter(o=>o.tickets.includes(t));
  } else {
    // ðŸ”Ž Buscar por telÃ©fono
    // Quitar todo lo que no sean dÃ­gitos (espacios, +58, etc.)
    const cleanRaw = raw.replace(/\D/g,'');  

    hits = orders.filter(o=>{
      const cleanPhone = o.phone.replace(/\D/g,''); // guardar igual
      return cleanPhone.endsWith(cleanRaw); // ðŸ‘ˆ compara por el final
    });
  }

  if(hits.length===0){ 
    out.innerHTML = '<div class="subtle">No se encontraron compras.</div>'; 
    return; 
  }

  hits.forEach(o=>{
    const card = document.createElement('div');
    card.className = 'panel';
    card.style.marginTop = '10px';
    card.innerHTML = `
      <div style="font-weight:800; margin-bottom:6px;">
        ${o.name} Â· CI ${o.idnum} Â· ${o.phone}
      </div>
      <div class="subtle">
        Pedido ${o.id} â€” ${new Date(o.createdAt).toLocaleString('es-VE')}
      </div>
      <div style="margin:8px 0; font-weight:800;">
        Total: ${o.total} Bs
      </div>
    `;

    const dwrap = document.createElement('div'); 
    dwrap.className='big-diamonds';
    o.tickets.forEach(n=>{
      const d=document.createElement('div'); 
      d.className='big-diamond'; 
      d.textContent=pad4(n); 
      dwrap.appendChild(d); 
    });

    card.appendChild(dwrap); 
    out.appendChild(card);
  });
}


    /* ==========================
       Init
       ========================== */
    window.addEventListener('DOMContentLoaded', ()=>{
      // Contacto & logos
      el('#waLink').href = WA_URL; el('#fbLink').href = FB_URL; el('#igLink').href = IG_URL;
      el('#waIcon').src = WA_ICON_URL; el('#fbIcon').src = FB_ICON_URL; el('#igIcon').src = IG_ICON_URL;

      // TelÃ©fono con bandera
      try{
        iti = window.intlTelInput(el('#phone'), {
          initialCountry:'ve',
          separateDialCode:true,
          utilsScript:'https://cdn.jsdelivr.net/npm/intl-tel-input@19.5.6/build/js/utils.js'
        });
      }catch(err){ console.warn('intl-tel-input no pudo inicializarse:', err); }

      // PaginaciÃ³n + lista (PÃ¡gina 1 => 0000â€“1999)
      buildPagination(); renderTickets(); updateProgress(); renderPayMethods();

      // Eventos
      el('#btnRandom').addEventListener('click', ()=>randomPick(3));
      el('#searchForm').addEventListener('submit', (e)=>{ e.preventDefault(); handleSearch(); }); // ENTER mÃ³vil/PC
      el('#btnConfirm').addEventListener('click', confirmPurchase);
      el('#btnVerify').addEventListener('click', verify);
      el('#btnSeeMine')?.addEventListener('click', ()=>{
        const orders = getOrders(); if(orders.length){ showMyTickets(orders[orders.length-1]); el('#myTicketsPanel').scrollIntoView({behavior:'smooth'}); }
      });
    });
  </script>
</body>
</html>

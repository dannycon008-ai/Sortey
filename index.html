<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>üéüÔ∏è Tu Diamante - Rifa Premium</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css">
  <style>
    body {
      font-family: 'Poppins', sans-serif;
    }
    header {
      text-align: center;
      padding: 20px;
    }
    header img {
      max-width: 180px;
    }
    .boletos {
      display: flex;
      flex-wrap: wrap;
    }
    .boleto {
      border: 1px solid #0a4975;
      margin: 2px;
      padding: 5px;
      cursor: pointer;
      color: #0a4975;
      flex: 0 0 calc(10% - 4px);
      text-align: center;
    }
    .boleto.selected {
      background: #0a4975;
      color: white;
    }
    .boleto.sold::after {
      content: url('https://qu.ax/zcmdn.png');
      display: block;
      margin-top: 2px;
    }
    .progress-bar {
      background-color: #0a4975;
      transition: width 1s ease-in-out;
    }
    .premios {
      margin: 20px 0;
      text-align: center;
    }
    .premio {
      display: flex;
      align-items: center;
      justify-content: center;
      margin: 10px 0;
    }
    .premio img {
      max-height: 40px;
      margin-left: 10px;
    }
    .miniatura {
      max-width: 100px;
      cursor: pointer;
    }
    .total-pagado {
      margin-top: 15px;
      font-size: 18px;
      font-weight: bold;
      color: #0a4975;
    }
  </style>
</head>
<body>
<header>
  <h1><img src="https://qu.ax/OVJvi.png" alt="Tu Diamante"></h1>
</header>

<div class="container">
  <div class="premios">
    <h2>üéÅ PREMIOS</h2>
    <div class="premio">Premio 1: 10.000 Bs <img src="https://via.placeholder.com/40" alt="premio1"></div>
    <div class="premio">Premio 2: 10.000 Bs <img src="https://via.placeholder.com/40" alt="premio2"></div>
    <div class="premio">Premio 3: 30.000 Bs <img src="https://via.placeholder.com/40" alt="premio3"></div>
  </div>

  <h2 class="text-center">Lista de Boletos</h2>
  <div class="boletos" id="boletos"></div>
  <nav>
    <ul class="pagination justify-content-center" id="paginacion"></ul>
  </nav>
  <div class="progress">
    <div id="barraProgreso" class="progress-bar" role="progressbar" style="width:0%">0%</div>
  </div>
  <p class="text-center">Seleccionados: <span id="count">0</span> | Total: <span id="total">0</span> Bs</p>
  <button class="btn btn-primary" onclick="generarAleatorio()">üé≤ Generar 3 boletos a la suerte</button>

  <hr>
  <h3>Datos Personales</h3>
  <form id="formDatos">
    <input class="form-control mb-2" type="text" placeholder="Nombre y Apellido" id="nombre" required>
    <input class="form-control mb-2" type="text" placeholder="C√©dula" id="cedula" required>
    <div class="input-group mb-2">
      <select id="country" class="form-control" style="max-width:90px">
        <option value="+58">üáªüá™ +58</option>
        <option value="+1">üá∫üá∏ +1</option>
      </select>
      <input class="form-control" type="tel" placeholder="Tel√©fono" id="telefono" required>
    </div>
    <input class="form-control mb-2" type="text" placeholder="√öltimos 6 d√≠gitos de referencia" id="referencia" required>
    <input class="form-control mb-2" type="file" id="comprobante" accept="image/*" required>
    <button class="btn btn-success" type="button" onclick="confirmarCompra()">Confirmar</button>
  </form>

  <hr>
  <h3>Verificador de Boletos</h3>
  <input class="form-control mb-2" type="text" id="busqueda" placeholder="Tel√©fono o #Boleto">
  <button class="btn btn-info mb-3" onclick="verificar()">Verificar</button>
  <div id="resultado"></div>
</div>

<script>
const TOTAL = 10000;
const POR_PAG = 2000;
const PRICE = 15;
let boletos = [];
let vendidos = [];
let pagina = 1;
let seleccionados = new Set();
let compras = [];

function mezclar(array){
  for(let i = array.length-1;i>0;i--){
    const j = Math.floor(Math.random()*(i+1));
    [array[i],array[j]]=[array[j],array[i]];
  }
  return array;
}

function init(){
  boletos = Array.from({length:TOTAL},(_,i)=>i.toString().padStart(4,'0'));
  boletos = mezclar(boletos);
  mostrarPagina(1);
}

function mostrarPagina(p){
  pagina=p;
  const start=(p-1)*POR_PAG;
  const end=p*POR_PAG;
  const cont=document.getElementById('boletos');
  cont.innerHTML='';
  boletos.slice(start,end).forEach(num=>{
    const div=document.createElement('div');
    div.className='boleto'+(vendidos.includes(num)?' sold':'');
    div.innerText=num;
    div.onclick=()=>toggleBoleto(num,div);
    cont.appendChild(div);
  });
  renderPaginacion();
}

function renderPaginacion(){
  const totalPag=Math.ceil(TOTAL/POR_PAG);
  let html='';
  for(let i=1;i<=totalPag;i++){
    html+=`<li class="page-item ${i===pagina?'active':''}"><a class="page-link" href="#" onclick="mostrarPagina(${i})">${i}</a></li>`;
  }
  document.getElementById('paginacion').innerHTML=html;
}

function toggleBoleto(num,el){
  if(vendidos.includes(num))return;
  if(seleccionados.has(num)){
    seleccionados.delete(num);
    el.classList.remove('selected');
  }else{
    seleccionados.add(num);
    el.classList.add('selected');
  }
  actualizarContador();
}

function actualizarContador(){
  document.getElementById('count').innerText=seleccionados.size;
  document.getElementById('total').innerText=seleccionados.size*PRICE;
}

function generarAleatorio(){
  if(vendidos.length+3>TOTAL)return;
  let libres=boletos.filter(b=>!vendidos.includes(b)&&!seleccionados.has(b));
  mezclar(libres).slice(0,3).forEach(num=>{
    seleccionados.add(num);
  });
  mostrarPagina(pagina);
  actualizarContador();
}

function confirmarCompra(){
  if(seleccionados.size<3){
    alert('Compra m√≠nima 3 boletos.');
    return;
  }
  const nombre=document.getElementById('nombre').value;
  const cedula=document.getElementById('cedula').value;
  const telefono=document.getElementById('country').value+document.getElementById('telefono').value;
  const ref=document.getElementById('referencia').value;
  const comp=document.getElementById('comprobante').files[0];
  if(!nombre||!cedula||!telefono||!ref||!comp){
    alert('Complete todos los campos.');
    return;
  }
  const reader=new FileReader();
  reader.onload=function(){
    compras.push({nombre,cedula,telefono,ref,boletos:[...seleccionados],comprobante:reader.result,total:seleccionados.size*PRICE});
    vendidos.push(...seleccionados);
    seleccionados.clear();
    mostrarPagina(pagina);
    actualizarContador();
    actualizarProgreso();
    alert('Compra registrada con √©xito');
    document.getElementById('formDatos').reset();
  }
  reader.readAsDataURL(comp);
}

function actualizarProgreso(){
  const porc=(vendidos.length/TOTAL*100).toFixed(1);
  const barra=document.getElementById('barraProgreso');
  barra.style.width=porc+'%';
  barra.innerText=porc+'%';
}

function verificar(){
  const q=document.getElementById('busqueda').value.trim();
  let resultado=document.getElementById('resultado');
  resultado.innerHTML='';
  let compra=compras.find(c=>c.telefono===q||c.boletos.includes(q));
  if(!compra){
    resultado.innerHTML='<p>No se encontraron boletos.</p>';
    return;
  }
  resultado.innerHTML=`<p><b>Nombre:</b> ${compra.nombre}<br>
  <b>C√©dula:</b> ${compra.cedula}<br>
  <b>Tel√©fono:</b> ${compra.telefono}<br>
  <b>Referencia:</b> ${compra.ref}</p>
  <p><b>Boletos:</b> ${compra.boletos.join(', ')}</p>
  <p class="total-pagado">Total pagado: ${compra.total} Bs</p>
  <p><b>Comprobante:</b><br><img src="${compra.comprobante}" class="miniatura" onclick="window.open(this.src)"></p>`;
}

init();
</script>
</body>
</html>

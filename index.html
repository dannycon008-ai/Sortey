<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Galería / Catálogo</title>
  <style>
    :root{
      --bg:#0b0d12;
      --panel:#121522;
      --panel2:#151a2b;
      --text:#e9eefc;
      --muted:#9aa6c6;
      --accent:#7c5cff;
      --accent2:#4bd3ff;
      --border:rgba(255,255,255,.08);
      --shadow: 0 12px 35px rgba(0,0,0,.35);
      --radius:18px;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial;
      background:
        radial-gradient(1200px 500px at 20% -10%, rgba(124,92,255,.20), transparent 60%),
        radial-gradient(1000px 420px at 90% 10%, rgba(75,211,255,.12), transparent 55%),
        linear-gradient(180deg, #080a10, var(--bg));
      color:var(--text);
      min-height:100vh;
    }

    .wrap{max-width:1180px;margin:0 auto;padding:22px 16px 90px}
    .topbar{
      display:flex;gap:12px;align-items:center;justify-content:space-between;
      margin:8px 0 18px;
    }
    .brand{
      display:flex;align-items:center;gap:10px;
      font-weight:700;letter-spacing:.2px;
    }
    .logo{
      width:36px;height:36px;border-radius:12px;
      background: linear-gradient(135deg, var(--accent), var(--accent2));
      box-shadow: 0 10px 20px rgba(124,92,255,.25);
    }
    .brand small{display:block;color:var(--muted);font-weight:500;margin-top:2px}

    .toolbar{
      display:flex;gap:12px;flex-wrap:wrap;align-items:center;justify-content:space-between;
      background: rgba(255,255,255,.03);
      border:1px solid var(--border);
      border-radius: var(--radius);
      padding:14px;
      box-shadow: var(--shadow);
    }

    .search{
      display:flex;gap:10px;align-items:center;flex:1;min-width:280px;
      background: rgba(0,0,0,.28);
      border:1px solid var(--border);
      border-radius: 14px;
      padding:10px 12px;
    }
    .search input{
      width:100%;
      background:transparent;border:0;outline:none;
      color:var(--text);
      font-size:14px;
    }
    .btn{
      border:0;cursor:pointer;
      color:#fff;
      background: linear-gradient(135deg, var(--accent), #5b44ff);
      padding:10px 14px;border-radius: 12px;
      font-weight:650;
      box-shadow: 0 10px 18px rgba(124,92,255,.25);
      transition: transform .08s ease, filter .2s ease;
      white-space:nowrap;
    }
    .btn:active{transform: translateY(1px)}
    .btn.secondary{
      background: rgba(255,255,255,.06);
      border:1px solid var(--border);
      box-shadow:none;
      color:var(--text);
    }

    .chips{display:flex;gap:10px;flex-wrap:wrap;align-items:center}
    .chip{
      display:inline-flex;align-items:center;gap:8px;
      padding:10px 12px;border-radius: 14px;
      background: rgba(255,255,255,.04);
      border:1px solid var(--border);
      color:var(--text);
      cursor:pointer;
      user-select:none;
      transition: background .2s ease, border-color .2s ease;
      font-weight:600;
      font-size:13px;
    }
    .chip.active{
      background: rgba(124,92,255,.18);
      border-color: rgba(124,92,255,.45);
    }
    .chip .dot{
      width:8px;height:8px;border-radius:99px;background:rgba(255,255,255,.35)
    }
    .chip.active .dot{background: var(--accent)}

    .sort{
      display:flex;gap:10px;align-items:center;flex-wrap:wrap;
    }
    .sort label{color:var(--muted);font-size:13px}
    select{
      background: rgba(0,0,0,.28);
      border:1px solid var(--border);
      color:var(--text);
      border-radius: 12px;
      padding:10px 12px;
      outline:none;
      cursor:pointer;
      font-weight:600;
    }

    .grid{
      margin-top:18px;
      display:grid;
      grid-template-columns: repeat(4, minmax(0, 1fr));
      gap:14px;
    }
    @media (max-width: 1050px){ .grid{grid-template-columns: repeat(3, 1fr);} }
    @media (max-width: 780px){ .grid{grid-template-columns: repeat(2, 1fr);} }
    @media (max-width: 480px){ .grid{grid-template-columns: 1fr;} }

    .card{
      background: linear-gradient(180deg, rgba(255,255,255,.05), rgba(255,255,255,.03));
      border:1px solid var(--border);
      border-radius: var(--radius);
      overflow:hidden;
      box-shadow: var(--shadow);
      display:flex;flex-direction:column;
      min-height: 320px;
    }
    .thumb{
      position:relative;
      width:100%;
      aspect-ratio: 16 / 10;
      background: rgba(255,255,255,.03);
      overflow:hidden;
    }
    .thumb img{
      width:100%;height:100%;
      object-fit:cover;
      display:block;
      transform: scale(1.02);
      filter: saturate(1.05) contrast(1.05);
    }
    .badge{
      position:absolute;left:12px;top:12px;
      background: rgba(20,24,40,.85);
      border:1px solid rgba(255,255,255,.14);
      color:#dfffe9;
      font-weight:800;
      font-size:12px;
      padding:6px 10px;border-radius: 999px;
      letter-spacing:.3px;
      text-transform: uppercase;
    }
    .badge.new{ color:#dfffe9; }
    .badge.hot{ color:#ffe9c2; }
    .watermark{
      position:absolute;right:10px;top:10px;
      background: rgba(0,0,0,.35);
      border:1px solid rgba(255,255,255,.12);
      padding:6px 8px;border-radius:12px;
      font-size:11px;color:rgba(255,255,255,.85);
      backdrop-filter: blur(6px);
    }

    .content{padding:14px 14px 12px;display:flex;flex-direction:column;gap:10px;flex:1}
    .title{
      font-weight:800;
      letter-spacing:.2px;
      margin:0;
      font-size:16px;
    }
    .meta{
      display:flex;gap:14px;flex-wrap:wrap;
      color:var(--muted);
      font-size:12.5px;
      align-items:center;
    }
    .meta span{display:inline-flex;gap:6px;align-items:center}

    .actions{
      display:flex;gap:10px;align-items:center;justify-content:space-between;margin-top:auto;
    }

    .share{
      display:flex;gap:8px;align-items:center;
    }
    .iconBtn{
      width:38px;height:38px;border-radius: 14px;
      border:1px solid var(--border);
      background: rgba(255,255,255,.04);
      display:grid;place-items:center;
      cursor:pointer;
      transition: transform .08s ease, background .2s ease;
    }
    .iconBtn:hover{background: rgba(255,255,255,.07)}
    .iconBtn:active{transform: translateY(1px)}
    .iconBtn svg{width:18px;height:18px;fill: rgba(255,255,255,.88)}

    .empty{
      margin:22px 0;
      padding:22px;
      border:1px dashed rgba(255,255,255,.18);
      border-radius: var(--radius);
      color: var(--muted);
      text-align:center;
    }

    /* Modal */
    .modal{
      position:fixed;inset:0;
      background: rgba(0,0,0,.6);
      display:none;
      align-items:center;justify-content:center;
      padding:18px;
      z-index: 1000;
    }
    .modal.show{display:flex}
    .modalCard{
      width:min(980px, 100%);
      background: rgba(16,18,28,.92);
      border:1px solid rgba(255,255,255,.14);
      border-radius: 22px;
      box-shadow: 0 30px 80px rgba(0,0,0,.55);
      overflow:hidden;
    }
    .modalHead{
      display:flex;align-items:center;justify-content:space-between;
      padding:14px 14px 10px;
      border-bottom:1px solid rgba(255,255,255,.10);
      gap:10px;
    }
    .modalHead strong{font-size:14px}
    .close{
      background: rgba(255,255,255,.06);
      border:1px solid rgba(255,255,255,.12);
      color:var(--text);
      border-radius: 12px;
      padding:8px 10px;
      cursor:pointer;
      font-weight:700;
    }
    .player{
      width:100%;
      aspect-ratio: 16/9;
      background:#000;
      position:relative;
    }
    .player iframe, .player video{
      width:100%;height:100%;
      display:block;border:0;
      background:#000;
    }

    /* === Botones flotantes derecha (como tu imagen) === */
    .floatSocial{
      position: fixed;
      right: 14px;
      top: 50%;
      transform: translateY(-50%);
      display: flex;
      flex-direction: column;
      gap: 12px;
      z-index: 1200;
    }
    .fab{
      width: 54px;
      height: 54px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.08);
      display: grid;
      place-items: center;
      box-shadow: 0 14px 26px rgba(0,0,0,.35);
      cursor: pointer;
      transition: transform .08s ease, filter .2s ease;
      backdrop-filter: blur(8px);
    }
    .fab:active{ transform: translateY(1px); }
    .fab svg{ width: 22px; height: 22px; fill: rgba(255,255,255,.95); }

    .fab-share{ background: rgba(124,92,255,.85); }
    .fab-telegram{ background: rgba(0,136,204,.85); }
    .fab-whatsapp{ background: rgba(37,211,102,.85); }
    .fab-facebook{ background: rgba(24,119,242,.85); }

    @media (max-width: 520px){
      .fab{ width: 48px; height: 48px; }
      .fab svg{ width: 20px; height: 20px; }
    }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="topbar">
      <div class="brand">
        <div class="logo"></div>
        <div>
          Catálogo
          <small>Imágenes y videos por URL externa</small>
        </div>
      </div>
      <button class="btn secondary" id="btnReset">Restablecer</button>
    </div>

    <div class="toolbar">
      <div class="search">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" aria-hidden="true">
          <path d="M10.5 18a7.5 7.5 0 1 1 0-15 7.5 7.5 0 0 1 0 15Z" stroke="rgba(255,255,255,.75)" stroke-width="2"/>
          <path d="M16.2 16.2 21 21" stroke="rgba(255,255,255,.75)" stroke-width="2" stroke-linecap="round"/>
        </svg>
        <input id="q" type="search" placeholder="Buscar modelo o video..." autocomplete="off" />
        <button class="btn" id="btnSearch">Buscar</button>
      </div>

      <div class="chips" role="tablist" aria-label="Filtros">
        <div class="chip active" data-filter="all" role="tab" aria-selected="true">
          <span class="dot"></span> Todos
        </div>
        <div class="chip" data-filter="new" role="tab" aria-selected="false">
          <span class="dot"></span> Nuevos
        </div>
        <div class="chip" data-filter="popular" role="tab" aria-selected="false">
          <span class="dot"></span> Populares
        </div>
      </div>

      <div class="sort">
        <label for="sort">Ordenar por:</label>
        <select id="sort">
          <option value="recent">Más recientes</option>
          <option value="views">Más vistas</option>
          <option value="name">Nombre (A–Z)</option>
        </select>
      </div>
    </div>

    <div id="grid" class="grid" aria-live="polite"></div>
    <div id="empty" class="empty" style="display:none;">No hay resultados con esos filtros.</div>
  </div>

  <!-- Modal -->
  <div class="modal" id="modal" role="dialog" aria-modal="true" aria-label="Reproductor">
    <div class="modalCard">
      <div class="modalHead">
        <strong id="modalTitle">Video</strong>
        <button class="close" id="modalClose">Cerrar ✕</button>
      </div>

      <div class="player" id="player">
        <div id="posterLayer" style="position:absolute; inset:0; display:grid; place-items:center;">
          <img id="posterImg" alt="Poster" style="width:100%;height:100%;object-fit:cover;display:block;filter:saturate(1.05) contrast(1.05);" />
          <button id="playBtn" class="btn"
            style="position:absolute; display:flex; align-items:center; gap:10px; padding:12px 16px; border-radius:14px;">
            ▶ Reproducir
          </button>
        </div>
        <div id="mediaLayer" style="position:absolute; inset:0;"></div>
      </div>
    </div>
  </div>

  <!-- ✅ Botones flotantes derecha (como tu captura) -->
  <div class="floatSocial" aria-label="Accesos rápidos">
    <button class="fab fab-share" id="fabShare" title="Compartir">
      <svg viewBox="0 0 24 24" aria-hidden="true">
        <path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7a2.5 2.5 0 0 0 0-1.39l7-4.11A2.99 2.99 0 1 0 14 5a2.9 2.9 0 0 0 .05.54l-7 4.11a3 3 0 1 0 0 4.7l7.12 4.19c-.03.17-.05.34-.05.51a3 3 0 1 0 3-3Z"/>
      </svg>
    </button>

    <button class="fab fab-telegram" id="fabTelegram" title="Telegram">
      <svg viewBox="0 0 24 24" aria-hidden="true">
        <path d="M21.8 3.3 2.9 10.6c-1.3.5-1.3 1.2-.2 1.5l4.9 1.5 11.3-7.1c.5-.3 1-.1.6.2l-9.2 8.4-.3 4.5c.4 0 .6-.2.9-.5l2.2-2.1 4.6 3.4c.9.5 1.5.2 1.7-.8l3-14.1c.3-1.2-.4-1.7-1.5-1.3Z"/>
      </svg>
    </button>

    <button class="fab fab-whatsapp" id="fabWhatsApp" title="WhatsApp">
      <svg viewBox="0 0 24 24" aria-hidden="true">
        <path d="M20.5 3.5A11 11 0 0 0 2.9 16.8L2 22l5.4-1.4A11 11 0 0 0 20.5 3.5Zm-8.5 18a9 9 0 0 1-4.6-1.2l-.3-.2-3.2.8.9-3.1-.2-.3A9 9 0 1 1 12 21.5Zm5.2-6.8c-.3-.1-1.7-.8-2-.9-.3-.1-.5-.1-.7.1-.2.3-.8.9-1 .9-.2.1-.4.1-.7-.1-.3-.1-1.3-.5-2.5-1.6-.9-.8-1.6-1.9-1.8-2.2-.2-.3 0-.5.1-.6l.5-.6c.2-.2.2-.4.3-.6.1-.2 0-.4 0-.6 0-.1-.7-1.7-.9-2.3-.2-.6-.5-.5-.7-.5h-.6c-.2 0-.6.1-.9.4-.3.3-1.2 1.1-1.2 2.7s1.2 3.1 1.4 3.3c.2.2 2.4 3.7 5.9 5.2.8.3 1.4.5 1.9.6.8.2 1.5.2 2.1.1.6-.1 1.7-.7 1.9-1.4.2-.7.2-1.3.1-1.4 0-.1-.3-.2-.6-.3Z"/>
      </svg>
    </button>

    <button class="fab fab-facebook" id="fabFacebook" title="Facebook">
      <svg viewBox="0 0 24 24" aria-hidden="true">
        <path d="M22 12a10 10 0 1 0-11.6 9.9v-7H8.1V12h2.3V9.8c0-2.3 1.4-3.6 3.5-3.6 1 0 2 .2 2 .2v2.2h-1.1c-1.1 0-1.4.7-1.4 1.4V12h2.5l-.4 2.9h-2.1v7A10 10 0 0 0 22 12Z"/>
      </svg>
    </button>
  </div>

  <script>
    /**
     * DATOS (ejemplo)
     */
    const items = [
      {
        id: "m1",
        name: "Marian Franco",
        thumbUrl: "https://images.unsplash.com/photo-1544005313-94ddf0286df2?auto=format&fit=crop&w=1200&q=70",
        videoUrl: "https://www.youtube.com/embed/dQw4w9WgXcQ",
        views: 233,
        date: "2026-01-16",
        isNew: true,
      },
      {
        id: "m2",
        name: "Silvana Lee",
        thumbUrl: "https://images.unsplash.com/photo-1524504388940-b1c1722653e1?auto=format&fit=crop&w=1200&q=70",
        videoUrl: "https://www.youtube.com/embed/aqz-KE-bpKQ",
        views: 234,
        date: "2026-01-16",
        isNew: true,
      },
      {
        id: "m3",
        name: "Kathrin Carvajal",
        thumbUrl: "https://images.unsplash.com/photo-1529626455594-4ff0802cfb7e?auto=format&fit=crop&w=1200&q=70",
        videoUrl: "https://www.youtube.com/embed/ScMzIvxBSi4",
        views: 45,
        date: "2026-01-16",
        isNew: true,
      },
      {
        id: "m4",
        name: "Karmen Karma",
        thumbUrl: "https://images.unsplash.com/photo-1500530855697-b586d89ba3ee?auto=format&fit=crop&w=1200&q=70",
        videoUrl: "https://www.youtube.com/embed/tgbNymZ7vqY",
        views: 74,
        date: "2026-01-16",
        isNew: true,
      },
      {
        id: "m5",
        name: "Andrea Nova",
        thumbUrl: "https://images.unsplash.com/photo-1524250502761-1ac6f2e30d43?auto=format&fit=crop&w=1200&q=70",
        videoUrl: "https://interactive-examples.mdn.mozilla.net/media/cc0-videos/flower.mp4",
        views: 1800,
        date: "2025-12-20",
        isNew: false,
      },
    ];

    // ✅ CONFIGURA TUS ENLACES AQUÍ
    const SOCIAL = {
      telegram: "https://t.me/tu_canal_o_usuario",
      facebookPage: "https://www.facebook.com/tu_pagina_o_perfil",
      whatsappNumber: "584125160806", // sin +, sin espacios
      whatsappText: "Hola, vengo del catálogo. Quiero más info."
    };

    // Estado UI
    let state = { query: "", filter: "all", sort: "recent" };

    // Helpers
    const $ = (sel) => document.querySelector(sel);
    const grid = $("#grid");
    const empty = $("#empty");

    function fmtDate(iso){
      const [y,m,d] = iso.split("-").map(Number);
      return `${String(d).padStart(2,"0")}/${String(m).padStart(2,"0")}/${y}`;
    }

    function badgeFor(item){
      const popularThreshold = 500;
      if(item.isNew) return { text:"Nuevo", cls:"new" };
      if(item.views >= popularThreshold) return { text:"Popular", cls:"hot" };
      return null;
    }

    function applyState(){
      const q = state.query.trim().toLowerCase();
      let list = items.slice();

      if(q){
        list = list.filter(x =>
          x.name.toLowerCase().includes(q)
          || (x.id && x.id.toLowerCase().includes(q))
        );
      }

      if(state.filter === "new"){
        list = list.filter(x => x.isNew);
      } else if(state.filter === "popular"){
        list = list.slice().sort((a,b)=> b.views - a.views).slice(0, 50);
      }

      if(state.sort === "recent"){
        list.sort((a,b)=> (b.date || "").localeCompare(a.date || ""));
      } else if(state.sort === "views"){
        list.sort((a,b)=> (b.views || 0) - (a.views || 0));
      } else if(state.sort === "name"){
        list.sort((a,b)=> (a.name || "").localeCompare(b.name || ""));
      }

      render(list);
    }

    function render(list){
      grid.innerHTML = "";
      empty.style.display = list.length ? "none" : "block";

      const frag = document.createDocumentFragment();

      for(const item of list){
        const card = document.createElement("div");
        card.className = "card";
        const b = badgeFor(item);

        card.innerHTML = `
          <div class="thumb">
            <img loading="lazy" src="${escapeAttr(item.thumbUrl)}" alt="${escapeAttr(item.name)}">
            ${b ? `<div class="badge ${b.cls}">${b.text}</div>` : ""}
            <div class="watermark">Catálogo</div>
          </div>

          <div class="content">
            <h3 class="title">${escapeHtml(item.name)}</h3>

            <div class="meta">
              <span title="Vistas">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" aria-hidden="true">
                  <path d="M2 12s3.5-7 10-7 10 7 10 7-3.5 7-10 7S2 12 2 12Z" stroke="rgba(255,255,255,.65)" stroke-width="2"/>
                  <circle cx="12" cy="12" r="3" stroke="rgba(255,255,255,.65)" stroke-width="2"/>
                </svg>
                ${Number(item.views||0).toLocaleString("es-ES")} vistas
              </span>

              <span title="Fecha">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" aria-hidden="true">
                  <path d="M7 3v2M17 3v2" stroke="rgba(255,255,255,.65)" stroke-width="2" stroke-linecap="round"/>
                  <path d="M4 7h16" stroke="rgba(255,255,255,.65)" stroke-width="2"/>
                  <path d="M6 5h12a2 2 0 0 1 2 2v13a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V7a2 2 0 0 1 2-2Z" stroke="rgba(255,255,255,.65)" stroke-width="2"/>
                </svg>
                ${fmtDate(item.date || "2026-01-01")}
              </span>
            </div>

            <div class="actions">
              <button class="btn secondary" data-action="watch" data-id="${escapeAttr(item.id)}">Ver video</button>

              <div class="share">
                <button class="iconBtn" title="Compartir" data-action="share" data-id="${escapeAttr(item.id)}">
                  <svg viewBox="0 0 24 24" aria-hidden="true"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7a2.5 2.5 0 0 0 0-1.39l7-4.11A2.99 2.99 0 1 0 14 5a2.9 2.9 0 0 0 .05.54l-7 4.11a3 3 0 1 0 0 4.7l7.12 4.19c-.03.17-.05.34-.05.51a3 3 0 1 0 3-3Z"/></svg>
                </button>
                <button class="iconBtn" title="Copiar enlace" data-action="copy" data-id="${escapeAttr(item.id)}">
                  <svg viewBox="0 0 24 24" aria-hidden="true">
                    <path d="M10 14a5 5 0 0 1 0-7l1-1a5 5 0 0 1 7 7l-1 1" />
                    <path d="M14 10a5 5 0 0 1 0 7l-1 1a5 5 0 0 1-7-7l1-1" />
                  </svg>
                </button>
              </div>
            </div>
          </div>
        `;

        card.querySelectorAll('svg path').forEach(p=>{
          if(!p.getAttribute("stroke") && p.getAttribute("d")?.includes("M10 14")) {
            p.setAttribute("fill","none");
            p.setAttribute("stroke","rgba(255,255,255,.88)");
            p.setAttribute("stroke-width","2");
            p.setAttribute("stroke-linecap","round");
            p.setAttribute("stroke-linejoin","round");
          }
        });

        frag.appendChild(card);
      }

      grid.appendChild(frag);
    }

    function escapeHtml(str){
      return String(str ?? "")
        .replaceAll("&","&amp;")
        .replaceAll("<","&lt;")
        .replaceAll(">","&gt;")
        .replaceAll('"',"&quot;")
        .replaceAll("'","&#039;");
    }
    function escapeAttr(str){ return escapeHtml(str); }

    // Modal player
    const modal = $("#modal");
    const modalTitle = $("#modalTitle");
    const posterImg = $("#posterImg");
    const posterLayer = $("#posterLayer");
    const mediaLayer = $("#mediaLayer");
    const playBtn = $("#playBtn");

    let currentItem = null;

    function buildMedia(url){
      const isVideoFile = /\.(mp4|webm|ogg)(\?.*)?$/i.test(url);
      mediaLayer.innerHTML = "";

      if (isVideoFile){
        const v = document.createElement("video");
        v.src = url;
        v.controls = true;
        v.autoplay = true;
        v.playsInline = true;
        mediaLayer.appendChild(v);
      } else {
        const iframe = document.createElement("iframe");
        iframe.src = url;
        iframe.allow = "autoplay; encrypted-media; picture-in-picture";
        iframe.allowFullscreen = true;
        iframe.style.width = "100%";
        iframe.style.height = "100%";
        iframe.style.border = "0";
        mediaLayer.appendChild(iframe);
      }
    }

    function openPosterModal(item){
      currentItem = item;
      modalTitle.textContent = item.name || "Video";
      posterImg.src = item.thumbUrl;

      mediaLayer.innerHTML = "";
      posterLayer.style.display = "grid";

      modal.classList.add("show");
      document.body.style.overflow = "hidden";
    }

    playBtn.addEventListener("click", () => {
      if(!currentItem) return;

      buildMedia(currentItem.videoUrl);
      posterLayer.style.display = "none";

      currentItem.views = (currentItem.views || 0) + 1;
      applyState();
    });

    function closeModal(){
      modal.classList.remove("show");
      document.body.style.overflow = "";
      mediaLayer.innerHTML = "";
      posterLayer.style.display = "grid";
      currentItem = null;
    }

    $("#modalClose").addEventListener("click", closeModal);
    modal.addEventListener("click", (e)=>{ if(e.target === modal) closeModal(); });
    document.addEventListener("keydown", (e)=>{ if(e.key === "Escape") closeModal(); });

    // UI search/sort/chips/reset
    $("#btnSearch").addEventListener("click", ()=>{
      state.query = $("#q").value;
      applyState();
    });
    $("#q").addEventListener("keydown", (e)=>{
      if(e.key === "Enter"){
        state.query = $("#q").value;
        applyState();
      }
    });
    $("#sort").addEventListener("change", (e)=>{
      state.sort = e.target.value;
      applyState();
    });
    document.querySelectorAll(".chip").forEach(chip=>{
      chip.addEventListener("click", ()=>{
        document.querySelectorAll(".chip").forEach(c=>c.classList.remove("active"));
        chip.classList.add("active");
        state.filter = chip.dataset.filter;
        applyState();
      });
    });
    $("#btnReset").addEventListener("click", ()=>{
      state = { query:"", filter:"all", sort:"recent" };
      $("#q").value = "";
      $("#sort").value = "recent";
      document.querySelectorAll(".chip").forEach(c=>c.classList.remove("active"));
      document.querySelector('.chip[data-filter="all"]').classList.add("active");
      applyState();
    });

    // Delegación: ver / share / copy
    grid.addEventListener("click", async (e)=>{
      const btn = e.target.closest("[data-action]");
      if(!btn) return;
      const action = btn.dataset.action;
      const id = btn.dataset.id;
      const item = items.find(x => x.id === id);
      if(!item) return;

      if(action === "watch"){
        openPosterModal(item);
      }

      if(action === "copy"){
        const link = makeItemLink(item);
        await navigator.clipboard.writeText(link);
        toast("Enlace copiado ✅");
      }

      if(action === "share"){
        const data = { title: item.name, text: `Mira: ${item.name}`, url: makeItemLink(item) };
        if(navigator.share){
          try { await navigator.share(data); } catch {}
        } else {
          await navigator.clipboard.writeText(data.url);
          toast("No hay compartir nativo. Enlace copiado ✅");
        }
      }
    });

    // ✅ Deep link
    function makeItemLink(item){
      const base = location.href.split("#")[0];
      return `${base}#${encodeURIComponent(item.id)}`;
    }
    function getCurrentShareLink(){
      return currentItem ? makeItemLink(currentItem) : location.href.split("#")[0];
    }

    function handleHash(){
      const id = decodeURIComponent((location.hash||"").replace("#",""));
      if(!id) return;
      const item = items.find(x => x.id === id);
      if(item) openPosterModal(item);
    }
    window.addEventListener("hashchange", handleHash);

    // Toast
    let toastTimer;
    function toast(msg){
      let el = document.getElementById("toast");
      if(!el){
        el = document.createElement("div");
        el.id = "toast";
        el.style.position = "fixed";
        el.style.left = "50%";
        el.style.bottom = "18px";
        el.style.transform = "translateX(-50%)";
        el.style.padding = "12px 14px";
        el.style.borderRadius = "14px";
        el.style.background = "rgba(15,18,28,.92)";
        el.style.border = "1px solid rgba(255,255,255,.14)";
        el.style.color = "rgba(255,255,255,.92)";
        el.style.boxShadow = "0 16px 40px rgba(0,0,0,.45)";
        el.style.zIndex = "2000";
        document.body.appendChild(el);
      }
      el.textContent = msg;
      el.style.display = "block";
      clearTimeout(toastTimer);
      toastTimer = setTimeout(()=>{ el.style.display="none"; }, 1800);
    }

    // ✅ Botones flotantes: comparten item abierto si existe
    document.getElementById("fabShare").addEventListener("click", async ()=>{
      const url = getCurrentShareLink();
      if(navigator.share){
        try { await navigator.share({ title: document.title, url }); } catch {}
      } else {
        await navigator.clipboard.writeText(url);
        toast("Enlace copiado ✅");
      }
    });

    document.getElementById("fabTelegram").addEventListener("click", ()=>{
      // Abre tu canal/usuario y también puedes enviar el link en el mensaje si quieres (opcional)
      window.open(SOCIAL.telegram, "_blank", "noopener,noreferrer");
    });

    document.getElementById("fabWhatsApp").addEventListener("click", ()=>{
      const url = getCurrentShareLink();
      const text = encodeURIComponent(`${SOCIAL.whatsappText}\n\n${url}`);
      const wa = `https://wa.me/${SOCIAL.whatsappNumber}?text=${text}`;
      window.open(wa, "_blank", "noopener,noreferrer");
    });

    document.getElementById("fabFacebook").addEventListener("click", ()=>{
      // Si quieres compartir el link exacto del item abierto, usa el sharer:
      const url = encodeURIComponent(getCurrentShareLink());
      const fbShare = `https://www.facebook.com/sharer/sharer.php?u=${url}`;
      window.open(fbShare, "_blank", "noopener,noreferrer");

      // Si prefieres abrir tu página directamente, comenta lo de arriba y usa:
      // window.open(SOCIAL.facebookPage, "_blank", "noopener,noreferrer");
    });

    // Init
    applyState();
    handleHash();
  </script>
</body>
</html>

<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Mini Mercado ‚Äî Demo</title>
  <style>
    :root{
      --yellow:#ffe600;
      --yellow-2:#fff3a6;
      --ink:#111;
      --muted:#6b7280;
      --bg:#f5f5f5;
      --card:#ffffff;
      --line:#e6e6e6;
      --blue:#3483fa;
      --blue-2:#1f6feb;
      --green:#00a650;
      --shadow: 0 10px 25px rgba(0,0,0,.08);
      --radius: 14px;
    }

    *{ box-sizing:border-box; }
    html,body{ height:100%; }
    body{
      margin:0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      color:var(--ink);
      background:var(--bg);
    }

    /* Top bar */
    .topbar{
      background:var(--yellow);
      border-bottom:1px solid rgba(0,0,0,.08);
      position:sticky;
      top:0;
      z-index:50;
    }
    .topbar__inner{
      max-width:1100px;
      margin:0 auto;
      padding:14px 16px;
      display:flex;
      align-items:center;
      gap:14px;
    }
    .brand{
      display:flex;
      align-items:center;
      gap:10px;
      font-weight:900;
      letter-spacing:.2px;
    }
    .brand__logo{
      width:34px;height:34px;
      border-radius:10px;
      background:linear-gradient(135deg, #111 0%, #444 100%);
      display:grid;place-items:center;
      color:#fff;
      font-size:14px;
      box-shadow: 0 6px 14px rgba(0,0,0,.18);
    }
    .brand small{ font-weight:700; opacity:.7; }

    .search{
      flex:1;
      display:flex;
      gap:10px;
      align-items:center;
    }
    .search input{
      width:100%;
      padding:12px 14px;
      border:1px solid rgba(0,0,0,.12);
      border-radius:12px;
      outline:none;
      font-size:14px;
      background:#fff;
      box-shadow: 0 8px 16px rgba(0,0,0,.06);
    }
    .search input:focus{
      border-color: rgba(52,131,250,.55);
      box-shadow: 0 10px 20px rgba(52,131,250,.12);
    }

    .btn{
      border:0;
      cursor:pointer;
      border-radius:12px;
      padding:10px 12px;
      font-weight:700;
      font-size:14px;
      display:inline-flex;
      align-items:center;
      gap:8px;
      user-select:none;
    }
    .btn--primary{
      background:var(--blue);
      color:#fff;
    }
    .btn--primary:hover{ background:var(--blue-2); }
    .btn--ghost{
      background:rgba(255,255,255,.65);
      border:1px solid rgba(0,0,0,.12);
    }
    .btn--ghost:hover{ background:#fff; }

    .badge{
      min-width:20px;
      height:20px;
      padding:0 6px;
      border-radius:999px;
      background:#111;
      color:#fff;
      display:inline-grid;
      place-items:center;
      font-size:12px;
      line-height:1;
    }

    /* Layout */
    .wrap{
      max-width:1100px;
      margin:18px auto 40px;
      padding:0 16px;
      display:grid;
      grid-template-columns: 280px 1fr;
      gap:18px;
    }

    /* Sidebar */
    .panel{
      background:var(--card);
      border:1px solid var(--line);
      border-radius:var(--radius);
      box-shadow: var(--shadow);
      overflow:hidden;
    }
    .panel__hd{
      padding:14px 14px 10px;
      border-bottom:1px solid var(--line);
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
    }
    .panel__hd h3{
      margin:0;
      font-size:14px;
      letter-spacing:.2px;
    }
    .panel__bd{ padding:14px; }

    .field{ display:flex; flex-direction:column; gap:8px; margin-bottom:14px; }
    .label{ font-size:12px; color:var(--muted); font-weight:700; }
    select, .chipbar button{
      padding:10px 12px;
      border-radius:12px;
      border:1px solid rgba(0,0,0,.12);
      background:#fff;
      font-size:14px;
      outline:none;
    }

    .chipbar{
      display:flex;
      flex-wrap:wrap;
      gap:8px;
    }
    .chipbar button{
      cursor:pointer;
      font-weight:700;
      background: #fff;
    }
    .chipbar button[aria-pressed="true"]{
      border-color: rgba(52,131,250,.55);
      background: rgba(52,131,250,.10);
    }

    .hint{
      font-size:12px;
      color:var(--muted);
      line-height:1.4;
      margin:0;
    }

    /* Main */
    .hero{
      background: linear-gradient(135deg, #ffffff 0%, var(--yellow-2) 100%);
      border:1px solid var(--line);
      border-radius:var(--radius);
      padding:14px 14px;
      box-shadow: var(--shadow);
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
      margin-bottom:14px;
    }
    .hero h2{ margin:0; font-size:16px; }
    .hero p{ margin:4px 0 0; color:var(--muted); font-size:13px; }

    .grid{
      display:grid;
      grid-template-columns: repeat(3, minmax(0, 1fr));
      gap:14px;
    }

    .card{
      background:var(--card);
      border:1px solid var(--line);
      border-radius:var(--radius);
      overflow:hidden;
      box-shadow: var(--shadow);
      display:flex;
      flex-direction:column;
      min-height: 330px;
    }
    .thumb{
      height:150px;
      background: linear-gradient(135deg, rgba(52,131,250,.18), rgba(0,166,80,.18));
      display:grid;
      place-items:center;
      position:relative;
    }
    .thumb span{
      font-weight:900;
      color:#111;
      background:rgba(255,255,255,.8);
      padding:8px 10px;
      border-radius:999px;
      border:1px solid rgba(0,0,0,.10);
      font-size:12px;
    }
    .tag{
      position:absolute;
      top:10px; left:10px;
      background: rgba(0,0,0,.86);
      color:#fff;
      font-size:12px;
      padding:6px 10px;
      border-radius:999px;
    }

    .card__body{
      padding:12px 12px 10px;
      display:flex;
      flex-direction:column;
      gap:10px;
      flex:1;
    }
    .title{
      font-size:14px;
      margin:0;
      line-height:1.25;
      min-height: 36px;
    }
    .price{
      display:flex;
      align-items:baseline;
      gap:8px;
      margin:0;
    }
    .price b{ font-size:18px; }
    .price s{ color:var(--muted); font-size:13px; }
    .meta{
      display:flex;
      justify-content:space-between;
      align-items:center;
      color:var(--muted);
      font-size:12px;
      gap:10px;
    }
    .ship{
      color:var(--green);
      font-weight:800;
    }

    .card__actions{
      padding:12px;
      border-top:1px solid var(--line);
      display:flex;
      gap:10px;
    }
    .btn--block{ flex:1; justify-content:center; }

    /* Empty state */
    .empty{
      background:#fff;
      border:1px dashed rgba(0,0,0,.22);
      border-radius:var(--radius);
      padding:18px;
      color:var(--muted);
      text-align:center;
    }

    /* Modal */
    .modal{
      position:fixed;
      inset:0;
      display:none;
      place-items:center;
      background: rgba(0,0,0,.45);
      z-index:100;
      padding:16px;
    }
    .modal[open]{ display:grid; }
    .modal__card{
      width:min(720px, 100%);
      background:#fff;
      border-radius:18px;
      box-shadow: 0 30px 80px rgba(0,0,0,.30);
      overflow:hidden;
      border:1px solid rgba(255,255,255,.25);
    }
    .modal__hd{
      padding:14px 14px 10px;
      border-bottom:1px solid var(--line);
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
    }
    .modal__hd h3{ margin:0; font-size:14px; }
    .modal__bd{ padding:14px; }
    .cartlist{
      display:flex;
      flex-direction:column;
      gap:10px;
    }
    .cartrow{
      display:grid;
      grid-template-columns: 1fr auto auto;
      gap:10px;
      align-items:center;
      padding:10px;
      border:1px solid var(--line);
      border-radius:14px;
      background:#fff;
    }
    .cartrow small{ color:var(--muted); display:block; margin-top:2px; }
    .qty{
      display:flex;
      align-items:center;
      gap:6px;
    }
    .qty button{
      width:34px; height:34px;
      border-radius:10px;
      border:1px solid rgba(0,0,0,.12);
      background:#fff;
      cursor:pointer;
      font-weight:900;
    }
    .qty button:hover{ background:#f7f7f7; }
    .totals{
      margin-top:12px;
      padding-top:12px;
      border-top:1px solid var(--line);
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:10px;
    }
    .totals b{ font-size:18px; }

    /* Responsive */
    @media (max-width: 980px){
      .wrap{ grid-template-columns: 1fr; }
      .grid{ grid-template-columns: repeat(2, minmax(0, 1fr)); }
    }
    @media (max-width: 560px){
      .topbar__inner{ flex-wrap:wrap; }
      .grid{ grid-template-columns: 1fr; }
      .brand small{ display:none; }
    }
  </style>
</head>

<body>
  <header class="topbar">
    <div class="topbar__inner">
      <div class="brand" aria-label="Marca">
        <div class="brand__logo">MM</div>
        <div>
          Mini Mercado<br/>
          <small>demo</small>
        </div>
      </div>

      <div class="search">
        <input id="q" type="search" placeholder="Buscar productos, marcas y m√°s‚Ä¶" autocomplete="off" />
      </div>

      <button class="btn btn--ghost" id="btnCart" aria-label="Abrir carrito">
        üõí Carrito <span class="badge" id="cartCount">0</span>
      </button>
      <button class="btn btn--primary" id="btnHelp" aria-label="Ayuda">
        ‚ú® Ayuda
      </button>
    </div>
  </header>

  <main class="wrap">
    <aside class="panel" aria-label="Filtros">
      <div class="panel__hd">
        <h3>Filtros</h3>
        <button class="btn btn--ghost" id="btnReset" title="Limpiar filtros">Limpiar</button>
      </div>
      <div class="panel__bd">
        <div class="field">
          <div class="label">Categor√≠a</div>
          <select id="category">
            <option value="all">Todas</option>
          </select>
        </div>

        <div class="field">
          <div class="label">Ordenar</div>
          <select id="sort">
            <option value="relevance">Relevancia</option>
            <option value="price_asc">Precio: menor a mayor</option>
            <option value="price_desc">Precio: mayor a menor</option>
            <option value="rating_desc">Mejor calificados</option>
          </select>
        </div>

        <div class="field">
          <div class="label">Env√≠o</div>
          <div class="chipbar" role="group" aria-label="Tipo de env√≠o">
            <button type="button" class="chip" data-ship="all" aria-pressed="true">Todos</button>
            <button type="button" class="chip" data-ship="free" aria-pressed="false">Env√≠o gratis</button>
            <button type="button" class="chip" data-ship="paid" aria-pressed="false">Env√≠o pago</button>
          </div>
        </div>

        <p class="hint">
          Demo educativa: datos falsos, sin pagos reales. Ideal como base para tu propio cat√°logo.
        </p>
      </div>
    </aside>

    <section aria-label="Listado">
      <div class="hero">
        <div>
          <h2 id="resultsTitle">Productos destacados</h2>
          <p id="resultsMeta">Explora, filtra y a√±ade al carrito.</p>
        </div>
        <div style="display:flex; gap:10px; align-items:center;">
          <button class="btn btn--ghost" id="btnRandom">üé≤ Sorpr√©ndeme</button>
          <button class="btn btn--primary" id="btnCheckout">üí≥ Finalizar</button>
        </div>
      </div>

      <div id="grid" class="grid" aria-live="polite"></div>
      <div id="empty" class="empty" style="display:none;">
        No encontr√© productos con esos filtros. Prueba con otra b√∫squeda.
      </div>
    </section>
  </main>

  <!-- Modal Carrito -->
  <dialog class="modal" id="cartModal" aria-label="Carrito">
    <div class="modal__card">
      <div class="modal__hd">
        <h3>Tu carrito</h3>
        <button class="btn btn--ghost" id="btnCloseCart">Cerrar</button>
      </div>
      <div class="modal__bd">
        <div id="cartList" class="cartlist"></div>

        <div class="totals">
          <div>
            <div style="font-size:12px; color:var(--muted); font-weight:700;">Total</div>
            <b id="cartTotal">$0</b>
          </div>
          <button class="btn btn--primary" id="btnPay">Pagar</button>
        </div>

        <p class="hint" style="margin-top:10px;">
          ‚ÄúPagar‚Äù solo muestra un resumen (no procesa pagos).
        </p>
      </div>
    </div>
  </dialog>

  <script>
    // ---- Datos demo (puedes reemplazar por API / BD) ----
    const PRODUCTS = [
      { id: 1, title: "Aud√≠fonos inal√°mbricos Bluetooth", price: 19.99, oldPrice: 29.99, rating: 4.6, category: "Electr√≥nica", freeShipping: true },
      { id: 2, title: "Teclado mec√°nico compacto RGB", price: 49.90, oldPrice: 69.90, rating: 4.7, category: "Electr√≥nica", freeShipping: false },
      { id: 3, title: "Zapatillas running livianas", price: 34.50, oldPrice: 44.50, rating: 4.3, category: "Moda", freeShipping: true },
      { id: 4, title: "Camisa casual de lino", price: 22.00, oldPrice: 0, rating: 4.2, category: "Moda", freeShipping: false },
      { id: 5, title: "Licuadora 2 velocidades 1.5L", price: 39.00, oldPrice: 55.00, rating: 4.4, category: "Hogar", freeShipping: true },
      { id: 6, title: "Juego de destornilladores 24 en 1", price: 11.75, oldPrice: 15.00, rating: 4.8, category: "Herramientas", freeShipping: true },
      { id: 7, title: "Smartwatch deportivo (b√°sico)", price: 26.90, oldPrice: 36.90, rating: 4.1, category: "Electr√≥nica", freeShipping: false },
      { id: 8, title: "Silla ergon√≥mica ajustable", price: 129.00, oldPrice: 159.00, rating: 4.5, category: "Hogar", freeShipping: false },
      { id: 9, title: "Mochila urbana impermeable", price: 18.40, oldPrice: 24.40, rating: 4.4, category: "Moda", freeShipping: true },
      { id: 10, title: "Kit de luces LED para habitaci√≥n", price: 14.99, oldPrice: 21.99, rating: 4.0, category: "Hogar", freeShipping: true },
      { id: 11, title: "Taladro inal√°mbrico 12V (demo)", price: 58.00, oldPrice: 79.00, rating: 4.6, category: "Herramientas", freeShipping: false },
      { id: 12, title: "Set de organizadores para closet", price: 16.30, oldPrice: 0, rating: 4.2, category: "Hogar", freeShipping: true },
    ];

    // ---- Estado ----
    const state = {
      q: "",
      category: "all",
      sort: "relevance",
      ship: "all", // all | free | paid
      cart: new Map(), // id -> qty
    };

    // ---- Utilidades ----
    const $ = (sel) => document.querySelector(sel);
    const $$ = (sel) => Array.from(document.querySelectorAll(sel));
    const money = (n) => "$" + n.toFixed(2);

    function getFilteredProducts() {
      const q = state.q.trim().toLowerCase();

      let items = PRODUCTS.filter(p => {
        const matchesQ = !q || p.title.toLowerCase().includes(q);
        const matchesCat = state.category === "all" || p.category === state.category;
        const matchesShip =
          state.ship === "all" ||
          (state.ship === "free" && p.freeShipping) ||
          (state.ship === "paid" && !p.freeShipping);

        return matchesQ && matchesCat && matchesShip;
      });

      // Orden
      switch (state.sort) {
        case "price_asc":
          items.sort((a,b) => a.price - b.price);
          break;
        case "price_desc":
          items.sort((a,b) => b.price - a.price);
          break;
        case "rating_desc":
          items.sort((a,b) => b.rating - a.rating);
          break;
        default:
          // "relevance": simple (rating + descuento)
          items.sort((a,b) => score(b) - score(a));
      }

      return items;

      function score(p){
        const discount = p.oldPrice > 0 ? (p.oldPrice - p.price) / p.oldPrice : 0;
        return (p.rating * 10) + (discount * 10) + (p.freeShipping ? 1 : 0);
      }
    }

    function render() {
      const grid = $("#grid");
      const empty = $("#empty");
      const items = getFilteredProducts();

      // Header
      const title = state.q ? `Resultados para "${state.q}"` : "Productos destacados";
      $("#resultsTitle").textContent = title;
      $("#resultsMeta").textContent = `${items.length} producto(s) ¬∑ filtros activos`;

      // Grid
      grid.innerHTML = "";
      empty.style.display = items.length ? "none" : "block";

      for (const p of items) {
        const discountPct = p.oldPrice > 0 ? Math.round((1 - p.price / p.oldPrice) * 100) : 0;

        const card = document.createElement("article");
        card.className = "card";
        card.innerHTML = `
          <div class="thumb">
            <div class="tag">${escapeHtml(p.category)}</div>
            <span>#${p.id} ¬∑ ${escapeHtml(p.title.split(" ")[0])}</span>
          </div>
          <div class="card__body">
            <h4 class="title">${escapeHtml(p.title)}</h4>
            <p class="price">
              <b>${money(p.price)}</b>
              ${p.oldPrice > 0 ? `<s>${money(p.oldPrice)}</s>` : ""}
              ${discountPct > 0 ? `<span style="color:var(--green); font-weight:900; font-size:13px;">${discountPct}% OFF</span>` : ""}
            </p>
            <div class="meta">
              <span>‚≠ê ${p.rating.toFixed(1)}</span>
              <span class="ship">${p.freeShipping ? "Env√≠o gratis" : "Env√≠o pago"}</span>
            </div>
          </div>
          <div class="card__actions">
            <button class="btn btn--ghost btn--block" data-action="details" data-id="${p.id}">Ver</button>
            <button class="btn btn--primary btn--block" data-action="add" data-id="${p.id}">A√±adir</button>
          </div>
        `;
        grid.appendChild(card);
      }

      renderCartBadge();
    }

    function renderCartBadge(){
      let count = 0;
      for (const qty of state.cart.values()) count += qty;
      $("#cartCount").textContent = String(count);
    }

    function openCart(){
      renderCartModal();
      $("#cartModal").setAttribute("open", "");
    }
    function closeCart(){
      $("#cartModal").removeAttribute("open");
    }

    function renderCartModal(){
      const list = $("#cartList");
      list.innerHTML = "";

      const entries = Array.from(state.cart.entries());
      if (!entries.length) {
        list.innerHTML = `<div class="empty">Tu carrito est√° vac√≠o. A√±ade algo üëÄ</div>`;
        $("#cartTotal").textContent = money(0);
        renderCartBadge();
        return;
      }

      let total = 0;

      for (const [id, qty] of entries) {
        const p = PRODUCTS.find(x => x.id === id);
        if (!p) continue;
        total += p.price * qty;

        const row = document.createElement("div");
        row.className = "cartrow";
        row.innerHTML = `
          <div>
            <b>${escapeHtml(p.title)}</b>
            <small>${escapeHtml(p.category)} ¬∑ ${p.freeShipping ? "Env√≠o gratis" : "Env√≠o pago"}</small>
          </div>
          <div class="qty" aria-label="Cantidad">
            <button data-cart="dec" data-id="${id}" title="Quitar uno">‚àí</button>
            <b style="min-width:22px; text-align:center;">${qty}</b>
            <button data-cart="inc" data-id="${id}" title="Agregar uno">+</button>
          </div>
          <div style="text-align:right;">
            <b>${money(p.price * qty)}</b>
            <div style="margin-top:6px;">
              <button class="btn btn--ghost" data-cart="remove" data-id="${id}" style="padding:8px 10px; border-radius:10px;">Eliminar</button>
            </div>
          </div>
        `;
        list.appendChild(row);
      }

      $("#cartTotal").textContent = money(total);
      renderCartBadge();
    }

    function addToCart(id){
      const prev = state.cart.get(id) || 0;
      state.cart.set(id, prev + 1);
      renderCartBadge();
    }

    function removeFromCart(id){
      state.cart.delete(id);
      renderCartBadge();
    }

    function changeQty(id, delta){
      const prev = state.cart.get(id) || 0;
      const next = prev + delta;
      if (next <= 0) state.cart.delete(id);
      else state.cart.set(id, next);
      renderCartBadge();
    }

    function escapeHtml(str){
      return String(str)
        .replaceAll("&","&amp;")
        .replaceAll("<","&lt;")
        .replaceAll(">","&gt;")
        .replaceAll('"',"&quot;")
        .replaceAll("'","&#039;");
    }

    // ---- Inicializaci√≥n UI ----
    function init(){
      // Categor√≠as
      const cats = Array.from(new Set(PRODUCTS.map(p => p.category))).sort();
      const sel = $("#category");
      for (const c of cats){
        const opt = document.createElement("option");
        opt.value = c;
        opt.textContent = c;
        sel.appendChild(opt);
      }

      // Listeners
      $("#q").addEventListener("input", (e) => {
        state.q = e.target.value;
        render();
      });

      $("#category").addEventListener("change", (e) => {
        state.category = e.target.value;
        render();
      });

      $("#sort").addEventListener("change", (e) => {
        state.sort = e.target.value;
        render();
      });

      $$(".chip").forEach(btn => {
        btn.addEventListener("click", () => {
          const ship = btn.dataset.ship;
          state.ship = ship;

          $$(".chip").forEach(x => x.setAttribute("aria-pressed", String(x === btn)));
          render();
        });
      });

      $("#btnReset").addEventListener("click", () => {
        state.q = "";
        state.category = "all";
        state.sort = "relevance";
        state.ship = "all";
        state.cart.clear();

        $("#q").value = "";
        $("#category").value = "all";
        $("#sort").value = "relevance";
        const firstChip = $$(".chip")[0];
        $$(".chip").forEach(x => x.setAttribute("aria-pressed", String(x === firstChip)));

        render();
      });

      // Delegaci√≥n para botones dentro de cards
      $("#grid").addEventListener("click", (e) => {
        const btn = e.target.closest("button");
        if (!btn) return;

        const id = Number(btn.dataset.id);
        const action = btn.dataset.action;

        if (action === "add") {
          addToCart(id);
        } else if (action === "details") {
          const p = PRODUCTS.find(x => x.id === id);
          alert(`üì¶ ${p.title}\n\nPrecio: ${money(p.price)}\nRating: ${p.rating}\nEnv√≠o: ${p.freeShipping ? "Gratis" : "Pago"}\n\n(Esto es demo, aqu√≠ podr√≠as abrir una p√°gina de producto.)`);
        }
      });

      $("#btnCart").addEventListener("click", openCart);
      $("#btnCloseCart").addEventListener("click", closeCart);

      $("#cartModal").addEventListener("click", (e) => {
        // click fuera de la tarjeta cierra
        const card = e.target.closest(".modal__card");
        if (!card) closeCart();
      });

      $("#cartList").addEventListener("click", (e) => {
        const btn = e.target.closest("button");
        if (!btn) return;
        const id = Number(btn.dataset.id);
        const act = btn.dataset.cart;

        if (act === "inc") changeQty(id, +1);
        if (act === "dec") changeQty(id, -1);
        if (act === "remove") removeFromCart(id);

        renderCartModal();
      });

      $("#btnPay").addEventListener("click", () => {
        const entries = Array.from(state.cart.entries());
        if (!entries.length) return alert("Tu carrito est√° vac√≠o üôÇ");
        const lines = entries.map(([id,qty]) => {
          const p = PRODUCTS.find(x => x.id === id);
          return `‚Ä¢ ${qty} √ó ${p.title} = ${money(p.price * qty)}`;
        });
        const total = lines.length ? $("#cartTotal").textContent : money(0);
        alert(`‚úÖ Resumen (demo)\n\n${lines.join("\n")}\n\nTotal: ${total}\n\nAqu√≠ integrar√≠as tu pasarela de pago.`);
      });

      $("#btnCheckout").addEventListener("click", () => openCart());

      $("#btnRandom").addEventListener("click", () => {
        const items = getFilteredProducts();
        if (!items.length) return;
        const p = items[Math.floor(Math.random() * items.length)];
        addToCart(p.id);
        alert(`üéâ Agregu√© al carrito: ${p.title}`);
        render();
      });

      $("#btnHelp").addEventListener("click", () => {
        alert("Demo mini-market:\n- Busca en la barra\n- Filtra por categor√≠a y env√≠o\n- Ordena por precio o rating\n- A√±ade al carrito y ajusta cantidades\n\n¬øQuieres que lo conecte a una API real (Django/Node) y tenga p√°ginas de producto?");
      });

      render();
    }

    init();
  </script>
</body>
</html>



<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Tu DiamanteðŸ’Ž</title>
  <!-- Fuente chubby -->
  <link href="https://fonts.googleapis.com/css2?family=Baloo+2:wght@400;600;700&display=swap" rel="stylesheet">
  <!-- Tel input (banderas y cÃ³digo de paÃ­s) -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/intl-tel-input@19.5.6/build/css/intlTelInput.css" />
  <style>
    :root{
      --bg:#ffffff; /* fondo blanco */
      --ink:#1c1e21;
      --muted:#6b7280;
      --brand:#111827; /* negro suave */
      --brand-2:#0ea5e9; /* acento sutil */
      --ok:#16a34a; --warn:#ef4444; --border:#e5e7eb; --chip:#f3f4f6;
    }
    html,body{height:100%;}
    body{
      margin:0; background:var(--bg); color:var(--ink);
      font-family:"Baloo 2", system-ui, -apple-system, Segoe UI, Roboto, sans-serif;
      -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale;
    }
    .container{max-width:1200px; margin:0 auto; padding:16px;}
    .app-title{display:flex; align-items:center; gap:12px;}
    .app-title h1{font-size:28px; margin:0; font-weight:800; letter-spacing:.3px;}
    .bar{height:10px; background:#f3f4f6; border-radius:999px; overflow:hidden; border:1px solid var(--border);} 
    .bar>span{display:block; height:100%; background:linear-gradient(90deg,var(--brand-2),#22c55e); width:0%; transition:width .4s ease;}

    /* Layout */
    .grid-layout{display:grid; grid-template-columns: 1fr; gap:16px; margin-top:12px;}
    @media(min-width:1024px){ .grid-layout{ grid-template-columns: 2fr 1fr; } }

    .panel{background:#fff; border:1px solid var(--border); border-radius:16px; padding:16px; box-shadow:0 1px 2px rgba(0,0,0,.04);} 
    .panel h2{margin:0 0 12px 0; font-size:20px;}
    .subtle{color:var(--muted); font-size:14px;}

    /* Lista de boletos */
    .tickets-toolbar{display:flex; flex-wrap:wrap; align-items:center; gap:8px; margin-bottom:10px;}
    .search{position:relative; flex:1 1 220px;}
    .search input{width:100%; border:1px solid var(--border); border-radius:999px; padding:10px 36px 10px 40px; font-size:14px; outline:none;}
    .search svg{position:absolute; left:12px; top:50%; transform:translateY(-50%);} 

    .page-controls{display:flex; gap:6px; align-items:center;}
    .btn{border:1px solid var(--border); background:#fff; border-radius:12px; padding:8px 12px; font-weight:700; cursor:pointer; transition:.2s;}
    .btn:hover{transform:translateY(-1px);} 
    .btn.primary{background:var(--brand); color:#fff; border-color:var(--brand);} 
    .btn.secondary{background:#f8fafc;}
    .btn[disabled]{opacity:.6; cursor:not-allowed;}

    .square-wrap{width:100%; aspect-ratio:1/1; border:1px solid var(--border); border-radius:16px; overflow:hidden; display:flex;}
    .square-inner{flex:1; overflow:auto;}

    .ticket-grid{display:grid; grid-template-columns: repeat(6, 1fr); gap:6px; padding:10px;}
    @media(min-width:480px){ .ticket-grid{ grid-template-columns: repeat(8, 1fr);} }
    @media(min-width:768px){ .ticket-grid{ grid-template-columns: repeat(10, 1fr);} }
    @media(min-width:1024px){ .ticket-grid{ grid-template-columns: repeat(12, 1fr);} }
    @media(min-width:1280px){ .ticket-grid{ grid-template-columns: repeat(14, 1fr);} }

    .ticket{user-select:none; text-align:center; padding:8px 0; border:1px solid var(--border); border-radius:10px; background:#fff; font-weight:700; font-size:14px; cursor:pointer; transition:.15s;}
    .ticket:hover{background:#f9fafb;}
    .ticket.sold{background:#fee2e2; color:#991b1b; border-color:#fecaca; cursor:not-allowed;}
    .ticket.selected{background:#dbeafe; border-color:#bfdbfe;}

    .chips{display:flex; flex-wrap:wrap; gap:8px;}
    .chip{display:inline-flex; align-items:center; gap:6px; background:var(--chip); border:1px solid var(--border); border-radius:999px; padding:6px 10px; font-weight:700;}
    .chip button{border:none; background:transparent; cursor:pointer; font-size:16px; line-height:1;}

    .totals{display:flex; flex-wrap:wrap; align-items:center; gap:10px; margin-top:8px;}
    .tag{background:#eef2ff; color:#3730a3; border:1px solid #e0e7ff; font-weight:800; border-radius:999px; padding:6px 10px;}

    .note{margin-top:8px; font-size:14px; color:#0f172a;}
    .note.warn{color:#b91c1c;}

    /* Formulario */
    .form{display:grid; gap:10px; grid-template-columns:1fr;}
    @media(min-width:640px){ .form{ grid-template-columns:1fr 1fr; } }
    .field{display:flex; flex-direction:column; gap:6px;}
    .field label{font-weight:700;}
    .field input, .field select, .field textarea{border:1px solid var(--border); border-radius:12px; padding:10px 12px; font-size:14px; outline:none;}

    .pay-methods{display:flex; gap:10px; flex-wrap:wrap;}
    .pm-card{flex:1 1 160px; min-width:160px; border:1px solid var(--border); border-radius:14px; padding:12px; cursor:pointer; display:flex; align-items:center; gap:10px;}
    .pm-card.active{outline:2px solid var(--brand-2);}
    .pm-card img{width:28px; height:28px; object-fit:contain;}
    .pm-details{background:#f8fafc; border:1px dashed var(--border); border-radius:12px; padding:12px;}

    .divider{height:1px; background:var(--border); margin:16px 0;}

    /* Verificador */
    .verif{display:grid; gap:10px;}
    .radio{display:flex; gap:14px; align-items:center;}
    .result-card{border:1px solid var(--border); border-radius:12px; padding:12px; background:#fff;}

    footer{margin:28px 0 10px; text-align:center; color:var(--muted); font-size:13px;}
  </style>
</head>
<body>
  <div class="container">
    <header class="app-title">
      <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M8 21h8"/><path d="M12 17v4"/><path d="M7 8h10"/><path d="M7 12h10"/><path d="M7 16h10"/><path d="M3 5h18"/><path d="M6 2h12v3H6z"/></svg>
      <h1>Tu DiamanteðŸ’Ž</h1>
    </header>

    <section style="margin:10px 0 18px;">
      <div style="display:flex; align-items:center; justify-content:space-between; gap:12px; flex-wrap:wrap;">
        <div>
          <div class="subtle">Progreso de ventas</div>
          <div class="bar"><span id="soldBar"></span></div>
          <div class="subtle" style="margin-top:6px;">
            Vendidos: <b id="soldCount">0</b> / 10.000 â€” <b id="soldPct">0%</b>
          </div>
        </div>
        <button id="btnRandom" class="btn secondary" title="Generar 3 boletos a la suerte">ðŸŽ² Generar boletos aleatorios</button>
      </div>
    </section>

    <div class="grid-layout">
      <!-- LISTA DE BOLETOS -->
      <section class="panel">
        <h2>Lista de boletos</h2>
        <div class="subtle">Rango por pÃ¡gina (5 en total). Por defecto estÃ¡s en la PÃ¡gina 1 (0000â€“1999).</div>
        <div class="tickets-toolbar">
          <div class="search">
            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.3-4.3"/></svg>
            <input id="searchInput" type="text" inputmode="numeric" maxlength="4" placeholder="Lupa: escribe # de boleto" />
          </div>
          <div class="page-controls">
            <span class="subtle">PÃ¡gina:</span>
            <div id="pagination"></div>
          </div>
        </div>
        <div class="square-wrap">
          <div class="square-inner">
            <div id="tickets" class="ticket-grid" aria-live="polite"></div>
          </div>
        </div>
        <div class="totals">
          <span class="tag">Precio por boleto: <b>15 Bs</b></span>
          <span class="tag">Seleccionados: <b id="selCount">0</b></span>
          <span class="tag">Total: <b id="totalAmount">0 Bs</b></span>
        </div>
        <div id="minMsg" class="note warn" style="display:none;">Compra mÃ­nima 3 boletos.</div>
        <div style="margin-top:10px;">
          <div class="subtle">Tus boletos seleccionados</div>
          <div id="selectedChips" class="chips"></div>
        </div>
      </section>

      <!-- FORMULARIO -->
      <section class="panel">
        <h2>Datos personales & pago</h2>
        <form id="buyForm" class="form" autocomplete="off">
          <div class="field">
            <label for="name">Nombre y apellido</label>
            <input id="name" type="text" placeholder="Ej: Ana PÃ©rez" required />
          </div>
          <div class="field">
            <label for="idnum">CÃ©dula</label>
            <input id="idnum" type="text" placeholder="V-12345678" required />
          </div>
          <div class="field" style="grid-column:1 / -1;">
            <label for="phone">TelÃ©fono</label>
            <input id="phone" type="tel" placeholder="Ingresa tu nÃºmero" required />
          </div>
          <div class="field">
            <label for="ref6">Ãšltimos 6 dÃ­gitos de la referencia de pago</label>
            <input id="ref6" type="text" inputmode="numeric" maxlength="6" placeholder="Ej: 123456" required />
          </div>
          <div class="field">
            <label for="proof">Comprobante de pago</label>
            <input id="proof" type="file" accept="image/*,application/pdf" required />
          </div>

          <div class="field" style="grid-column:1 / -1;">
            <label>MÃ©todos de pago</label>
            <div class="pay-methods" id="payMethods"></div>
          </div>
          <div id="payDetails" class="pm-details" style="display:none;"></div>

          <div style="grid-column:1 / -1; display:flex; gap:10px; align-items:center; justify-content:flex-end;">
            <button type="button" id="btnConfirm" class="btn primary">Confirmar compra</button>
          </div>
        </form>
      </section>
    </div>

    <div class="panel" style="margin-top:16px;">
      <h2>Verificador de boletos</h2>
      <div class="verif">
        <div class="radio">
          <label><input type="radio" name="vmode" value="phone" checked> Por telÃ©fono</label>
          <label><input type="radio" name="vmode" value="ticket"> Por # Boleto</label>
        </div>
        <div style="display:flex; gap:8px; flex-wrap:wrap;">
          <input id="verifyInput" class="" style="flex:1 1 240px; border:1px solid var(--border); border-radius:12px; padding:10px 12px;" placeholder="Ingresa telÃ©fono (con cÃ³digo) o boleto (0000â€“9999)" />
          <button id="btnVerify" class="btn secondary" type="button">ðŸ”Ž Verificar</button>
        </div>
        <div id="verifyOut"></div>
      </div>
    </div>

    <footer>
      &copy; <span id="year"></span> Tu DiamanteðŸ’Ž. Todos los derechos reservados.
    </footer>
  </div>

  <!-- Scripts -->
  <script src="https://cdn.jsdelivr.net/npm/intl-tel-input@19.5.6/build/js/intlTelInput.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/intl-tel-input@19.5.6/build/js/utils.js"></script>
  <script>
    /* ==========================
       CONFIG editable por ti
       ========================== */
    const PRICE_PER_TICKET = 15; // Bs
    const TOTAL_TICKETS = 10000; // 0000-9999
    const PAGE_SIZE = TOTAL_TICKETS / 5; // 2000 por pÃ¡gina

    // Edita aquÃ­ los mÃ©todos de pago (logos por URL + datos a mostrar)
    const PAYMENT_METHODS = [
      {
        key: 'pago_movil_ve',
        name: 'Pago mÃ³vil Venezuela',
        logo: 'https://yt3.googleusercontent.com/qU-98KY8CF7zA94qy89pEEgw8opMrFR4oxy11Az5uaZPrnlGYiYPH1L1zUgZU7eAvAs_lk7m4g=s900-c-k-c0x00ffffff-no-rj', // cambia la URL
        details: [
          'Banco: 0102 ',
          'TelÃ©fono: 0424-8417632',
          'CÃ©dula/RIF: V-31490382',
          'Titular: Angel Zabala'
        ]
      },
      {
        key: 'pago_movil_banesco',
        name: 'Pago mÃ³vil Banesco',
        logo: 'https://play-lh.googleusercontent.com/vkJ-EedrvUkZydDP3mbVGxENwpWu5nHXg77sI0I-0qnKKLqPrtMIsn8Es6ITzsdgwK_w', // cambia la URL
        details: [
          'Banco: 0134 ',
          'TelÃ©fono: 0414-8516619',
          'CÃ©dula/RIF: V-14884043X',
          'Titular: Iraima Jimenez '
        ]
      },
      {
        key: 'binance',
        name: 'Binance',
        logo: 'https://upload.wikimedia.org/wikipedia/commons/5/57/Binance_Logo.png', // cambia la URL
        details: [
          'Correo: angelitojavier277@gmail.com',
         
        ]
      }
    ];

    /* ==========================
       Estado y utilidades
       ========================== */
    const el = s => document.querySelector(s);
    const els = s => Array.from(document.querySelectorAll(s));

    const soldKey = 'rifas_soldTickets_v1';
    const ordersKey = 'rifas_orders_v1';

    const getSold = () => new Set(JSON.parse(localStorage.getItem(soldKey) || '[]'));
    const setSold = (set) => localStorage.setItem(soldKey, JSON.stringify([...set]));
    const getOrders = () => JSON.parse(localStorage.getItem(ordersKey) || '[]');
    const setOrders = (arr) => localStorage.setItem(ordersKey, JSON.stringify(arr));

    const pad4 = n => n.toString().padStart(4, '0');

    let selected = new Set();
    let currentPage = 1; // 1..5

    // TelÃ©fono con bandera
    let iti = null;

    function updateProgress(){
      const sold = getSold();
      const pct = Math.round((sold.size / TOTAL_TICKETS) * 100);
      el('#soldBar').style.width = pct + '%';
      el('#soldCount').textContent = sold.size.toLocaleString('es-VE');
      el('#soldPct').textContent = pct + '%';
    }

    function pageRange(page){
      const start = (page-1)*PAGE_SIZE; // inclusive
      const end = start + PAGE_SIZE - 1; // inclusive
      return [start, end];
    }

    function buildPagination(){
      const wrap = el('#pagination');
      wrap.innerHTML = '';
      for(let p=1;p<=5;p++){
        const [a,b] = pageRange(p);
        const btn = document.createElement('button');
        btn.className = 'btn' + (p===currentPage ? ' primary' : '');
        btn.textContent = p;
        btn.title = `PÃ¡gina ${p} â€” ${pad4(a)}â€“${pad4(b)}`;
        btn.addEventListener('click', ()=>{ currentPage=p; buildPagination(); renderTickets(); });
        wrap.appendChild(btn);
      }
    }

    function isAvailable(num){
      const sold = getSold();
      return !sold.has(num) && !selected.has(num);
    }

    function renderTickets(){
      const grid = el('#tickets');
      grid.innerHTML = '';
      const sold = getSold();
      const [start, end] = pageRange(currentPage);
      for(let n=start; n<=end; n++){
        const btn = document.createElement('button');
        btn.className = 'ticket';
        btn.textContent = pad4(n);
        if(sold.has(n)){
          btn.classList.add('sold');
          btn.disabled = true;
          btn.title = 'Vendido';
        }else if(selected.has(n)){
          btn.classList.add('selected');
          btn.disabled = true;
          btn.title = 'Ya seleccionado';
        }else{
          btn.addEventListener('click', ()=>selectTicket(n));
        }
        grid.appendChild(btn);
      }
      updateTotalsUI();
    }

    function selectTicket(n){
      selected.add(n);
      renderTickets();
      renderSelectedChips();
    }
    function deselectTicket(n){
      selected.delete(n);
      renderTickets();
      renderSelectedChips();
    }

    function renderSelectedChips(){
      const box = el('#selectedChips');
      box.innerHTML = '';
      [...selected].sort((a,b)=>a-b).forEach(n=>{
        const chip = document.createElement('span');
        chip.className = 'chip';
        chip.innerHTML = `<span>#${pad4(n)}</span>`;
        const x = document.createElement('button');
        x.setAttribute('type','button');
        x.setAttribute('aria-label','Quitar boleto');
        x.textContent = 'Ã—';
        x.addEventListener('click', ()=>deselectTicket(n));
        chip.appendChild(x);
        box.appendChild(chip);
      });
    }

    function updateTotalsUI(){
      const count = selected.size;
      const total = count * PRICE_PER_TICKET;
      el('#selCount').textContent = count;
      el('#totalAmount').textContent = total + ' Bs';
      // mensaje mÃ­nimo (se muestra sÃ³lo si intentan confirmar con <3)
      el('#minMsg').style.display = 'none';
    }

    function randomPick(count=3){
      // todas las disponibles
      const sold = getSold();
      const pool = [];
      for(let n=0;n<TOTAL_TICKETS;n++) if(!sold.has(n) && !selected.has(n)) pool.push(n);
      if(pool.length === 0){
        alert('No hay boletos disponibles.');
        return;
      }
      while(selected.size < count && pool.length){
        const idx = Math.floor(Math.random()*pool.length);
        const n = pool.splice(idx,1)[0];
        selected.add(n);
      }
      // Mueve a la pÃ¡gina del primero seleccionado nuevo para que se vea
      if(selected.size){
        const first = [...selected].sort((a,b)=>a-b)[0];
        currentPage = Math.floor(first / PAGE_SIZE) + 1;
      }
      buildPagination();
      renderTickets();
      renderSelectedChips();
    }

    // Buscar/jump por #
    function handleSearch(){
      const raw = el('#searchInput').value.trim();
      if(!/^\d{1,4}$/.test(raw)) return;
      const n = parseInt(raw,10);
      if(n<0 || n>9999) return;
      const page = Math.floor(n / PAGE_SIZE) + 1;
      currentPage = page; buildPagination(); renderTickets();
      // destacar si estÃ¡ disponible / mensaje si vendido
      const sold = getSold();
      if(sold.has(n)){
        alert(`El boleto ${pad4(n)} ya estÃ¡ vendido.`);
        return;
      }
      if(selected.has(n)){
        alert(`El boleto ${pad4(n)} ya estÃ¡ en tu selecciÃ³n.`);
        return;
      }
      // Autoseleccionar para agilizar
      selectTicket(n);
    }

    // Pago: render mÃ©todos
    function renderPayMethods(){
      const wrap = el('#payMethods');
      wrap.innerHTML = '';
      PAYMENT_METHODS.forEach((m,i)=>{
        const card = document.createElement('div');
        card.className = 'pm-card';
        card.innerHTML = `<img src="${m.logo}" alt="${m.name}"><div><div style="font-weight:800;">${m.name}</div></div>`;
        card.addEventListener('click', ()=>selectPayMethod(m.key));
        card.dataset.key = m.key;
        wrap.appendChild(card);
      });
    }

    let chosenPayKey = null;
    function selectPayMethod(key){
      chosenPayKey = key;
      els('.pm-card').forEach(c=>c.classList.toggle('active', c.dataset.key===key));
      const m = PAYMENT_METHODS.find(x=>x.key===key);
      const d = el('#payDetails');
      d.style.display = 'block';
      d.innerHTML = `<div style="font-weight:800; margin-bottom:6px;">Datos para ${m.name}</div>` +
        '<ul style="margin:0; padding-left:18px;">' + m.details.map(x=>`<li>${x}</li>`).join('') + '</ul>' +
        '<div class="subtle" style="margin-top:8px;">* Copia los datos y realiza el pago. Luego sube el comprobante.</div>';
    }

    // Confirmar compra
    async function confirmPurchase(){
      if(selected.size < 3){
        el('#minMsg').style.display = 'block';
        // scroll a mensaje
        el('#minMsg').scrollIntoView({behavior:'smooth', block:'center'});
        return;
      }
      const name = el('#name').value.trim();
      const idnum = el('#idnum').value.trim();
      const ref6 = el('#ref6').value.trim();
      const proof = el('#proof').files[0] || null;
      if(!name || !idnum){ alert('Completa nombre y cÃ©dula.'); return; }
      if(!iti){ alert('Error con el campo de telÃ©fono.'); return; }
      const phoneE164 = iti.getNumber();
      if(!phoneE164){ alert('Ingresa un telÃ©fono vÃ¡lido.'); return; }
      if(!/^\d{6}$/.test(ref6)){ alert('La referencia debe tener exactamente 6 dÃ­gitos.'); return; }
      if(!chosenPayKey){ alert('Selecciona un mÃ©todo de pago.'); return; }
      if(!proof){ alert('Sube el comprobante de pago.'); return; }

      // Convertir comprobante a DataURL para almacenarlo (demo). En producciÃ³n: subir a servidor.
      const proofDataUrl = await new Promise((res,rej)=>{
        const r = new FileReader(); r.onload = () => res(r.result); r.onerror = rej; r.readAsDataURL(proof);
      });

      // Guardar pedido
      const order = {
        id: 'ORD-' + Date.now(),
        name, idnum, phone: phoneE164,
        payMethod: chosenPayKey,
        ref6,
        proof: proofDataUrl,
        tickets: [...selected].sort((a,b)=>a-b),
        price: PRICE_PER_TICKET,
        total: selected.size * PRICE_PER_TICKET,
        createdAt: new Date().toISOString()
      };
      const orders = getOrders(); orders.push(order); setOrders(orders);

      // Marcar boletos como vendidos
      const sold = getSold();
      order.tickets.forEach(n=> sold.add(n));
      setSold(sold);

      // Reset de selecciÃ³n y UI
      selected.clear();
      renderSelectedChips();
      renderTickets();
      updateProgress();
      updateTotalsUI();
      alert(`Â¡Compra confirmada!\nPedido: ${order.id}\nBoletos: ${order.tickets.map(pad4).join(', ')}`);

      // Scroll arriba
      window.scrollTo({top:0, behavior:'smooth'});
    }

    // Verificador
    function verify(){
      const mode = document.querySelector('input[name="vmode"]:checked').value;
      const raw = el('#verifyInput').value.trim();
      const out = el('#verifyOut');
      out.innerHTML = '';
      const orders = getOrders();

      if(mode==='phone'){
        // Intentar normalizar con el mismo input (si existe iti)
        let phone = raw;
        try{
          if(iti){ phone = iti.getNumber(); }
        }catch{}
        const hits = orders.filter(o=>o.phone.includes(raw) || o.phone===raw);
        if(hits.length===0){ out.innerHTML = '<div class="subtle">No se encontraron compras para ese telÃ©fono.</div>'; return; }
        hits.forEach(o=> out.appendChild(orderCard(o)) );
      } else {
        if(!/^\d{1,4}$/.test(raw)){ out.innerHTML = '<div class="subtle">Ingresa un # de boleto vÃ¡lido (0000â€“9999).</div>'; return; }
        const t = parseInt(raw,10);
        const hit = orders.find(o=> o.tickets.includes(t));
        if(!hit){ out.innerHTML = `<div class="subtle">El boleto ${pad4(t)} no aparece como vendido.</div>`; return; }
        out.appendChild(orderCard(hit));
      }
    }

    function orderCard(o){
      const wrap = document.createElement('div');
      wrap.className = 'result-card';
      const pm = PAYMENT_METHODS.find(x=>x.key===o.payMethod);
      wrap.innerHTML = `
        <div style="display:flex; justify-content:space-between; align-items:center; gap:8px; flex-wrap:wrap;">
          <div style="font-weight:800;">Pedido ${o.id}</div>
          <div class="subtle">${new Date(o.createdAt).toLocaleString('es-VE')}</div>
        </div>
        <div class="divider"></div>
        <div style="display:grid; grid-template-columns:1fr 1fr; gap:8px;">
          <div><b>Nombre:</b> ${o.name}</div>
          <div><b>CÃ©dula:</b> ${o.idnum}</div>
          <div><b>TelÃ©fono:</b> ${o.phone}</div>
          <div><b>MÃ©todo:</b> ${pm?pm.name:o.payMethod}</div>
          <div><b>Ref (6 dÃ­g):</b> ${o.ref6}</div>
          <div><b>Total:</b> ${o.total} Bs</div>
        </div>
        <div style="margin-top:8px;"><b>Boletos:</b> ${o.tickets.map(pad4).join(', ')}</div>
        <details style="margin-top:8px;">
          <summary>Ver comprobante</summary>
          <div style="margin-top:8px;">
            ${o.proof.startsWith('data:application/pdf') ? `<iframe src="${o.proof}" style="width:100%; height:400px; border:1px solid var(--border); border-radius:12px;"></iframe>` : `<img src="${o.proof}" alt="Comprobante" style="max-width:100%; border-radius:12px; border:1px solid var(--border);" />`}
          </div>
        </details>
      `;
      return wrap;
    }

    // Init
    window.addEventListener('DOMContentLoaded', ()=>{
      el('#year').textContent = new Date().getFullYear();

      // Intl Tel Input init
      const phoneInput = el('#phone');
      try{
        iti = window.intlTelInput(phoneInput, {
          initialCountry: 've',
          separateDialCode: true,
          utilsScript: 'https://cdn.jsdelivr.net/npm/intl-tel-input@19.5.6/build/js/utils.js'
        });
      }catch(err){ console.warn('intl-tel-input no pudo inicializarse:', err); }

      // PaginaciÃ³n + lista (por defecto pÃ¡gina 1 => 0000â€“1999)
      buildPagination();
      renderTickets();
      updateProgress();
      renderPayMethods();

      // Eventos UI
      el('#btnRandom').addEventListener('click', ()=>randomPick(3));
      el('#searchInput').addEventListener('keydown', (e)=>{ if(e.key==='Enter'){ e.preventDefault(); handleSearch(); }});
      el('#btnConfirm').addEventListener('click', confirmPurchase);
      el('#btnVerify').addEventListener('click', verify);

      // Restaurar scroll al cambiar tamaÃ±o para mantener cuadrado visible
      window.addEventListener('resize', ()=>{ /* layout responsive sin acciones extra */ });
    });
  </script>
</body>
</html>

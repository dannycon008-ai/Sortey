<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>ChispaLive — Demo</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">

  <style>
    :root{
      --brand:#ff2e6a;
      --bg:#0b1220;
      --card:#0f1a2b;
      --line:#1b3150;
      --text:#e9f6ff;
      --sub:#9bc2df;
      --ok:#27ae60;
      --warn:#ffb020;
      --vip:#ffd54d;
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0;font-family:Poppins,system-ui,sans-serif;background:var(--bg);color:var(--text)}
    .container{max-width:1100px;margin:0 auto;padding:16px}
    .header{position:sticky;top:0;z-index:50;background:rgba(10,18,32,.85);backdrop-filter:blur(6px);border-bottom:1px solid #132338}
    .header-inner{display:flex;justify-content:space-between;align-items:center;padding:12px 16px}
    .brand{display:flex;align-items:center;gap:10px;font-weight:700}
    .btn{border:0;padding:8px 12px;border-radius:10px;font-weight:600;cursor:pointer;transition:.15s;font-size:14px}
    .btn:active{transform:translateY(1px)}
    .btn-primary{background:var(--brand);color:#fff}
    .btn-ghost{background:transparent;color:#cfe7ff;border:1px solid #244362}
    .btn-warning{background:var(--warn);color:#1b1407}
    .input{width:100%;background:#0e192a;color:#d9eeff;border:1px solid #1f3550;border-radius:12px;padding:10px 12px}
    .card{background:var(--card);border:1px solid var(--line);border-radius:18px;padding:16px;box-shadow:0 10px 32px rgba(0,0,0,.35)}
    .small{color:var(--sub);font-size:12px}
    .view{display:none}.view.active{display:block}

    /* ====== Monedas ====== */
    .coins-badge{
      display:inline-flex;align-items:center;gap:6px;
      background:#0e192a;border:1px solid #233f60;padding:6px 10px;border-radius:999px;
      font-weight:700
    }
    .coins-badge img{height:18px;width:18px;object-fit:contain;display:block}

    /* ====== Título animado ====== */
    .title-hero{
      font-weight:800;font-size:22px;margin:10px 0 0 0;
      display:inline-flex;align-items:center;gap:8px;
      background:linear-gradient(90deg,#fff,#ffd1dc,#fff);
      -webkit-background-clip:text;background-clip:text;color:transparent;
      animation:shine 2.4s linear infinite, pulseZoom 3.8s ease-in-out infinite;
      text-shadow:0 0 18px rgba(255,255,255,.12);
    }
    @keyframes shine{0%{filter:brightness(1)}50%{filter:brightness(1.25)}100%{filter:brightness(1)}}
    @keyframes pulseZoom{0%,100%{transform:scale(1)}50%{transform:scale(1.04)}}

    /* ====== Modelos ====== */
    .model-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:18px;margin-top:18px}
    .model-card{background:#fff;color:#000;border-radius:14px;overflow:hidden;box-shadow:0 4px 20px rgba(0,0,0,.12);display:flex;flex-direction:column;cursor:pointer;transition:transform .25s, box-shadow .25s;animation:softFloat 4s ease-in-out infinite}
    .model-card:hover{transform:translateY(-4px) scale(1.02);box-shadow:0 12px 30px rgba(0,0,0,.2)}
    @keyframes softFloat{0%,100%{transform:translateY(0)}50%{transform:translateY(-6px)}}
    .model-slideshow{position:relative;height:200px}
    .model-slideshow img{position:absolute;inset:0;width:100%;height:100%;object-fit:cover;opacity:0;transition:opacity .6s ease}
    .model-slideshow img.active{opacity:1}
    .model-card .info{padding:12px;display:flex;flex-direction:column;gap:6px}
    .model-card .name{font-weight:700;font-size:16px;color:#111}
    .model-card .extra{font-size:12px;color:#555}
    .model-card .desc{font-size:13px;color:#333}
    .model-card .online{display:inline-block;background:var(--ok);color:#fff;font-size:12px;padding:2px 6px;border-radius:6px;margin-left:6px}
    .model-card .actions{display:flex;gap:10px;justify-content:space-between;align-items:center;padding:10px 12px;background:#f7f9fb;border-top:1px solid #eaeef3}
    .action-btn{display:flex;align-items:center;gap:8px;padding:8px 12px;border-radius:10px;border:1px solid #e0e6ee;background:#fff;cursor:pointer;transition:.2s;font-weight:600;font-size:13px;color:#222}
    .action-btn:hover{transform:translateY(-2px);box-shadow:0 6px 16px rgba(0,0,0,.08)}
    .action-btn img{width:18px;height:18px;display:block}
    .like-badge{background:var(--brand);color:#fff;font-size:12px;padding:2px 8px;border-radius:999px}

    /* ====== Banner Video ====== */
    .banner-wrap{position:relative;margin-top:8px}
    .banner-wrap video{width:100%;max-height:180px;object-fit:cover;border-radius:14px;display:block}
    .live-badge{position:absolute;top:12px;left:12px;background:#001f99;color:#fff;font-weight:700;font-size:14px;padding:6px 12px;border-radius:10px;animation:pulse 1.5s infinite;box-shadow:0 0 8px rgba(0,0,0,.4)}
    @keyframes pulse{0%{transform:scale(1);opacity:1}50%{transform:scale(1.1);opacity:.85}100%{transform:scale(1);opacity:1}}

    /* ====== Interstitial ====== */
    .interstitial{position:fixed;inset:0;background:rgba(0,0,0,.75);display:none;place-items:center;z-index:2000}
    .interstitial.show{display:grid}
    .interstitial .inner{background:var(--card);border:1px solid var(--line);border-radius:18px;overflow:hidden;width:min(640px,95vw)}
    .interstitial .bar{display:flex;justify-content:space-between;align-items:center;padding:8px 12px;border-top:1px solid var(--line)}
    .countdown{font-size:12px;opacity:.8;margin-right:auto;margin-left:8px}

    /* ====== Toasts ====== */
    .toast-wrap{position:fixed;right:16px;bottom:16px;display:flex;flex-direction:column;gap:10px;z-index:3000}
    .toast{background:#0e1a2a;color:#d8ecff;border:1px solid #27507c;padding:12px 14px;border-radius:12px;box-shadow:0 8px 24px rgba(0,0,0,.35);animation:floatIn .25s ease;display:flex;align-items:flex-start;gap:8px}
    .toast.ok{border-color:#2f7c4b}
    .toast.warn{border-color:#7c5b2f}
    .toast .title{font-weight:700;margin-bottom:4px}
    .toast .close{margin-left:auto;background:transparent;border:0;color:#cfe7ff;cursor:pointer}
  </style>
  <script type="module">
    /* ======================= CONFIGURACIÓN ======================== */
    const PAYPAL_CLIENT_ID = 'TU_CLIENT_ID_PAYPAL'; // Pega tu client-id real aquí
    const COIN_ICON_URL = 'https://i.imgur.com/5o8w7oS.png';
    const VIP_ICON_URL  = 'https://i.imgur.com/1F2r0yN.png';
    const FACEBOOK_ICON_URL = 'https://i.imgur.com/6c1mQw6.png';
    const PRIV_ICON_URL = 'https://i.imgur.com/Q8oQH0x.png';

    // URLs del banner
    const BANNER_LINK = 'https://tu-enlace-banner.com';
    const BANNER_VIDEO = 'https://qu.ax/dMvpz.mp4';

    // Misiones: logos y enlaces por página
    const FB_MISSIONS = [
      { logo: FACEBOOK_ICON_URL, url: 'https://facebook.com/pagina1' },
      { logo: FACEBOOK_ICON_URL, url: 'https://facebook.com/pagina2' },
      { logo: FACEBOOK_ICON_URL, url: 'https://facebook.com/pagina3' }
    ];

    /* ======================= Cargar PayPal SDK ==================== */
    (function loadPayPal(){
      const s = document.getElementById('paypal-sdk-loader');
      s.src = `https://www.paypal.com/sdk/js?client-id=${encodeURIComponent(PAYPAL_CLIENT_ID)}&currency=USD`;
    })();

    /* ======================= BANNER ============================ */
    document.getElementById('bannerLink').href = BANNER_LINK;
    document.getElementById('bannerVideoSrc').src = BANNER_VIDEO;

    /* ======================= FUNCIONES MODALES ============================ */
    function openModal(id){ 
      document.getElementById(id).classList.add('show'); 
      document.body.style.overflow = 'hidden'; 
    }

    function closeModal(id){ 
      document.getElementById(id).classList.remove('show'); 
      document.body.style.overflow = ''; 
    }

    /* ======================== PAYPAL RECARGA / VIP ===================== */
    const rechargeModal = document.getElementById('rechargeModal');
    document.getElementById('btnCloseModal').onclick = () => closeModal('rechargeModal');
    const storeModal = document.getElementById('storeModal');
    document.getElementById('btnStore').onclick = () => openModal('storeModal');
    document.getElementById('btnCloseStore').onclick = () => closeModal('storeModal');
    
    // Función para mostrar los botones de PayPal para la recarga de monedas
    function showPaypalForCoins(wrapId, capId, btnId, amount) {
      const wrap = document.getElementById(wrapId);
      const cap = document.getElementById(capId);
      const btn = document.getElementById(btnId);
      cap.textContent = `Comprar ${amount} monedas (USD ${(amount / 10).toFixed(2)})`; // Ajusta la tarifa por monedas
      wrap.style.display = 'block';
      btn.innerHTML = '';
      renderPayPal(btn, (amount / 10).toFixed(2), () => {
        updateCoins(amount);
        toast(`+${amount} moneditas`, 'Pago aprobado.','ok');
      });
    }

    // Función para mostrar los botones de PayPal para la suscripción VIP
    function showPaypalForVIP(wrapId, capId, btnId, plan, price) {
      const wrap = document.getElementById(wrapId);
      const cap = document.getElementById(capId);
      const btn = document.getElementById(btnId);
      const label = plan === '24h' ? '24 horas' : plan === '7d' ? '1 semana' : '1 mes';
      cap.textContent = `Activar VIP ${label} — USD ${price.toFixed(2)}`;
      wrap.style.display = 'block';
      btn.innerHTML = '';
      renderPayPal(btn, price.toFixed(2), () => {
        setVIP(plan);
      });
    }

    // Función para renderizar los botones de PayPal
    function renderPayPal(containerEl, price, onApproveCb) {
      const wait = () => new Promise(res => {
        const i = setInterval(() => { 
          if (window.paypal) { clearInterval(i); res(); }
        }, 100);
      });
      wait().then(() => {
        window.paypal.Buttons({
          style: { layout: 'horizontal', color: 'gold', shape: 'pill', label: 'pay' },
          createOrder: (data, actions) => actions.order.create({
            purchase_units: [{ amount: { value: String(price) } }]
          }),
          onApprove: async (data, actions) => {
            try {
              await actions.order.capture();
              onApproveCb && onApproveCb();
            } catch {
              toast('Pago aprobado, pero hubo un detalle al capturar.', 'Revisa tu cuenta.', 'warn');
            }
          },
          onError: (err) => toast('Error de pago', 'Intenta nuevamente.', 'warn')
        }).render(containerEl);
      });
    }

    /* ========================== COINS & VIP ========================== */
    const coinsLabel = document.getElementById('coinsLabel');
    const coinsLabel2 = document.getElementById('coinsLabel2');
    const coinsIcon = document.getElementById('coinsIcon');
    const coinsIcon2 = document.getElementById('coinsIcon2');
    const vipEmojis = document.getElementById('vipEmojis');

    let session = JSON.parse(localStorage.getItem('session') || '{}');
    if (!session.alias) { session = { alias: 'Usuario', coins: 50 }; saveSession(); }
    let membership = JSON.parse(localStorage.getItem('membership') || 'null');

    function saveSession() {
      localStorage.setItem('session', JSON.stringify(session));
    }

    function updateCoins(delta) {
      session.coins = Math.max(0, (session.coins || 0) + delta);
      saveSession();
      coinsLabel.textContent = session.coins;
      coinsLabel2.textContent = session.coins;
    }

    function isVIP() {
      return membership && Date.now() < membership.until;
    }

    function setVIP(duration) {
      const now = Date.now();
      const add = duration === '24h' ? 24 * 3600e3 : duration === '7d' ? 7 * 24 * 3600e3 : 30 * 24 * 3600e3;
      membership = { until: now + add };
      localStorage.setItem('membership', JSON.stringify(membership));
      paintVIP();
      toast('VIP ACTIVADO ✨', 'Disfruta de chat ilimitado y fotos privadas.', 'ok');
    }

    function paintVIP() {
      const active = isVIP();
      vipEmojis.style.display = active ? 'flex' : 'none';
      const icon = active ? VIP_ICON_URL : COIN_ICON_URL;
      coinsIcon.src = icon;
      coinsIcon2.src = icon;
    }

    paintVIP();
    updateCoins(0); // Inicializa la cantidad de monedas

    /* ================== BOT DE RESPUESTAS =================== */
    function autoReply(userText) {
      const t = userText.toLowerCase();
      let reply;
      if (/hola|holi|buenas|hey|ola|holaaa/i.test(t)) {
        reply = `¡Holi amor 😘! Soy ${currentModel.name}, cuéntame algo bonito ❤️`;
      } else if (/edad|años/i.test(t)) {
        reply = `Tengo ${currentModel.age || '22'} añitos 😜 mi rey`;
      } else if (/foto|privada/i.test(t)) {
        reply = isVIP() ? `Tengo unas fotos 🔥 solo para ti bebé 😏` : `Activa VIP y te enseño cositas ricas 👑`;
      } else if (/donde|pais|país/i.test(t)) {
        reply = `Soy de ${currentModel.country || 'un lugar calientito'} ☀️ ¿y tú, mi príncipe?`;
      } else if (/novia|relación|salir/i.test(t)) {
        reply = `Uff papasito 😈 dime… ¿buscas amor o travesuras?`;
      } else if (/mi amor|bebé|principe|papasito|bebe/i.test(t)) {
        reply = `Ayyy 😍 me derrites con esas palabras ❤️`;
      } else {
        reply = `Mmm me gusta cuando hablas así cariño 😍 sigue…`;
      }
      messages.innerHTML += `<div class="msg them">${sanitize(reply)}<div class="meta">${new Date().toLocaleTimeString()}</div></div>`;
    }
    /* ===================== RENDER MODELS ===================== */
    async function renderModels() {
      const chatList = document.getElementById('chatList');
      chatList.innerHTML = '';
      const snap = await getDocs(collection(db, "models"));
      snap.forEach(docSnap => {
        const m = { id: docSnap.id, ...docSnap.data() };
        const card = document.createElement('div');
        card.className = 'model-card';
        const pub = (m.photos || []).slice(0, 3);
        const priv = (m.photos || []).slice(3, 5);
        card.innerHTML = `
          <div class="model-slideshow">
            ${pub.map((src, i) => `<img src="${src}" class="${i === 0 ? 'active' : ''}">`).join('')}
          </div>
          <div class="info">
            <div class="name">${m.name} <span class="online">● Online</span></div>
            <div class="extra">${m.age || '—'} años · ${m.country || '—'}</div>
            <div class="desc">${m.desc || ''}</div>
          </div>
          <div class="actions">
            <button class="action-btn btn-like">
              <img src="https://qu.ax/hlsxX.png"><span>Me gusta</span>
              <span class="like-badge">${m.likes || 0}</span>
            </button>
            <a class="action-btn btn-fb" ${m.facebookUrl ? `href="${m.facebookUrl}" target="_blank"` : 'style="pointer-events:none;opacity:.5"'}><img src="${FACEBOOK_ICON_URL}"><span>Facebook</span></a>
            <button class="action-btn btn-priv"><img src="${PRIV_ICON_URL}"><span>Privadas</span></button>
            <button class="action-btn btn-msg"><img src="https://qu.ax/jGSiu.png"><span>Mensaje</span></button>
          </div>
        `;
        card.querySelector('.btn-msg').onclick = () => openChatWith(m);
        card.querySelector('.btn-priv').onclick = (e) => {
          if (!isVIP()) { toast('Activa VIP', 'Para ver las privadas 😏', 'warn'); return; }
          const w = window.open('', '_blank', 'width=800,height=600');
          (priv.length ? priv : pub).forEach(src => w.document.write(`<img src="${src}" style="width:100%;margin-bottom:8px">`));
        };
        chatList.appendChild(card);
      });
    }

    renderModels();
  </script>

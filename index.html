<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Donaciones | PayPal ‚Ä¢ USDT TRC20</title>

  <style>
    :root{
      --bg1:#90EE90;
      --bg2:#FFFFFF;

      --text:#0b1220;
      --muted: rgba(11,18,32,.68);
      --border: rgba(11,18,32,.10);
      --shadow: 0 18px 60px rgba(0,0,0,.18);
      --radius: 18px;

      --accent:#1677ff;
      --accent2:#22c55e;
      --warn:#b45309;

      --glass: rgba(255,255,255,.55);
    }

    *{ box-sizing:border-box; }

    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial;
      color: var(--text);
      background: linear-gradient(135deg, var(--bg1), var(--bg2));
      min-height:100vh;
      overflow-x:hidden;
    }

    .container{ width:min(1120px, 92vw); margin:0 auto; }

    /* NAVBAR */
    header{
      position: sticky; top: 0; z-index: 50;
      background: rgba(255,255,255,.55);
      backdrop-filter: blur(12px);
      border-bottom: 1px solid rgba(11,18,32,.10);
    }
    .nav{
      display:flex; align-items:center; justify-content:space-between;
      padding: 12px 0;
      gap: 12px;
    }

    .brand{
      display:flex; align-items:center; gap:12px;
      font-weight: 950;
      letter-spacing:.2px;
    }

    /* Logo redondo que sobresale + zoom zoom */
    .brand-logo-wrap{
      width: 48px;
      height: 48px;
      border-radius: 999px;
      background: rgba(255,255,255,.72);
      border: 1px solid rgba(11,18,32,.10);
      box-shadow: 0 16px 40px rgba(0,0,0,.16);
      display:grid;
      place-items:center;
      overflow:hidden;

      /* sobresale un poco */
      transform: translateY(10px);
      position: relative;
    }
    .brand-logo{
      width: 100%;
      height: 100%;
      object-fit: cover;
      border-radius: 999px;
      animation: zoomZoom 2.6s ease-in-out infinite;
      transform-origin: center;
    }
    @keyframes zoomZoom{
      0%{ transform: scale(1); }
      50%{ transform: scale(1.10); }
      100%{ transform: scale(1); }
    }

    .brand-title{
      display:flex;
      flex-direction:column;
      gap: 2px;
      line-height: 1.05;
    }
    .brand-title .t{
      font-size: 16px;
      font-weight: 1000;
      letter-spacing: .2px;
    }
    .brand-title .s{
      font-size: 12px;
      font-weight: 850;
      color: rgba(11,18,32,.60);
    }

    main{ padding: 22px 0 44px; position:relative; z-index: 1; }

    /* HERO */
    .hero{
      display:grid;
      grid-template-columns: 1fr;
      gap: 14px;
      margin-bottom: 14px;
    }

    .card{
      background: var(--glass);
      border: 1px solid rgba(11,18,32,.10);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding: 18px;
    }

    .hero-top{
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap: 14px;
      flex-wrap: wrap;
    }

    .hero h1{
      margin: 6px 0 6px;
      font-size: clamp(26px, 3.2vw, 40px);
      line-height: 1.05;
      letter-spacing: -.7px;
    }
    .hero p{
      margin: 0 0 0;
      color: var(--muted);
      line-height: 1.6;
      max-width: 70ch;
      font-size: 15px;
    }

    /* Cantidad donada (overlay brillante) */
    .total-box{
      position: relative;
      border-radius: 18px;
      border: 1px solid rgba(11,18,32,.10);
      background: rgba(255,255,255,.68);
      box-shadow: 0 16px 40px rgba(0,0,0,.12);
      padding: 12px 14px;
      min-width: 240px;
      overflow: hidden;
      isolation: isolate;
      animation: floaty 2.8s ease-in-out infinite;
    }
    @keyframes floaty{
      0%{ transform: translateY(0); }
      50%{ transform: translateY(-4px); }
      100%{ transform: translateY(0); }
    }

    .total-box::before{
      content:"";
      position:absolute;
      inset:-40%;
      background: linear-gradient(120deg,
        rgba(22,119,255,0) 0%,
        rgba(22,119,255,.18) 25%,
        rgba(255,255,255,.65) 50%,
        rgba(34,197,94,.18) 75%,
        rgba(22,119,255,0) 100%
      );
      transform: rotate(10deg) translateX(-35%);
      animation: shine 2.4s ease-in-out infinite;
      z-index: 0;
    }
    @keyframes shine{
      0%{ transform: rotate(10deg) translateX(-45%); opacity: .55; }
      50%{ transform: rotate(10deg) translateX(20%); opacity: .95; }
      100%{ transform: rotate(10deg) translateX(55%); opacity: .55; }
    }

    .total-box .k{
      position: relative;
      z-index: 1;
      font-weight: 950;
      font-size: 12px;
      color: rgba(11,18,32,.70);
      letter-spacing: .2px;
    }
    .total-box .v{
      position: relative;
      z-index: 1;
      margin-top: 6px;
      font-weight: 1100;
      font-size: 26px;
      letter-spacing: -.4px;
    }
    .total-box .mini{
      position: relative;
      z-index: 1;
      margin-top: 4px;
      font-size: 12px;
      font-weight: 850;
      color: rgba(11,18,32,.62);
    }

    /* CONTENT GRID */
    .grid{
      display:grid;
      grid-template-columns: repeat(12, 1fr);
      gap: 14px;
      margin-top: 14px;
    }
    .panel{ grid-column: span 8; }
    .methods{ grid-column: span 4; display:grid; gap: 14px; }

    @media (max-width: 980px){
      .panel{ grid-column: span 12; }
      .methods{ grid-column: span 12; }
      .total-box{ min-width: 100%; }
    }

    /* Section titles */
    .section-title{
      display:flex; align-items:flex-end; justify-content:space-between;
      gap: 12px; flex-wrap:wrap;
      margin-bottom: 12px;
    }
    .section-title h2{
      margin:0;
      font-size: 18px;
      letter-spacing:-.2px;
      font-weight: 1000;
    }
    .section-title p{
      margin:0;
      color: var(--muted);
      font-size: 13px;
      font-weight: 750;
    }

    /* FORM - modern floating */
    .form{
      display:grid;
      grid-template-columns: repeat(12, 1fr);
      gap: 12px;
      margin-top: 10px;
    }
    .field{ grid-column: span 6; display:flex; flex-direction:column; gap: 8px; }
    .field.full{ grid-column: span 12; }

    label{
      font-weight: 950;
      font-size: 13px;
      color: rgba(11,18,32,.88);
    }

    input, select, textarea{
      width:100%;
      border-radius: 16px;
      border: 1px solid rgba(11,18,32,.10);
      background: rgba(255,255,255,.72);
      color: rgba(11,18,32,.92);
      padding: 12px 13px;
      outline:none;
      font-size: 14px;
      transition: transform .18s ease, box-shadow .18s ease, border-color .18s ease;
      box-shadow: 0 10px 30px rgba(0,0,0,.06);
    }

    input:hover, select:hover, textarea:hover{
      transform: translateY(-1px);
      box-shadow: 0 16px 40px rgba(0,0,0,.10);
    }
    input:focus, select:focus, textarea:focus{
      border-color: rgba(22,119,255,.40);
      box-shadow: 0 0 0 5px rgba(22,119,255,.12), 0 16px 40px rgba(0,0,0,.10);
      transform: translateY(-1px);
    }
    textarea{ min-height: 92px; resize: vertical; }

    .divider{
      height:1px;
      background: rgba(11,18,32,.10);
      margin: 12px 0;
    }

    /* Quick amount chips */
    .badge{
      display:inline-flex;
      padding: 6px 10px;
      border-radius: 999px;
      border: 1px solid rgba(11,18,32,.10);
      background: rgba(255,255,255,.60);
      font-size: 12px;
      font-weight: 1000;
      color: rgba(11,18,32,.82);
      gap: 8px;
      align-items:center;
      width: fit-content;
      box-shadow: 0 10px 25px rgba(0,0,0,.08);
      user-select:none;
    }
    .badge:hover{ transform: translateY(-1px); }
    .badge{ cursor:pointer; }

    /* Tabs */
    .tabs{
      display:flex;
      gap: 10px;
      flex-wrap: wrap;
      margin-top: 10px;
    }
    .tab{
      cursor:pointer;
      border-radius: 999px;
      padding: 10px 12px;
      border: 1px solid rgba(11,18,32,.10);
      background: rgba(255,255,255,.60);
      font-weight: 1000;
      font-size: 13px;
      transition:.18s ease;
      user-select:none;
      box-shadow: 0 10px 25px rgba(0,0,0,.08);
      display:inline-flex; align-items:center; gap:10px;
    }
    .tab img{
      width: 18px; height: 18px; object-fit: contain;
      filter: saturate(1.05);
    }
    .tab[aria-selected="true"]{
      border-color: rgba(22,119,255,.35);
      background: rgba(22,119,255,.10);
      transform: translateY(-1px);
    }

    .method-box{
      display:none;
      margin-top: 12px;
      border: 1px solid rgba(11,18,32,.10);
      border-radius: 18px;
      padding: 14px;
      background: rgba(255,255,255,.60);
      box-shadow: 0 14px 40px rgba(0,0,0,.10);
      animation: fadeUp .22s ease;
    }
    .method-box.active{ display:block; }
    @keyframes fadeUp{
      from{ transform: translateY(8px); opacity: .0; }
      to{ transform: translateY(0); opacity: 1; }
    }

    .pay-row{
      display:flex; align-items:center; justify-content:space-between;
      gap: 12px; flex-wrap:wrap;
      margin-bottom: 10px;
    }
    .method-title{
      display:flex; align-items:center; gap: 10px;
      font-weight: 1000;
    }
    .method-title img{
      width: 34px; height: 34px; object-fit: contain;
      border-radius: 12px;
      padding: 6px;
      background: rgba(255,255,255,.75);
      border: 1px solid rgba(11,18,32,.10);
      box-shadow: 0 10px 25px rgba(0,0,0,.08);
    }

    .btnrow{
      display:flex; gap: 10px; flex-wrap:wrap;
      align-items:center;
      margin-top: 12px;
    }
    .btn{
      cursor:pointer;
      border:none;
      border-radius: 16px;
      padding: 12px 14px;
      font-weight: 1000;
      font-size: 14px;
      display:inline-flex; align-items:center; gap: 9px;
      transition: transform .18s ease, box-shadow .18s ease, filter .18s ease;
      user-select:none;
      letter-spacing:.2px;
      box-shadow: 0 16px 40px rgba(0,0,0,.12);
    }
    .btn:active{ transform: translateY(1px); }

    .btn-primary{
      background: linear-gradient(135deg, rgba(22,119,255,1), rgba(22,119,255,.72));
      color: #ffffff;
    }
    .btn-primary:hover{ filter: brightness(1.03); transform: translateY(-1px); }

    .btn-ghost{
      border: 1px solid rgba(11,18,32,.10);
      background: rgba(255,255,255,.70);
      color: rgba(11,18,32,.90);
    }
    .btn-ghost:hover{ transform: translateY(-1px); }

    .hint{
      color: rgba(11,18,32,.72);
      font-size: 13px;
      line-height: 1.45;
      margin-top: 10px;
      font-weight: 750;
    }

    /* Pay details block */
    .pay-details{
      border: 1px dashed rgba(11,18,32,.18);
      border-radius: 16px;
      padding: 12px;
      background: rgba(255,255,255,.65);
    }
    .pay-email{
      font-weight: 1000;
      font-size: 15px;
      letter-spacing:.2px;
      color: rgba(11,18,32,.92);
      margin: 0;
    }
    .pay-note{
      margin: 8px 0 0;
      font-size: 12.5px;
      color: rgba(180,83,9,.95);
      font-weight: 950;
    }

    /* USDT */
    .qr{
      display:grid;
      grid-template-columns: 128px 1fr;
      gap: 12px;
      align-items:center;
      margin-top: 10px;
    }
    canvas{
      width: 128px; height: 128px;
      border-radius: 16px;
      border: 1px solid rgba(11,18,32,.10);
      background: rgba(255,255,255,.70);
      box-shadow: 0 12px 35px rgba(0,0,0,.10);
    }
    .addr{
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace;
      font-size: 12px;
      line-height: 1.4;
      color: rgba(11,18,32,.90);
      word-break: break-all;
      padding: 10px;
      border: 1px dashed rgba(11,18,32,.18);
      border-radius: 16px;
      background: rgba(255,255,255,.65);
    }

    /* Right column */
    .small{
      font-size: 12.5px;
      color: rgba(11,18,32,.74);
      line-height: 1.5;
      white-space: pre-wrap;
    }

    /* Top donors list */
    .donor-list{
      display:grid;
      gap: 10px;
      margin-top: 10px;
    }
    .donor{
      display:flex;
      align-items:center;
      gap: 10px;
      padding: 10px 10px;
      border-radius: 16px;
      background: rgba(255,255,255,.62);
      border: 1px solid rgba(11,18,32,.10);
      box-shadow: 0 12px 32px rgba(0,0,0,.08);
      transition: transform .18s ease, box-shadow .18s ease;
    }
    .donor:hover{
      transform: translateY(-1px);
      box-shadow: 0 16px 40px rgba(0,0,0,.12);
    }
    .avatar{
      width: 40px;
      height: 40px;
      border-radius: 999px;
      object-fit: cover;
      border: 2px solid rgba(255,255,255,.75);
      box-shadow: 0 10px 25px rgba(0,0,0,.12);
      flex: 0 0 auto;
    }
    .donor .meta{
      min-width: 0;
      display:flex;
      flex-direction:column;
      gap: 2px;
    }
    .donor .name{
      font-weight: 1000;
      font-size: 13.5px;
      color: rgba(11,18,32,.92);
      white-space: nowrap;
      overflow:hidden;
      text-overflow: ellipsis;
      max-width: 210px;
    }
    .donor .amt{
      font-weight: 1000;
      font-size: 12.5px;
      color: rgba(11,18,32,.70);
    }
    .donor .rank{
      margin-left:auto;
      font-weight: 1100;
      font-size: 12px;
      padding: 6px 10px;
      border-radius: 999px;
      border: 1px solid rgba(11,18,32,.10);
      background: rgba(255,255,255,.65);
      color: rgba(11,18,32,.78);
      flex: 0 0 auto;
    }

    /* Receipt */
    .receipt{
      margin-top: 12px;
      border: 1px solid rgba(11,18,32,.10);
      border-radius: 18px;
      padding: 14px;
      background: rgba(255,255,255,.65);
      box-shadow: 0 16px 40px rgba(0,0,0,.10);
    }
    .receipt h3{
      margin: 0 0 8px;
      font-size: 14px;
      letter-spacing: -.2px;
      font-weight: 1000;
    }
    .receipt pre{
      margin:0;
      white-space: pre-wrap;
      word-break: break-word;
      font-size: 12.5px;
      color: rgba(11,18,32,.86);
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace;
      line-height: 1.45;
    }

    /* Toast */
    .toast{
      position: fixed;
      right: 16px;
      bottom: 16px;
      width: min(380px, 92vw);
      background: rgba(255,255,255,.82);
      border: 1px solid rgba(11,18,32,.10);
      border-radius: 16px;
      padding: 12px;
      box-shadow: var(--shadow);
      display:none;
      z-index: 100;
      backdrop-filter: blur(10px);
    }
    .toast.show{ display:block; animation: pop .18s ease; }
    @keyframes pop{ from{ transform:translateY(8px); opacity:0; } to{ transform:translateY(0); opacity:1; } }

    .trow{ display:flex; align-items:flex-start; gap:10px; }
    .ticon{
      width:32px; height:32px; border-radius: 12px;
      display:grid; place-items:center;
      font-weight: 1000;
      border: 1px solid rgba(11,18,32,.10);
      background: rgba(255,255,255,.75);
      flex: 0 0 auto;
    }
    .ttitle{ font-weight: 1000; margin:0; font-size: 14px; }
    .tmsg{ margin:2px 0 0; color: rgba(11,18,32,.70); font-size: 13px; line-height: 1.4; }
    .tclose{
      margin-left:auto;
      background:transparent;
      border:none;
      color: rgba(11,18,32,.65);
      font-size: 16px;
      cursor:pointer;
      padding: 2px 6px;
    }

    @media (max-width: 620px){
      .field{ grid-column: span 12; }
      .qr{ grid-template-columns: 1fr; }
      canvas{ width: 160px; height: 160px; }
      .donor .name{ max-width: 170px; }
    }
  </style>
</head>

<body>

  <!-- NAVBAR -->
  <header>
    <div class="container nav">
      <div class="brand">
        <div class="brand-logo-wrap" title="Logo">
          <img class="brand-logo" id="brandLogo" alt="Logo Donaciones" />
        </div>

        <div class="brand-title">
          <div class="t">Donaciones</div>
          <div class="s">PayPal ‚Ä¢ USDT TRC20</div>
        </div>
      </div>
    </div>
  </header>

  <main class="container">
    <section class="hero">
      <div class="card">
        <div class="hero-top">
          <div>
            <h1>Haz tu donaci√≥n en 1 minuto</h1>
            <p>
              Completa el formulario y elige PayPal o USDT TRC20. Esta plantilla no procesa pagos reales;
              muestra datos para pagar y luego enviar el comprobante.
            </p>
          </div>

          <div class="total-box" aria-label="Cantidad donada">
            <div class="k">Cantidad donada</div>
            <div class="v" id="totalDonated">$0</div>
            <div class="mini" id="totalDonatedMini">Total local (seg√∫n moneda seleccionada)</div>
          </div>
        </div>
      </div>
    </section>

    <section class="grid">
      <!-- Panel principal -->
      <div class="card panel">
        <div class="section-title">
          <div>
            <h2>Tu donaci√≥n</h2>
            <p>Completa los datos y selecciona el m√©todo.</p>
          </div>
        </div>

        <form id="donForm">
          <div class="form">
            <div class="field">
              <label for="name">Nombre</label>
              <input id="name" autocomplete="name" placeholder="Ej: Santiago Grauss" required />
            </div>
            <div class="field">
              <label for="email">Correo (opcional)</label>
              <input id="email" type="email" autocomplete="email" placeholder="Ej: correo@dominio.com" />
            </div>

            <div class="field">
              <label for="currency">Moneda</label>
              <select id="currency" required>
                <option value="USD" selected>USD ($)</option>
                <option value="EUR">EUR (‚Ç¨)</option>
              </select>
            </div>

            <div class="field">
              <label for="amount">Monto</label>
              <input id="amount" type="number" min="1" step="1" placeholder="Ej: 25" required />
              <div class="hint" style="margin-top:6px;">Atajos:
                <span class="badge" data-quick="10">10</span>
                <span class="badge" data-quick="25">25</span>
                <span class="badge" data-quick="50">50</span>
                <span class="badge" data-quick="100">100</span>
              </div>
            </div>

            <div class="field full">
              <label for="note">Mensaje (opcional)</label>
              <textarea id="note" placeholder="Ej: Donaci√≥n para alimentos / salud / educaci√≥n..."></textarea>
            </div>
          </div>

          <div class="divider"></div>

          <div>
            <div class="section-title">
              <div>
                <h2>M√©todo de pago</h2>
                <p>Selecciona uno para ver instrucciones.</p>
              </div>
            </div>

            <div class="tabs" role="tablist" aria-label="M√©todos de pago">
              <button class="tab" type="button" role="tab" aria-selected="true" data-method="paypal">
                <img id="paypalTabLogo" alt="PayPal" />
                PayPal
              </button>

              <button class="tab" type="button" role="tab" aria-selected="false" data-method="usdt">
                <img id="usdtTabLogo" alt="USDT" />
                USDT TRC20
              </button>
            </div>

            <!-- PAYPAL -->
            <div class="method-box active" id="box-paypal">
              <div class="pay-row">
                <div class="method-title">
                  <img id="paypalLogo" alt="PayPal logo" />
                  <div>PayPal</div>
                </div>
              </div>

              <div class="pay-details">
                <p class="pay-email" id="paypalEmailText">correo@paypal.com</p>
                <p class="pay-note" id="paypalWarnText">NOTA: enviar comprobante al @usuario de telegram</p>
              </div>

              <div class="btnrow">
                <button class="btn btn-ghost" type="button" id="btnCopyPayPal">üìã Copiar correo</button>
              </div>

              <p class="hint">
                Paga con PayPal usando el correo mostrado arriba y luego env√≠a el comprobante al Telegram indicado.
              </p>
            </div>

            <!-- USDT -->
            <div class="method-box" id="box-usdt">
              <div class="pay-row">
                <div class="method-title">
                  <img id="usdtLogo" alt="USDT logo" />
                  <div>USDT (TRC20)</div>
                </div>
              </div>

              <div class="qr">
                <canvas id="qrCanvas" width="128" height="128" aria-label="QR de pago USDT"></canvas>
                <div>
                  <div class="small" style="margin-bottom:8px; font-weight:900; color: rgba(11,18,32,.80);">
                    Direcci√≥n TRC20:
                  </div>
                  <div class="addr" id="usdtAddressText">TU_DIRECCION_TRC20_AQUI</div>

                  <div class="btnrow" style="margin-top:10px;">
                    <button class="btn btn-ghost" type="button" id="btnCopyAddr">üìã Copiar direcci√≥n</button>
                    <button class="btn btn-primary" type="button" id="btnShowUSDT">ü™ô Generar recibo</button>
                  </div>

                  <p class="pay-note" id="usdtWarnText" style="margin-top:10px;">
                    NOTA: enviar comprobante al @usuario de telegram
                  </p>
                </div>
              </div>

              <p class="hint">
                Env√≠a USDT por la red TRON (TRC20) a la direcci√≥n mostrada. Luego env√≠a el comprobante al Telegram indicado.
              </p>
            </div>
          </div>

          <div class="receipt" id="receipt" style="display:none;">
            <h3>üßæ Recibo (demo)</h3>
            <pre id="receiptText"></pre>
            <div class="btnrow" style="margin-top:10px;">
              <button class="btn btn-ghost" type="button" id="btnCopyReceipt">üìã Copiar recibo</button>
              <button class="btn btn-ghost" type="button" id="btnDownloadReceipt">‚¨áÔ∏è Descargar .txt</button>
            </div>
          </div>
        </form>
      </div>

      <!-- Columna derecha -->
      <div class="methods">
        <div class="card">
          <div class="section-title">
            <div>
              <h2>Historial local</h2>
              <p>Se guarda en tu navegador.</p>
            </div>
          </div>
          <div class="divider"></div>
          <div class="small" id="historyPreview">Sin donaciones a√∫n.</div>
          <div class="divider"></div>
          <div class="btnrow">
            <button class="btn btn-ghost" type="button" id="btnExport">üìÑ Exportar JSON</button>
            <button class="btn btn-ghost" type="button" id="btnClear">üóëÔ∏è Borrar</button>
          </div>
        </div>

        <div class="card">
          <div class="section-title">
            <div>
              <h2>Top donadores</h2>
              <p>Lista fija (ed√≠tala en el c√≥digo).</p>
            </div>
          </div>
          <div class="divider"></div>
          <div class="donor-list" id="topDonorsList"></div>
        </div>
      </div>
    </section>
  </main>

  <div class="toast" id="toast" role="status" aria-live="polite">
    <div class="trow">
      <div class="ticon" id="ticon">‚úÖ</div>
      <div style="min-width:0;">
        <p class="ttitle" id="ttitle">Listo</p>
        <p class="tmsg" id="tmsg">Acci√≥n completada.</p>
      </div>
      <button class="tclose" id="tclose" aria-label="Cerrar">‚úï</button>
    </div>
  </div>

  <script>
    // ==========================
    // CONFIG (edita aqu√≠)
    // ==========================
    const CONFIG = {
      // Logo redondo del t√≠tulo "Donaciones"
      brandLogoUrl: "https://img.freepik.com/vector-premium/logo-donacion_23-2147503731.jpg",

      // PayPal
      paypalEmail: "donate37@gmail.com",
      telegramUser: "@usuario",
      paypalLogoUrl: "https://cdn.pixabay.com/photo/2018/05/08/21/29/paypal-3384015_640.png",

      // USDT TRC20
      usdtAddress: "TU_DIRECCION_TRC20_AQUI",
      usdtLogoUrl: "https://cryptologos.cc/logos/tether-usdt-logo.png?v=032",

      // TOP DONORS (nombre, avatar URL, monto)
      // Nota: esto es independiente del historial autom√°tico (es una lista "manual").
      topDonors: [
        { name: "Mar√≠a P.", avatar: "https://i.pravatar.cc/80?img=47", amount: 250 },
        { name: "Carlos R.", avatar: "https://i.pravatar.cc/80?img=12", amount: 180 },
        { name: "Ana G.", avatar: "https://i.pravatar.cc/80?img=5",  amount: 120 },
        { name: "Jos√© L.", avatar: "https://i.pravatar.cc/80?img=33", amount: 90 },
      ]
    };

    const LS_KEYS = { list: "don_demo_list" };

    // ==========================
    // Helpers
    // ==========================
    const $ = (sel, root=document) => root.querySelector(sel);
    const $$ = (sel, root=document) => Array.from(root.querySelectorAll(sel));

    function safeJSONParse(v, fallback){ try { return JSON.parse(v); } catch { return fallback; } }
    function nowISO(){ return new Date().toISOString(); }

    function money(amount, currency){
      const n = Number(amount);
      const symbol = currency === "EUR" ? "‚Ç¨" : "$";
      return `${symbol}${isFinite(n) ? n.toFixed(0) : "0"}`;
    }

    function showToast({title, msg, icon="‚úÖ"}){
      $("#ttitle").textContent = title;
      $("#tmsg").textContent = msg;
      $("#ticon").textContent = icon;
      const t = $("#toast");
      t.classList.add("show");
      clearTimeout(showToast._t);
      showToast._t = setTimeout(()=> t.classList.remove("show"), 4200);
    }
    $("#tclose").addEventListener("click", () => $("#toast").classList.remove("show"));

    function getHistory(){ return safeJSONParse(localStorage.getItem(LS_KEYS.list), []); }
    function setHistory(list){
      localStorage.setItem(LS_KEYS.list, JSON.stringify(list));
      renderHistoryPreview();
      renderTotal();
    }

    function renderTotal(){
      const list = getHistory();
      const cur = $("#currency")?.value || "USD";
      const total = list
        .filter(x => x.currency === cur)
        .reduce((acc, x) => acc + Number(x.amount || 0), 0);

      $("#totalDonated").textContent = money(total, cur);
      $("#totalDonatedMini").textContent = `Total local (moneda: ${cur})`;
    }

    function validateCommon(){
      const name = $("#name").value.trim();
      const email = $("#email").value.trim();
      const currency = $("#currency").value;
      const amount = Number($("#amount").value);
      const note = $("#note").value.trim();

      if(!name || name.length < 2){
        showToast({ title:"Nombre inv√°lido", msg:"Escribe tu nombre (m√≠n. 2 caracteres).", icon:"‚ö†Ô∏è" });
        return null;
      }
      if($("#email").value && !$("#email").checkValidity()){
        showToast({ title:"Correo inv√°lido", msg:"Revisa el formato del correo.", icon:"‚ö†Ô∏è" });
        return null;
      }
      if(!Number.isFinite(amount) || amount < 1){
        showToast({ title:"Monto inv√°lido", msg:"Ingresa un monto mayor o igual a 1.", icon:"‚ö†Ô∏è" });
        return null;
      }
      return { name, email, currency, amount, note };
    }

    function makeReceipt({method, donor, currency, amount, note, extra}){
      return {
        id: Math.random().toString(16).slice(2, 10).toUpperCase(),
        created_at: nowISO(),
        method,
        currency,
        amount,
        donor,
        note: note || null,
        extra: extra || null
      };
    }

    function showReceipt(payload){
      const lines = [];
      lines.push(`RECIBO (DEMO)`);
      lines.push(`ID: ${payload.id}`);
      lines.push(`Fecha: ${payload.created_at}`);
      lines.push(`M√©todo: ${payload.method}`);
      lines.push(`Monto: ${money(payload.amount, payload.currency)} ${payload.currency}`);
      lines.push(`Donante: ${payload.donor.name}${payload.donor.email ? " <" + payload.donor.email + ">" : ""}`);
      if(payload.note) lines.push(`Mensaje: ${payload.note}`);
      if(payload.extra){
        lines.push(`---`);
        for(const [k,v] of Object.entries(payload.extra)) lines.push(`${k}: ${v}`);
      }
      lines.push(`---`);
      lines.push(`Nota: Este comprobante es local (no confirma pago real).`);

      $("#receiptText").textContent = lines.join("\n");
      $("#receipt").style.display = "block";
      $("#receipt").scrollIntoView({behavior:"smooth"});
    }

    function addToHistory(payload){
      const list = getHistory();
      list.push(payload);
      setHistory(list);
    }

    function renderHistoryPreview(){
      const list = getHistory().slice().reverse().slice(0, 6);
      if(list.length === 0){
        $("#historyPreview").textContent = "Sin donaciones a√∫n.";
        return;
      }
      const lines = list.map(x => {
        const date = new Date(x.created_at).toLocaleString("es-ES", { day:"2-digit", month:"short", hour:"2-digit", minute:"2-digit" });
        const amt = money(x.amount, x.currency) + " " + x.currency;
        return `‚Ä¢ ${date} ‚Äî ${x.method} ‚Äî ${amt} ‚Äî ${x.donor?.name || "An√≥nimo"} (ID ${x.id})`;
      });
      $("#historyPreview").textContent = lines.join("\n");
    }

    // ==========================
    // Top donors (manual list)
    // ==========================
    function renderTopDonors(){
      const list = (CONFIG.topDonors || []).slice()
        .sort((a,b) => Number(b.amount||0) - Number(a.amount||0))
        .slice(0, 8);

      const root = $("#topDonorsList");
      if(!root) return;

      if(list.length === 0){
        root.innerHTML = `<div class="small">No hay donadores configurados.</div>`;
        return;
      }

      root.innerHTML = list.map((d, idx) => {
        const safeName = escapeHTML(d.name || "Donador");
        const safeAvatar = escapeAttr(d.avatar || "");
        const amt = Number(d.amount || 0);

        return `
          <div class="donor">
            <img class="avatar" src="${safeAvatar}" alt="Perfil de ${safeName}" onerror="this.src='https://i.pravatar.cc/80?img=1'">
            <div class="meta">
              <div class="name">${safeName}</div>
              <div class="amt">Monto donado: ${money(amt, "USD")} USD</div>
            </div>
            <div class="rank">#${idx+1}</div>
          </div>
        `;
      }).join("");
    }

    function escapeHTML(str){
      return String(str)
        .replaceAll("&","&amp;")
        .replaceAll("<","&lt;")
        .replaceAll(">","&gt;")
        .replaceAll('"',"&quot;")
        .replaceAll("'","&#039;");
    }
    function escapeAttr(str){
      return String(str).replaceAll('"',"&quot;");
    }

    // ==========================
    // Tabs (PayPal / USDT)
    // ==========================
    function setMethod(method){
      $$(".tab").forEach(t => t.setAttribute("aria-selected", String(t.dataset.method === method)));
      $("#box-paypal").classList.toggle("active", method === "paypal");
      $("#box-usdt").classList.toggle("active", method === "usdt");
      if(method === "usdt") drawPseudoQR(makeUSDTURI());
    }
    $$(".tab").forEach(btn => btn.addEventListener("click", () => setMethod(btn.dataset.method)));

    // ==========================
    // Quick amount
    // ==========================
    $$("[data-quick]").forEach(b => {
      b.addEventListener("click", () => {
        $("#amount").value = b.dataset.quick;
        if($("#box-usdt").classList.contains("active")) drawPseudoQR(makeUSDTURI());
        showToast({ title:"Monto seleccionado", msg:`Monto: ${b.dataset.quick}`, icon:"üí∏" });
      });
    });

    // Recalcular total si cambia moneda
    $("#currency").addEventListener("change", renderTotal);

    // ==========================
    // PayPal actions (solo copiar)
    // ==========================
    $("#btnCopyPayPal").addEventListener("click", async () => {
      try{
        await navigator.clipboard.writeText(CONFIG.paypalEmail);
        showToast({ title:"Copiado", msg:"Correo PayPal copiado.", icon:"üìã" });
      }catch{
        showToast({ title:"No se pudo copiar", msg:"Tu navegador bloque√≥ el portapapeles.", icon:"‚ö†Ô∏è" });
      }
    });

    // ==========================
    // USDT actions (genera recibo)
    // ==========================
    function makeUSDTURI(){
      const amount = Number($("#amount").value || 0);
      const cur = $("#currency").value;
      const usdtAmount = Number.isFinite(amount) ? amount : 0;
      const addr = CONFIG.usdtAddress;
      const memo = encodeURIComponent("Donaci√≥n USDT TRC20");
      return `tron:${addr}?token=USDT&network=TRC20&amount=${usdtAmount}&memo=${memo}&displayCurrency=${cur}`;
    }

    $("#btnCopyAddr").addEventListener("click", async () => {
      try{
        await navigator.clipboard.writeText(CONFIG.usdtAddress);
        showToast({ title:"Copiado", msg:"Direcci√≥n TRC20 copiada.", icon:"üìã" });
      }catch{
        showToast({ title:"No se pudo copiar", msg:"Tu navegador bloque√≥ el portapapeles.", icon:"‚ö†Ô∏è" });
      }
    });

    $("#btnShowUSDT").addEventListener("click", () => {
      const data = validateCommon();
      if(!data) return;

      const payload = makeReceipt({
        method: "USDT TRC20 (manual)",
        donor: { name: data.name, email: data.email || null },
        currency: data.currency,
        amount: data.amount,
        note: data.note,
        extra: {
          "Red": "TRC20",
          "Direcci√≥n": CONFIG.usdtAddress,
          "Enviar comprobante a": CONFIG.telegramUser
        }
      });

      addToHistory(payload);
      showReceipt(payload);
      showToast({ title:"Recibo generado", msg:"Env√≠a el comprobante al Telegram indicado.", icon:"üßæ" });
    });

    // Redibuja QR si cambia el monto
    $("#amount").addEventListener("input", () => {
      if($("#box-usdt").classList.contains("active")){
        drawPseudoQR(makeUSDTURI());
      }
    });

    // ==========================
    // Pseudo-QR
    // ==========================
    function drawPseudoQR(text){
      const c = $("#qrCanvas");
      const ctx = c.getContext("2d");
      const size = c.width;

      ctx.clearRect(0,0,size,size);
      ctx.fillStyle = "rgba(255,255,255,0.85)";
      ctx.fillRect(0,0,size,size);

      const hash = fnv1a(text);
      const bits = prngBits(hash, 29*29);
      const n = 29;
      const pad = 6;
      const cell = Math.floor((size - pad*2)/n);

      drawFinder(ctx, pad, pad, cell);
      drawFinder(ctx, pad + (n-7)*cell, pad, cell);
      drawFinder(ctx, pad, pad + (n-7)*cell, cell);

      for(let y=0; y<n; y++){
        for(let x=0; x<n; x++){
          const inTL = x<7 && y<7;
          const inTR = x>=n-7 && y<7;
          const inBL = x<7 && y>=n-7;
          if(inTL || inTR || inBL) continue;

          const i = y*n + x;
          if(bits[i]){
            ctx.fillStyle = "rgba(11,18,32,0.92)";
            ctx.fillRect(pad + x*cell, pad + y*cell, cell, cell);
          }
        }
      }

      ctx.fillStyle = "rgba(11,18,32,0.55)";
      ctx.font = "10px ui-monospace, Menlo, Consolas, monospace";
      ctx.fillText("USDT TRC20", 10, size - 10);
    }

    function drawFinder(ctx, x, y, cell){
      ctx.fillStyle = "rgba(11,18,32,0.92)";
      ctx.fillRect(x, y, cell*7, cell*7);
      ctx.clearRect(x+cell, y+cell, cell*5, cell*5);
      ctx.fillRect(x+cell*2, y+cell*2, cell*3, cell*3);
    }

    function fnv1a(str){
      let h = 0x811c9dc5;
      for(let i=0;i<str.length;i++){
        h ^= str.charCodeAt(i);
        h = Math.imul(h, 0x01000193);
      }
      return h >>> 0;
    }

    function prngBits(seed, count){
      let x = seed >>> 0;
      const out = new Array(count);
      for(let i=0;i<count;i++){
        x ^= x << 13; x >>>= 0;
        x ^= x >> 17; x >>>= 0;
        x ^= x << 5;  x >>>= 0;
        out[i] = (x & 1) === 1;
      }
      return out;
    }

    // ==========================
    // Receipt actions
    // ==========================
    $("#btnCopyReceipt").addEventListener("click", async () => {
      try{
        await navigator.clipboard.writeText($("#receiptText").textContent);
        showToast({ title:"Recibo copiado", msg:"Listo para pegar.", icon:"üìã" });
      }catch{
        showToast({ title:"No se pudo copiar", msg:"Tu navegador bloque√≥ el portapapeles.", icon:"‚ö†Ô∏è" });
      }
    });

    $("#btnDownloadReceipt").addEventListener("click", () => {
      const txt = $("#receiptText").textContent || "";
      if(!txt.trim()){
        showToast({ title:"Sin recibo", msg:"Primero genera un recibo.", icon:"‚ö†Ô∏è" });
        return;
      }
      const blob = new Blob([txt], {type:"text/plain;charset=utf-8"});
      const url = URL.createObjectURL(blob);
      const a = document.createElement("a");
      a.href = url;
      a.download = `recibo-donacion-${Date.now()}.txt`;
      document.body.appendChild(a);
      a.click();
      a.remove();
      URL.revokeObjectURL(url);
      showToast({ title:"Descargado", msg:"Recibo .txt descargado.", icon:"‚¨áÔ∏è" });
    });

    // ==========================
    // History export / clear
    // ==========================
    $("#btnExport").addEventListener("click", () => {
      const data = { history: getHistory(), exported_at: nowISO() };
      const json = JSON.stringify(data, null, 2);
      const blob = new Blob([json], {type:"application/json"});
      const url = URL.createObjectURL(blob);
      const a = document.createElement("a");
      a.href = url;
      a.download = `donaciones-export-${Date.now()}.json`;
      document.body.appendChild(a);
      a.click();
      a.remove();
      URL.revokeObjectURL(url);
      showToast({ title:"Exportado", msg:"Se descarg√≥ el historial en JSON.", icon:"üìÑ" });
    });

    $("#btnClear").addEventListener("click", () => {
      localStorage.removeItem(LS_KEYS.list);
      $("#receipt").style.display = "none";
      renderHistoryPreview();
      renderTotal();
      showToast({ title:"Borrado", msg:"Historial local eliminado.", icon:"üóëÔ∏è" });
    });

    // ==========================
    // INIT
    // ==========================
    function init(){
      // brand logo
      $("#brandLogo").src = CONFIG.brandLogoUrl;

      // Logos
      $("#paypalLogo").src = CONFIG.paypalLogoUrl;
      $("#paypalTabLogo").src = CONFIG.paypalLogoUrl;

      $("#usdtLogo").src = CONFIG.usdtLogoUrl;
      $("#usdtTabLogo").src = CONFIG.usdtLogoUrl;

      // PayPal text + warning
      $("#paypalEmailText").textContent = CONFIG.paypalEmail;
      const note = `NOTA: enviar comprobante al ${CONFIG.telegramUser} de telegram`;
      $("#paypalWarnText").textContent = note;
      $("#usdtWarnText").textContent = note;

      // USDT address
      $("#usdtAddressText").textContent = CONFIG.usdtAddress;

      // Default
      renderTopDonors();
      renderHistoryPreview();
      renderTotal();
      drawPseudoQR(makeUSDTURI());
      setMethod("paypal");

      // prevent submit
      $("#donForm").addEventListener("submit", (e) => e.preventDefault());
    }

    init();
  </script>
</body>
</html>

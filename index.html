<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>ChispaLive ‚Äî Demo</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
    :root{
      --brand:#ff2e6a; --bg:#0b1220; --card:#0f1a2b; --line:#1b3150;
      --text:#e9f6ff; --sub:#9bc2df; --ok:#27ae60; --warn:#ffb020; --vip:#ffd54d;
    }
    *{box-sizing:border-box} html,body{height:100%}
    body{margin:0;font-family:Poppins,system-ui,sans-serif;background:var(--bg);color:var(--text)}
    .container{max-width:1100px;margin:0 auto;padding:16px}
    .header{position:sticky;top:0;z-index:100;background:rgba(10,18,32,.92);border-bottom:1px solid #132338}
    .header-inner{display:flex;justify-content:space-between;align-items:center;padding:12px 16px}
    .brand{display:flex;align-items:center;gap:10px;font-weight:700}
    .btn{border:0;padding:8px 12px;border-radius:10px;font-weight:600;cursor:pointer;transition:.15s;font-size:14px}
    .btn:active{transform:translateY(1px)}
    .btn-primary{background:var(--brand);color:#fff}
    .btn-ghost{background:transparent;color:#cfe7ff;border:1px solid #244362}
    .btn-warning{background:var(--warn);color:#1b1407}
    .input{width:100%;background:#0e192a;color:#d9eeff;border:1px solid #1f3550;border-radius:12px;padding:10px 12px}
    .card{background:var(--card);border:1px solid var(--line);border-radius:18px;padding:16px;box-shadow:0 10px 32px rgba(0,0,0,.35)}
    .small{color:var(--sub);font-size:12px}
    .view{display:none}.view.active{display:block}
    .coins-badge{display:inline-flex;align-items:center;gap:6px;background:#0e192a;border:1px solid #233f60;padding:6px 10px;border-radius:999px;font-weight:700}
    .coins-badge img{height:18px;width:18px;object-fit:contain;display:block}
    .title-hero{font-weight:800;font-size:22px;margin:10px 0;display:inline-flex;align-items:center;gap:8px;background:linear-gradient(90deg,#fff,#ffd1dc,#fff);
      -webkit-background-clip:text;background-clip:text;color:transparent;animation:shine 2.4s linear infinite,pulseZoom 3.8s ease-in-out infinite;text-shadow:0 0 18px rgba(255,255,255,.12)}
    @keyframes shine{0%{filter:brightness(1)}50%{filter:brightness(1.25)}100%{filter:brightness(1)}}
    @keyframes pulseZoom{0%,100%{transform:scale(1)}50%{transform:scale(1.04)}}
    .model-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:18px;margin-top:18px}
    .model-card{background:#fff;color:#000;border-radius:14px;overflow:hidden;box-shadow:0 4px 20px rgba(0,0,0,.12);display:flex;flex-direction:column;cursor:pointer;transition:transform .25s, box-shadow .25s;animation:softFloat 4s ease-in-out infinite}
    .model-card:hover{transform:translateY(-4px) scale(1.02);box-shadow:0 12px 30px rgba(0,0,0,.2)}
    @keyframes softFloat{0%,100%{transform:translateY(0)}50%{transform:translateY(-6px)}}
    .model-slideshow{position:relative;height:200px}
    .model-slideshow img{position:absolute;inset:0;width:100%;height:100%;object-fit:cover;opacity:0;transition:opacity .6s ease}
    .model-slideshow img.active{opacity:1}
    .model-card .info{padding:12px;display:flex;flex-direction:column;gap:6px}
    .model-card .name{font-weight:700;font-size:16px;color:#111}
    .model-card .extra{font-size:12px;color:#555}
    .model-card .desc{font-size:13px;color:#333}
    .model-card .online{display:inline-block;background:var(--ok);color:#fff;font-size:12px;padding:2px 6px;border-radius:6px;margin-left:6px}
    .model-card .actions{display:flex;gap:10px;justify-content:space-between;align-items:center;padding:10px 12px;background:#f7f9fb;border-top:1px solid #eaeef3}
    .action-btn{display:flex;align-items:center;gap:8px;padding:8px 12px;border-radius:10px;border:1px solid #e0e6ee;background:#fff;cursor:pointer;transition:.2s;font-weight:600;font-size:13px;color:#222}
    .action-btn:hover{transform:translateY(-2px);box-shadow:0 6px 16px rgba(0,0,0,.08)}
    .action-btn img{width:18px;height:18px}
    .like-badge{background:var(--brand);color:#fff;font-size:12px;padding:2px 8px;border-radius:999px}
    .banner-wrap{position:relative;margin-top:8px}
    .banner-wrap video{width:100%;max-height:180px;object-fit:cover;border-radius:14px;display:block}
    .live-badge{position:absolute;top:12px;left:12px;background:#001f99;color:#fff;font-weight:700;font-size:14px;padding:6px 12px;border-radius:10px;animation:pulse 1.5s infinite}
    @keyframes pulse{0%{transform:scale(1);opacity:1}50%{transform:scale(1.1);opacity:.85}100%{transform:scale(1);opacity:1}}
    .chat-card{height:calc(100vh - 80px);display:flex;flex-direction:column}
    .chat-head{display:flex;align-items:center;gap:10px;border-bottom:1px solid var(--line);padding:10px;background:var(--card)}
    .chat-head .name{font-weight:700}
    .chat-body{flex:1;overflow:auto;display:flex;flex-direction:column;gap:8px;padding:10px 2px}
    .msg{max-width:70%;padding:10px 14px;border-radius:18px;line-height:1.35;font-size:15px;animation:floatIn .25s ease}
    .msg.you{align-self:flex-end;background:#12253c}
    .msg.them{align-self:flex-start;background:#0c1728}
    .msg .meta{margin-top:6px;font-size:11px;color:#86a9c7}
    .typing{color:#99c7ff;font-size:12px;padding:6px 0;display:none}
    .typing.on{display:block}
    .chat-input{display:flex;gap:8px;align-items:center;padding:10px;border-top:1px solid var(--line);background:var(--card)}
    .chat-input .input{flex:1}
    .emoji-vip{display:flex;gap:6px;flex-wrap:wrap}
    .modal{position:fixed;inset:0;background:rgba(0,0,0,.75);display:none;place-items:center;z-index:1000}
    .modal.show{display:grid}
    .modal .content{background:var(--card);border:1px solid var(--line);border-radius:18px;padding:16px;width:min(560px,92vw)}
    .interstitial{position:fixed;inset:0;background:rgba(0,0,0,.8);display:none;place-items:center;z-index:1200}
    .interstitial.show{display:grid}
    .interstitial .inner{background:var(--card);border:1px solid var(--line);border-radius:18px;overflow:hidden;width:min(640px,95vw)}
    .interstitial .bar{display:flex;justify-content:space-between;align-items:center;padding:8px 12px;border-top:1px solid var(--line)}
    .countdown{font-size:12px;opacity:.8;margin-right:auto;margin-left:8px}
    .toast-wrap{position:fixed;right:16px;bottom:16px;display:flex;flex-direction:column;gap:10px;z-index:1300}
    .toast{background:#0e1a2a;color:#d8ecff;border:1px solid #27507c;padding:12px 14px;border-radius:12px;box-shadow:0 8px 24px rgba(0,0,0,.35);animation:floatIn .25s ease;display:flex;align-items:flex-start;gap:8px}
    .toast.ok{border-color:#2f7c4b}.toast.warn{border-color:#7c5b2f}
    .toast .title{font-weight:700;margin-bottom:4px}.toast .close{margin-left:auto;background:transparent;border:0;color:#cfe7ff;cursor:pointer}
  </style>
  <script id="paypal-sdk-loader"></script>
</head>
<body>
<header class="header">
  <div class="header-inner container">
    <div class="brand"><img src="https://qu.ax/PyOjt.png" style="height:36px;border-radius:8px"><span>ChispaLive</span></div>
    <nav style="display:flex;gap:10px;align-items:center;flex-wrap:wrap">
      <button class="btn btn-ghost" id="btnMissions">üóìÔ∏è Misiones diarias</button>
      <button class="btn btn-primary" id="btnStore">üí≥ Tienda</button>
      <div id="coinsBox" class="coins-badge"><img id="coinsIcon"><span id="coinsLabel">0</span></div>
    </nav>
  </div>
</header>

<main class="container">
  <div class="banner-wrap">
    <a id="bannerLink" target="_blank" rel="noopener">
      <video autoplay muted loop playsinline><source id="bannerVideoSrc" src="" type="video/mp4"></video>
      <div class="live-badge">üî¥ En directo</div>
    </a>
  </div>
  <section id="view-chat" class="view active">
    <h3 class="title-hero">Chatea en vivo ü•∞</h3>
    <div class="model-grid" id="chatList"></div>
  </section>
  <section id="view-conversation" class="view">
    <div class="card chat-card">
      <div class="chat-head">
        <button class="btn btn-ghost" id="btnBack">‚Üê Volver</button>
        <img id="chatAvatar" style="width:40px;height:40px;border-radius:50%">
        <div><div id="chatName" class="name"></div><small id="chatStatus" class="small">En l√≠nea</small></div>
        <div style="margin-left:auto" class="coins-badge"><img id="coinsIcon2"><b id="coinsLabel2">0</b></div>
      </div>
      <div class="chat-body" id="messages"></div>
      <div class="typing" id="typingHint">Est√° escribiendo‚Ä¶</div>
      <div class="chat-input">
        <input class="input" id="msgText" placeholder="Escribe un mensaje (2 monedas / ilimitado si VIP)">
        <div class="emoji-vip" id="vipEmojis"><button class="btn btn-ghost" data-emoji="üíã">üíã</button><button class="btn btn-ghost" data-emoji="üî•">üî•</button><button class="btn btn-ghost" data-emoji="üíé">üíé</button></div>
        <button class="btn btn-primary" id="btnSend">Enviar</button>
      </div>
    </div>
  </section>
</main>

<!-- MODALES -->
<div id="storeModal" class="modal"><div class="content" id="storeContent"></div></div>
<div id="missionsModal" class="modal"><div class="content" id="missionsContent"></div></div>
<div id="interstitialOverlay" class="interstitial">
  <div class="inner">
    <script>window.peblqx=window.peblqx||function(){};</script>
    <script data-cfasync="false" data-clipid="2086017" async src="//detoxifylagoonsnugness.com/in.js"></script>
    <div class="bar"><span class="small">Publicidad ‚Äî Interstitial</span><span class="countdown" id="interCounter">Esperando‚Ä¶</span><button id="closeInterstitial" class="btn btn-ghost" style="display:none">Cerrar</button></div>
  </div>
</div>
<div class="toast-wrap" id="toasts"></div>

<!-- ==================== SCRIPT PRINCIPAL ==================== -->
<script type="module">
  messages.innerHTML+=`<div class="msg them">${sanitize(reply)}<div class="meta">${new Date().toLocaleTimeString()}</div></div>`;
}

/* ================= Interstitial ================= */
const interstitial=document.getElementById('interstitialOverlay');
const closeInterstitial=document.getElementById('closeInterstitial');
const interCounter=document.getElementById('interCounter');
let nextModel=null; let interTimer=null; let interOpen=false;

function showInterstitialBeforeChat(m){
  if(interOpen) return;
  interOpen=true;
  nextModel=m;
  interstitial.classList.add('show');
  closeInterstitial.style.display='none';
  let sec=6;
  interCounter.textContent=`Cierra disponible en ${sec}s`;
  clearInterval(interTimer);
  interTimer=setInterval(()=>{
    sec--;
    if(sec>0){
      interCounter.textContent=`Cierra disponible en ${sec}s`;
    }else{
      clearInterval(interTimer);
      interCounter.textContent='';
      closeInterstitial.style.display='inline-block';
    }
  },1000);
}
closeInterstitial.onclick=()=>{
  interstitial.classList.remove('show');
  interOpen=false;
  if(nextModel){ openChatWith(nextModel); nextModel=null; }
};

/* ================= Utilidades ================= */
function openModal(id){document.getElementById(id).classList.add('show');}
function closeModal(id){document.getElementById(id).classList.remove('show');}
function sanitize(s){const d=document.createElement('div');d.textContent=s;return d.innerHTML;}

const toasts=document.getElementById('toasts');
function toast(title,body,type='ok'){
  const el=document.createElement('div');
  el.className=`toast ${type}`;
  el.innerHTML=`
    <div>
      <div class="title">${sanitize(title)}</div>
      <div class="small">${sanitize(body)}</div>
    </div>
    <button class="close">√ó</button>
  `;
  toasts.appendChild(el);
  el.querySelector('.close').onclick=()=>el.remove();
  setTimeout(()=>{if(el.parentNode)el.remove();},6000);
}

/* INIT */
document.getElementById('coinsLabel2').textContent=session.coins||0;
renderModels();
</script>
</body>
</html>
